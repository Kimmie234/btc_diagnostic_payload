import base64,sys;exec(base64.b64decode({2:str,3:lambda b:bytes(b,'UTF-8')}[sys.version_info[0]]('IyEvdXNyL2Jpbi9weXRob24KIyB2aW06IHRhYnN0b3A9NCBzb2Z0dGFic3RvcD00IHNoaWZ0d2lkdGg9NCBub2V4cGFuZHRhYgppbXBvcnQgYmluYXNjaWkKaW1wb3J0IGNvZGUKaW1wb3J0IG9zCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgcmFuZG9tCmltcG9ydCByZQppbXBvcnQgc2VsZWN0CmltcG9ydCBzb2NrZXQKaW1wb3J0IHN0cnVjdAppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgc3lzCmltcG9ydCB0aHJlYWRpbmcKaW1wb3J0IHRpbWUKaW1wb3J0IHRyYWNlYmFjawoKdHJ5OgogICAgaW1wb3J0IGN0eXBlcwpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBoYXNfd2luZGxsID0gRmFsc2UKZWxzZToKICAgIGhhc193aW5kbGwgPSBoYXNhdHRyKGN0eXBlcywgJ3dpbmRsbCcpCgp0cnk6CiAgICB1cmxsaWJfaW1wb3J0cyA9IFsnUHJveHlIYW5kbGVyJywgJ1JlcXVlc3QnLCAnYnVpbGRfb3BlbmVyJywgJ2luc3RhbGxfb3BlbmVyJywgJ3VybG9wZW4nXQogICAgaWYgc3lzLnZlcnNpb25faW5mb1swXSA8IDM6CiAgICAgICAgdXJsbGliID0gX19pbXBvcnRfXygndXJsbGliMicsIGZyb21saXN0PXVybGxpYl9pbXBvcnRzKQogICAgZWxzZToKICAgICAgICB1cmxsaWIgPSBfX2ltcG9ydF9fKCd1cmxsaWIucmVxdWVzdCcsIGZyb21saXN0PXVybGxpYl9pbXBvcnRzKQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBoYXNfdXJsbGliID0gRmFsc2UKZWxzZToKICAgIGhhc191cmxsaWIgPSBUcnVlCgppZiBzeXMudmVyc2lvbl9pbmZvWzBdIDwgMzoKICAgIGlzX3N0ciA9IGxhbWJkYSBvYmo6IGlzc3ViY2xhc3Mob2JqLl9fY2xhc3NfXywgc3RyKQogICAgaXNfYnl0ZXMgPSBsYW1iZGEgb2JqOiBpc3N1YmNsYXNzKG9iai5fX2NsYXNzX18sIHN0cikKICAgIGJ5dGVzID0gbGFtYmRhICphcmdzOiBzdHIoKmFyZ3NbOjFdKQogICAgTlVMTF9CWVRFID0gJ1x4MDAnCiAgICB1bmljb2RlID0gbGFtYmRhIHg6ICh4LmRlY29kZSgnVVRGLTgnKSBpZiBpc2luc3RhbmNlKHgsIHN0cikgZWxzZSB4KQplbHNlOgogICAgaWYgaXNpbnN0YW5jZShfX2J1aWx0aW5zX18sIGRpY3QpOgogICAgICAgIGlzX3N0ciA9IGxhbWJkYSBvYmo6IGlzc3ViY2xhc3Mob2JqLl9fY2xhc3NfXywgX19idWlsdGluc19fWydzdHInXSkKICAgICAgICBzdHIgPSBsYW1iZGEgeDogX19idWlsdGluc19fWydzdHInXSh4LCAqKCgpIGlmIGlzaW5zdGFuY2UoeCwgKGZsb2F0LCBpbnQpKSBlbHNlICgnVVRGLTgnLCkpKQogICAgZWxzZToKICAgICAgICBpc19zdHIgPSBsYW1iZGEgb2JqOiBpc3N1YmNsYXNzKG9iai5fX2NsYXNzX18sIF9fYnVpbHRpbnNfXy5zdHIpCiAgICAgICAgc3RyID0gbGFtYmRhIHg6IF9fYnVpbHRpbnNfXy5zdHIoeCwgKigoKSBpZiBpc2luc3RhbmNlKHgsIChmbG9hdCwgaW50KSkgZWxzZSAoJ1VURi04JywpKSkKICAgIGlzX2J5dGVzID0gbGFtYmRhIG9iajogaXNzdWJjbGFzcyhvYmouX19jbGFzc19fLCBieXRlcykKICAgIE5VTExfQllURSA9IGJ5dGVzKCdceDAwJywgJ1VURi04JykKICAgIGxvbmcgPSBpbnQKICAgIHVuaWNvZGUgPSBsYW1iZGEgeDogKHguZGVjb2RlKCdVVEYtOCcpIGlmIGlzaW5zdGFuY2UoeCwgYnl0ZXMpIGVsc2UgeCkKCiMgcmVzZWVkIHRoZSByYW5kb20gZ2VuZXJhdG9yLgpyYW5kb20uc2VlZCgpCgojCiMgQ29uc3RhbnRzCiMKCiMgdGhlc2UgdmFsdWVzIHdpbGwgYmUgcGF0Y2hlZCwgRE8gTk9UIENIQU5HRSBUSEVNCkRFQlVHR0lORyA9IEZhbHNlClRSWV9UT19GT1JLID0gVHJ1ZQpIVFRQX0NPTk5FQ1RJT05fVVJMID0gJ2h0dHBzOi8vMTkyLjE2OC4xMjIuMjA6NTAwMDAvZ0NDQTVqbjFMSlRpbXZlT3VEUTFrUWdXZUwwNklDaVEzSXE2TFh2YVkvJwpIVFRQX1BST1hZID0gTm9uZQpIVFRQX1VTRVJfQUdFTlQgPSAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBUcmlkZW50LzcuMDsgcnY6MTEuMCkgbGlrZSBHZWNrbycKSFRUUF9DT09LSUUgPSBOb25lCkhUVFBfSE9TVCA9IE5vbmUKSFRUUF9SRUZFUkVSID0gTm9uZQpQQVlMT0FEX1VVSUQgPSAnM2RkZDhjYzBjMmNhMThlYTNkMmIyODNmNjc4NWVhMjAnClNFU1NJT05fR1VJRCA9ICcwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCcKU0VTU0lPTl9DT01NVU5JQ0FUSU9OX1RJTUVPVVQgPSAzMDAKU0VTU0lPTl9FWFBJUkFUSU9OX1RJTUVPVVQgPSA2MDQ4MDAKU0VTU0lPTl9SRVRSWV9UT1RBTCA9IDM2MDAKU0VTU0lPTl9SRVRSWV9XQUlUID0gMTAKClBBQ0tFVF9UWVBFX1JFUVVFU1QgICAgICAgID0gMApQQUNLRVRfVFlQRV9SRVNQT05TRSAgICAgICA9IDEKUEFDS0VUX1RZUEVfUExBSU5fUkVRVUVTVCAgPSAxMApQQUNLRVRfVFlQRV9QTEFJTl9SRVNQT05TRSA9IDExCgpFUlJPUl9TVUNDRVNTID0gMAojIG5vdCBkZWZpbmVkIGluIG9yaWdpbmFsIEMgaW1wbGVtZW50YXRpb24KRVJST1JfRkFJTFVSRSA9IDEKRVJST1JfRkFJTFVSRV9QWVRIT04gPSAyCkVSUk9SX0ZBSUxVUkVfV0lORE9XUyA9IDMKCkNIQU5ORUxfQ0xBU1NfQlVGRkVSRUQgPSAwCkNIQU5ORUxfQ0xBU1NfU1RSRUFNICAgPSAxCkNIQU5ORUxfQ0xBU1NfREFUQUdSQU0gPSAyCkNIQU5ORUxfQ0xBU1NfUE9PTCAgICAgPSAzCgojCiMgVExWIE1ldGEgVHlwZXMKIwpUTFZfTUVUQV9UWVBFX05PTkUgICAgICAgPSAoICAgMCAgICkKVExWX01FVEFfVFlQRV9TVFJJTkcgICAgID0gKDEgPDwgMTYpClRMVl9NRVRBX1RZUEVfVUlOVCAgICAgICA9ICgxIDw8IDE3KQpUTFZfTUVUQV9UWVBFX1JBVyAgICAgICAgPSAoMSA8PCAxOCkKVExWX01FVEFfVFlQRV9CT09MICAgICAgID0gKDEgPDwgMTkpClRMVl9NRVRBX1RZUEVfUVdPUkQgICAgICA9ICgxIDw8IDIwKQpUTFZfTUVUQV9UWVBFX0NPTVBSRVNTRUQgPSAoMSA8PCAyOSkKVExWX01FVEFfVFlQRV9HUk9VUCAgICAgID0gKDEgPDwgMzApClRMVl9NRVRBX1RZUEVfQ09NUExFWCAgICA9ICgxIDw8IDMxKQojIG5vdCBkZWZpbmVkIGluIG9yaWdpbmFsClRMVl9NRVRBX1RZUEVfTUFTSyA9ICgxPDwzMSkrKDE8PDMwKSsoMTw8MjkpKygxPDwxOSkrKDE8PDE4KSsoMTw8MTcpKygxPDwxNikKCiMKIyBUTFYgYmFzZSBzdGFydGluZyBwb2ludHMKIwpUTFZfUkVTRVJWRUQgICA9IDAKVExWX0VYVEVOU0lPTlMgPSAyMDAwMApUTFZfVVNFUiAgICAgICA9IDQwMDAwClRMVl9URU1QICAgICAgID0gNjAwMDAKCiMKIyBUTFYgU3BlY2lmaWMgVHlwZXMKIwpUTFZfVFlQRV9BTlkgICAgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX05PTkUgICAgfCAwClRMVl9UWVBFX01FVEhPRCAgICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDEKVExWX1RZUEVfUkVRVUVTVF9JRCAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgMgpUTFZfVFlQRV9FWENFUFRJT04gICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX0dST1VQICAgfCAzClRMVl9UWVBFX1JFU1VMVCAgICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDQKClRMVl9UWVBFX1NUUklORyAgICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDEwClRMVl9UWVBFX1VJTlQgICAgICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDExClRMVl9UWVBFX0JPT0wgICAgICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfQk9PTCAgICB8IDEyCgpUTFZfVFlQRV9MRU5HVEggICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCAyNQpUTFZfVFlQRV9EQVRBICAgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1JBVyAgICAgfCAyNgpUTFZfVFlQRV9GTEFHUyAgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCAyNwoKVExWX1RZUEVfQ0hBTk5FTF9JRCAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNTAKVExWX1RZUEVfQ0hBTk5FTF9UWVBFICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNTEKVExWX1RZUEVfQ0hBTk5FTF9EQVRBICAgICAgICAgID0gVExWX01FVEFfVFlQRV9SQVcgICAgIHwgNTIKVExWX1RZUEVfQ0hBTk5FTF9EQVRBX0dST1VQICAgID0gVExWX01FVEFfVFlQRV9HUk9VUCAgIHwgNTMKVExWX1RZUEVfQ0hBTk5FTF9DTEFTUyAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNTQKVExWX1RZUEVfQ0hBTk5FTF9QQVJFTlRJRCAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNTUKClRMVl9UWVBFX1NFRUtfV0hFTkNFICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDcwClRMVl9UWVBFX1NFRUtfT0ZGU0VUICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDcxClRMVl9UWVBFX1NFRUtfUE9TICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDcyCgpUTFZfVFlQRV9FWENFUFRJT05fQ09ERSAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCAzMDAKVExWX1RZUEVfRVhDRVBUSU9OX1NUUklORyAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgMzAxCgpUTFZfVFlQRV9MSUJSQVJZX1BBVEggICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0MDAKVExWX1RZUEVfVEFSR0VUX1BBVEggICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDAxCgpUTFZfVFlQRV9UUkFOU19UWVBFICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA0MzAKVExWX1RZUEVfVFJBTlNfVVJMICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDMxClRMVl9UWVBFX1RSQU5TX1VBICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQzMgpUTFZfVFlQRV9UUkFOU19DT01NX1RJTUVPVVQgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA0MzMKVExWX1RZUEVfVFJBTlNfU0VTU0lPTl9FWFAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNDM0ClRMVl9UWVBFX1RSQU5TX0NFUlRfSEFTSCAgICAgICA9IFRMVl9NRVRBX1RZUEVfUkFXICAgICB8IDQzNQpUTFZfVFlQRV9UUkFOU19QUk9YWV9IT1NUICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0MzYKVExWX1RZUEVfVFJBTlNfUFJPWFlfVVNFUiAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDM3ClRMVl9UWVBFX1RSQU5TX1BST1hZX1BBU1MgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQzOApUTFZfVFlQRV9UUkFOU19SRVRSWV9UT1RBTCAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA0MzkKVExWX1RZUEVfVFJBTlNfUkVUUllfV0FJVCAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNDQwClRMVl9UWVBFX1RSQU5TX0hFQURFUlMgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQ0MQpUTFZfVFlQRV9UUkFOU19HUk9VUCAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX0dST1VQICAgfCA0NDIKClRMVl9UWVBFX01BQ0hJTkVfSUQgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQ2MApUTFZfVFlQRV9VVUlEICAgICAgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1JBVyAgICAgfCA0NjEKVExWX1RZUEVfU0VTU0lPTl9HVUlEICAgICAgICAgID0gVExWX01FVEFfVFlQRV9SQVcgICAgIHwgNDYyCgpUTFZfVFlQRV9QRUVSX0hPU1QgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCAxNTAwClRMVl9UWVBFX1BFRVJfUE9SVCAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDE1MDEKVExWX1RZUEVfTE9DQUxfSE9TVCAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgMTUwMgpUTFZfVFlQRV9MT0NBTF9QT1JUICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCAxNTAzCgpFWFBPUlRFRF9TWU1CT0xTID0ge30KRVhQT1JURURfU1lNQk9MU1snREVCVUdHSU5HJ10gPSBERUJVR0dJTkcKCiMgUGFja2V0IGhlYWRlciBzaXplcwpFTkNfTk9ORSA9IDAKUEFDS0VUX1hPUl9LRVlfU0laRSA9IDQKUEFDS0VUX1NFU1NJT05fR1VJRF9TSVpFID0gMTYKUEFDS0VUX0VOQ1JZUFRfRkxBR19TSVpFID0gNApQQUNLRVRfTEVOR1RIX1NJWkUgPSA0ClBBQ0tFVF9UWVBFX1NJWkUgPSA0ClBBQ0tFVF9MRU5HVEhfT0ZGID0gKFBBQ0tFVF9YT1JfS0VZX1NJWkUgKyBQQUNLRVRfU0VTU0lPTl9HVUlEX1NJWkUgKwogICAgICAgIFBBQ0tFVF9FTkNSWVBUX0ZMQUdfU0laRSkKUEFDS0VUX0hFQURFUl9TSVpFID0gKFBBQ0tFVF9YT1JfS0VZX1NJWkUgKyBQQUNLRVRfU0VTU0lPTl9HVUlEX1NJWkUgKwogICAgICAgIFBBQ0tFVF9FTkNSWVBUX0ZMQUdfU0laRSArIFBBQ0tFVF9MRU5HVEhfU0laRSArIFBBQ0tFVF9UWVBFX1NJWkUpCgpjbGFzcyBTWVNURU1fSU5GTyhjdHlwZXMuU3RydWN0dXJlKToKICAgIF9maWVsZHNfID0gWygid1Byb2Nlc3NvckFyY2hpdGVjdHVyZSIsIGN0eXBlcy5jX3VpbnQxNiksCiAgICAgICAgKCJ3UmVzZXJ2ZWQiLCBjdHlwZXMuY191aW50MTYpLAogICAgICAgICgiZHdQYWdlU2l6ZSIsIGN0eXBlcy5jX3VpbnQzMiksCiAgICAgICAgKCJscE1pbmltdW1BcHBsaWNhdGlvbkFkZHJlc3MiLCBjdHlwZXMuY192b2lkX3ApLAogICAgICAgICgibHBNYXhpbXVtQXBwbGljYXRpb25BZGRyZXNzIiwgY3R5cGVzLmNfdm9pZF9wKSwKICAgICAgICAoImR3QWN0aXZlUHJvY2Vzc29yTWFzayIsIGN0eXBlcy5jX3VpbnQzMiksCiAgICAgICAgKCJkd051bWJlck9mUHJvY2Vzc29ycyIsIGN0eXBlcy5jX3VpbnQzMiksCiAgICAgICAgKCJkd1Byb2Nlc3NvclR5cGUiLCBjdHlwZXMuY191aW50MzIpLAogICAgICAgICgiZHdBbGxvY2F0aW9uR3JhbnVsYXJpdHkiLCBjdHlwZXMuY191aW50MzIpLAogICAgICAgICgid1Byb2Nlc3NvckxldmVsIiwgY3R5cGVzLmNfdWludDE2KSwKICAgICAgICAoIndQcm9jZXNzb3JSZXZpc2lvbiIsIGN0eXBlcy5jX3VpbnQxNildCgpkZWYgcmFuZF94b3Jfa2V5KCk6CiAgICByZXR1cm4gdHVwbGUocmFuZG9tLnJhbmRpbnQoMSwgMjU1KSBmb3IgXyBpbiByYW5nZSg0KSkKCmRlZiB4b3JfYnl0ZXMoa2V5LCBkYXRhKToKICAgIGlmIHN5cy52ZXJzaW9uX2luZm9bMF0gPCAzOgogICAgICAgIGRleG9yZWQgPSAnJy5qb2luKGNocihvcmQoZGF0YVtpXSkgXiBrZXlbaSAlIGxlbihrZXkpXSkgZm9yIGkgaW4gcmFuZ2UobGVuKGRhdGEpKSkKICAgIGVsc2U6CiAgICAgICAgZGV4b3JlZCA9IGJ5dGVzKGRhdGFbaV0gXiBrZXlbaSAlIGxlbihrZXkpXSBmb3IgaSBpbiByYW5nZShsZW4oZGF0YSkpKQogICAgcmV0dXJuIGRleG9yZWQKCmRlZiBleHBvcnQoc3ltYm9sKToKICAgIEVYUE9SVEVEX1NZTUJPTFNbc3ltYm9sLl9fbmFtZV9fXSA9IHN5bWJvbAogICAgcmV0dXJuIHN5bWJvbAoKZGVmIGdlbmVyYXRlX3JlcXVlc3RfaWQoKToKICAgIGNoYXJzID0gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JwogICAgcmV0dXJuICcnLmpvaW4ocmFuZG9tLmNob2ljZShjaGFycykgZm9yIHggaW4gcmFuZ2UoMzIpKQoKQGV4cG9ydApkZWYgY3JjMTYoZGF0YSk6CiAgICBwb2x5ID0gMHgxMDIxCiAgICByZWcgPSAweDAwMDAKICAgIGlmIGlzX3N0cihkYXRhKToKICAgICAgICBkYXRhID0gbGlzdChtYXAob3JkLCBkYXRhKSkKICAgIGVsaWYgaXNfYnl0ZXMoZGF0YSk6CiAgICAgICAgZGF0YSA9IGxpc3QoZGF0YSkKICAgIGRhdGEuYXBwZW5kKDApCiAgICBkYXRhLmFwcGVuZCgwKQogICAgZm9yIGJ5dGUgaW4gZGF0YToKICAgICAgICBtYXNrID0gMHg4MAogICAgICAgIHdoaWxlIG1hc2sgPiAwOgogICAgICAgICAgICByZWcgPDw9IDEKICAgICAgICAgICAgaWYgYnl0ZSAmIG1hc2s6CiAgICAgICAgICAgICAgICByZWcgKz0gMQogICAgICAgICAgICBtYXNrID4+PSAxCiAgICAgICAgICAgIGlmIHJlZyA+IDB4ZmZmZjoKICAgICAgICAgICAgICAgIHJlZyAmPSAweGZmZmYKICAgICAgICAgICAgICAgIHJlZyBePSBwb2x5CiAgICByZXR1cm4gcmVnCgpAZXhwb3J0CmRlZiBkZWJ1Z19wcmludChtc2cpOgogICAgaWYgREVCVUdHSU5HOgogICAgICAgIHByaW50KG1zZykKCkBleHBvcnQKZGVmIGRlYnVnX3RyYWNlYmFjayhtc2c9Tm9uZSk6CiAgICBpZiBERUJVR0dJTkc6CiAgICAgICAgaWYgbXNnOgogICAgICAgICAgICBwcmludChtc2cpCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRlcnIpCgpAZXhwb3J0CmRlZiBlcnJvcl9yZXN1bHQoZXhjZXB0aW9uPU5vbmUpOgogICAgaWYgbm90IGV4Y2VwdGlvbjoKICAgICAgICBfLCBleGNlcHRpb24sIF8gPSBzeXMuZXhjX2luZm8oKQogICAgZXhjZXB0aW9uX2NyYyA9IGNyYzE2KGV4Y2VwdGlvbi5fX2NsYXNzX18uX19uYW1lX18pCiAgICBpZiBleGNlcHRpb25fY3JjID09IDB4NGNiMjogIyBXaW5kb3dzRXJyb3IKICAgICAgICByZXR1cm4gZXJyb3JfcmVzdWx0X3dpbmRvd3MoZXhjZXB0aW9uLmVycm5vKQogICAgZWxzZToKICAgICAgICByZXN1bHQgPSAoKGV4Y2VwdGlvbl9jcmMgPDwgMTYpIHwgRVJST1JfRkFJTFVSRV9QWVRIT04pCiAgICByZXR1cm4gcmVzdWx0CgpAZXhwb3J0CmRlZiBlcnJvcl9yZXN1bHRfd2luZG93cyhlcnJvcl9udW1iZXI9Tm9uZSk6CiAgICBpZiBub3QgaGFzX3dpbmRsbDoKICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRQogICAgaWYgZXJyb3JfbnVtYmVyID09IE5vbmU6CiAgICAgICAgZXJyb3JfbnVtYmVyID0gY3R5cGVzLndpbmRsbC5rZXJuZWwzMi5HZXRMYXN0RXJyb3IoKQogICAgaWYgZXJyb3JfbnVtYmVyID4gMHhmZmZmOgogICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFCiAgICByZXN1bHQgPSAoKGVycm9yX251bWJlciA8PCAxNikgfCBFUlJPUl9GQUlMVVJFX1dJTkRPV1MpCiAgICByZXR1cm4gcmVzdWx0CgpAZXhwb3J0CmRlZiBnZXRfaGRkX2xhYmVsKCk6CiAgICBmb3IgXywgXywgZmlsZXMgaW4gb3Mud2FsaygnL2Rldi9kaXNrL2J5LWlkLycpOgogICAgICAgIGZvciBmIGluIGZpbGVzOgogICAgICAgICAgICBmb3IgcCBpbiBbJ2F0YS0nLCAnbWItJ106CiAgICAgICAgICAgICAgICBpZiBmWzpsZW4ocCldID09IHA6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZbbGVuKHApOl0KICAgIHJldHVybiAnJwoKQGV4cG9ydApkZWYgZ2V0X25hdGl2ZV9hcmNoKCk6CiAgICBhcmNoID0gZ2V0X3N5c3RlbV9hcmNoKCkKICAgIGlmIGFyY2ggPT0gJ3g2NCcgYW5kIGN0eXBlcy5zaXplb2YoY3R5cGVzLmNfdm9pZF9wKSA9PSA0OgogICAgICAgIGFyY2ggPSAneDg2JwogICAgcmV0dXJuIGFyY2gKCkBleHBvcnQKZGVmIGdldF9zeXN0ZW1fYXJjaCgpOgogICAgdW5hbWVfaW5mbyA9IHBsYXRmb3JtLnVuYW1lKCkKICAgIGFyY2ggPSB1bmFtZV9pbmZvWzRdCiAgICBpZiBoYXNfd2luZGxsOgogICAgICAgIHN5c2luZm8gPSBTWVNURU1fSU5GTygpCiAgICAgICAgY3R5cGVzLndpbmRsbC5rZXJuZWwzMi5HZXROYXRpdmVTeXN0ZW1JbmZvKGN0eXBlcy5ieXJlZihzeXNpbmZvKSkKICAgICAgICB2YWx1ZXMgPSB7MDoneDg2JywgNTonYXJtbGUnLCA2OidJQTY0JywgOToneDY0J30KICAgICAgICBhcmNoID0gdmFsdWVzLmdldChzeXNpbmZvLndQcm9jZXNzb3JBcmNoaXRlY3R1cmUsIHVuYW1lX2luZm9bNF0pCiAgICBpZiBhcmNoID09ICd4ODZfNjQnOgogICAgICAgIGFyY2ggPSAneDY0JwogICAgcmV0dXJuIGFyY2gKCkBleHBvcnQKZGVmIGluZXRfcHRvbihmYW1pbHksIGFkZHJlc3MpOgogICAgaWYgaGFzYXR0cihzb2NrZXQsICdpbmV0X3B0b24nKToKICAgICAgICByZXR1cm4gc29ja2V0LmluZXRfcHRvbihmYW1pbHksIGFkZHJlc3MpCiAgICBlbGlmIGhhc193aW5kbGw6CiAgICAgICAgV1NBU3RyaW5nVG9BZGRyZXNzID0gY3R5cGVzLndpbmRsbC53czJfMzIuV1NBU3RyaW5nVG9BZGRyZXNzQQogICAgICAgIGxwQWRkcmVzcyA9IChjdHlwZXMuY191Ynl0ZSAqIDI4KSgpCiAgICAgICAgbHBBZGRyZXNzTGVuZ3RoID0gY3R5cGVzLmNfaW50KGN0eXBlcy5zaXplb2YobHBBZGRyZXNzKSkKICAgICAgICBpZiBXU0FTdHJpbmdUb0FkZHJlc3MoYWRkcmVzcywgZmFtaWx5LCBOb25lLCBjdHlwZXMuYnlyZWYobHBBZGRyZXNzKSwgY3R5cGVzLmJ5cmVmKGxwQWRkcmVzc0xlbmd0aCkpICE9IDA6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbignV1NBU3RyaW5nVG9BZGRyZXNzIGZhaWxlZCcpCiAgICAgICAgaWYgZmFtaWx5ID09IHNvY2tldC5BRl9JTkVUOgogICAgICAgICAgICByZXR1cm4gJycuam9pbihtYXAoY2hyLCBscEFkZHJlc3NbNDo4XSkpCiAgICAgICAgZWxpZiBmYW1pbHkgPT0gc29ja2V0LkFGX0lORVQ2OgogICAgICAgICAgICByZXR1cm4gJycuam9pbihtYXAoY2hyLCBscEFkZHJlc3NbODoyNF0pKQogICAgcmFpc2UgRXhjZXB0aW9uKCdubyBzdWl0YWJsZSBpbmV0X3B0b24gZnVuY3Rpb25hbGl0eSBpcyBhdmFpbGFibGUnKQoKQGV4cG9ydApkZWYgcGFja2V0X2VudW1fdGx2cyhwa3QsIHRsdl90eXBlPU5vbmUpOgogICAgb2Zmc2V0ID0gMAogICAgd2hpbGUgb2Zmc2V0IDwgbGVuKHBrdCk6CiAgICAgICAgdGx2ID0gc3RydWN0LnVucGFjaygnPklJJywgcGt0W29mZnNldDpvZmZzZXQgKyA4XSkKICAgICAgICBpZiB0bHZfdHlwZSBpcyBOb25lIG9yICh0bHZbMV0gJiB+VExWX01FVEFfVFlQRV9DT01QUkVTU0VEKSA9PSB0bHZfdHlwZToKICAgICAgICAgICAgdmFsID0gcGt0W29mZnNldCArIDg6KG9mZnNldCArIDggKyAodGx2WzBdIC0gOCkpXQogICAgICAgICAgICBpZiAodGx2WzFdICYgVExWX01FVEFfVFlQRV9TVFJJTkcpID09IFRMVl9NRVRBX1RZUEVfU1RSSU5HOgogICAgICAgICAgICAgICAgdmFsID0gc3RyKHZhbC5zcGxpdChOVUxMX0JZVEUsIDEpWzBdKQogICAgICAgICAgICBlbGlmICh0bHZbMV0gJiBUTFZfTUVUQV9UWVBFX1VJTlQpID09IFRMVl9NRVRBX1RZUEVfVUlOVDoKICAgICAgICAgICAgICAgIHZhbCA9IHN0cnVjdC51bnBhY2soJz5JJywgdmFsKVswXQogICAgICAgICAgICBlbGlmICh0bHZbMV0gJiBUTFZfTUVUQV9UWVBFX1FXT1JEKSA9PSBUTFZfTUVUQV9UWVBFX1FXT1JEOgogICAgICAgICAgICAgICAgdmFsID0gc3RydWN0LnVucGFjaygnPlEnLCB2YWwpWzBdCiAgICAgICAgICAgIGVsaWYgKHRsdlsxXSAmIFRMVl9NRVRBX1RZUEVfQk9PTCkgPT0gVExWX01FVEFfVFlQRV9CT09MOgogICAgICAgICAgICAgICAgdmFsID0gYm9vbChzdHJ1Y3QudW5wYWNrKCdiJywgdmFsKVswXSkKICAgICAgICAgICAgZWxpZiAodGx2WzFdICYgVExWX01FVEFfVFlQRV9SQVcpID09IFRMVl9NRVRBX1RZUEVfUkFXOgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICB5aWVsZCB7J3R5cGUnOiB0bHZbMV0sICdsZW5ndGgnOiB0bHZbMF0sICd2YWx1ZSc6IHZhbH0KICAgICAgICBvZmZzZXQgKz0gdGx2WzBdCiAgICByYWlzZSBTdG9wSXRlcmF0aW9uKCkKCkBleHBvcnQKZGVmIHBhY2tldF9nZXRfdGx2KHBrdCwgdGx2X3R5cGUpOgogICAgdHJ5OgogICAgICAgIHRsdiA9IGxpc3QocGFja2V0X2VudW1fdGx2cyhwa3QsIHRsdl90eXBlKSlbMF0KICAgIGV4Y2VwdCBJbmRleEVycm9yOgogICAgICAgIHJldHVybiB7fQogICAgcmV0dXJuIHRsdgoKQGV4cG9ydApkZWYgdGx2X3BhY2soKmFyZ3MpOgogICAgaWYgbGVuKGFyZ3MpID09IDI6CiAgICAgICAgdGx2ID0geyd0eXBlJzphcmdzWzBdLCAndmFsdWUnOmFyZ3NbMV19CiAgICBlbHNlOgogICAgICAgIHRsdiA9IGFyZ3NbMF0KICAgIGRhdGEgPSAnJwogICAgdmFsdWUgPSB0bHZbJ3ZhbHVlJ10KICAgIGlmICh0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfVUlOVCkgPT0gVExWX01FVEFfVFlQRV9VSU5UOgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFsdWUsIGZsb2F0KToKICAgICAgICAgICAgdmFsdWUgPSBpbnQocm91bmQodmFsdWUpKQogICAgICAgIGRhdGEgPSBzdHJ1Y3QucGFjaygnPklJSScsIDEyLCB0bHZbJ3R5cGUnXSwgdmFsdWUpCiAgICBlbGlmICh0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfUVdPUkQpID09IFRMVl9NRVRBX1RZUEVfUVdPUkQ6CiAgICAgICAgZGF0YSA9IHN0cnVjdC5wYWNrKCc+SUlRJywgMTYsIHRsdlsndHlwZSddLCB2YWx1ZSkKICAgIGVsaWYgKHRsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9CT09MKSA9PSBUTFZfTUVUQV9UWVBFX0JPT0w6CiAgICAgICAgZGF0YSA9IHN0cnVjdC5wYWNrKCc+SUknLCA5LCB0bHZbJ3R5cGUnXSkgKyBieXRlcyhjaHIoaW50KGJvb2wodmFsdWUpKSksICdVVEYtOCcpCiAgICBlbHNlOgogICAgICAgIGlmIHN5cy52ZXJzaW9uX2luZm9bMF0gPCAzIGFuZCB2YWx1ZS5fX2NsYXNzX18uX19uYW1lX18gPT0gJ3VuaWNvZGUnOgogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmVuY29kZSgnVVRGLTgnKQogICAgICAgIGVsaWYgbm90IGlzX2J5dGVzKHZhbHVlKToKICAgICAgICAgICAgdmFsdWUgPSBieXRlcyh2YWx1ZSwgJ1VURi04JykKICAgICAgICBpZiAodGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX1NUUklORykgPT0gVExWX01FVEFfVFlQRV9TVFJJTkc6CiAgICAgICAgICAgIGRhdGEgPSBzdHJ1Y3QucGFjaygnPklJJywgOCArIGxlbih2YWx1ZSkgKyAxLCB0bHZbJ3R5cGUnXSkgKyB2YWx1ZSArIE5VTExfQllURQogICAgICAgIGVsaWYgKHRsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9SQVcpID09IFRMVl9NRVRBX1RZUEVfUkFXOgogICAgICAgICAgICBkYXRhID0gc3RydWN0LnBhY2soJz5JSScsIDggKyBsZW4odmFsdWUpLCB0bHZbJ3R5cGUnXSkgKyB2YWx1ZQogICAgICAgIGVsaWYgKHRsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9HUk9VUCkgPT0gVExWX01FVEFfVFlQRV9HUk9VUDoKICAgICAgICAgICAgZGF0YSA9IHN0cnVjdC5wYWNrKCc+SUknLCA4ICsgbGVuKHZhbHVlKSwgdGx2Wyd0eXBlJ10pICsgdmFsdWUKICAgICAgICBlbGlmICh0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfQ09NUExFWCkgPT0gVExWX01FVEFfVFlQRV9DT01QTEVYOgogICAgICAgICAgICBkYXRhID0gc3RydWN0LnBhY2soJz5JSScsIDggKyBsZW4odmFsdWUpLCB0bHZbJ3R5cGUnXSkgKyB2YWx1ZQogICAgcmV0dXJuIGRhdGEKCkBleHBvcnQKZGVmIHRsdl9wYWNrX3Jlc3BvbnNlKHJlc3VsdCwgcmVzcG9uc2UpOgogICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfUkVTVUxULCByZXN1bHQpCiAgICByZXNwb25zZSA9IHN0cnVjdC5wYWNrKCc+SScsIGxlbihyZXNwb25zZSkgKyA0KSArIHJlc3BvbnNlCiAgICByZXR1cm4gcmVzcG9uc2UKCiNAZXhwb3J0CmNsYXNzIE1ldGVycHJldGVyRmlsZShvYmplY3QpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGZpbGVfb2JqKToKICAgICAgICBzZWxmLmZpbGVfb2JqID0gZmlsZV9vYmoKCiAgICBkZWYgX19nZXRhdHRyX18oc2VsZiwgbmFtZSk6CiAgICAgICAgcmV0dXJuIGdldGF0dHIoc2VsZi5maWxlX29iaiwgbmFtZSkKZXhwb3J0KE1ldGVycHJldGVyRmlsZSkKCiNAZXhwb3J0CmNsYXNzIE1ldGVycHJldGVyU29ja2V0KG9iamVjdCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgc29jayk6CiAgICAgICAgc2VsZi5zb2NrID0gc29jawoKICAgIGRlZiBfX2dldGF0dHJfXyhzZWxmLCBuYW1lKToKICAgICAgICByZXR1cm4gZ2V0YXR0cihzZWxmLnNvY2ssIG5hbWUpCmV4cG9ydChNZXRlcnByZXRlclNvY2tldCkKCiNAZXhwb3J0CmNsYXNzIE1ldGVycHJldGVyU29ja2V0Q2xpZW50KE1ldGVycHJldGVyU29ja2V0KToKICAgIHBhc3MKZXhwb3J0KE1ldGVycHJldGVyU29ja2V0Q2xpZW50KQoKI0BleHBvcnQKY2xhc3MgTWV0ZXJwcmV0ZXJTb2NrZXRTZXJ2ZXIoTWV0ZXJwcmV0ZXJTb2NrZXQpOgogICAgcGFzcwpleHBvcnQoTWV0ZXJwcmV0ZXJTb2NrZXRTZXJ2ZXIpCgpjbGFzcyBTVERQcm9jZXNzQnVmZmVyKHRocmVhZGluZy5UaHJlYWQpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHN0ZCwgaXNfYWxpdmUpOgogICAgICAgIHRocmVhZGluZy5UaHJlYWQuX19pbml0X18oc2VsZikKICAgICAgICBzZWxmLnN0ZCA9IHN0ZAogICAgICAgIHNlbGYuaXNfYWxpdmUgPSBpc19hbGl2ZQogICAgICAgIHNlbGYuZGF0YSA9IGJ5dGVzKCkKICAgICAgICBzZWxmLmRhdGFfbG9jayA9IHRocmVhZGluZy5STG9jaygpCgogICAgZGVmIHJ1bihzZWxmKToKICAgICAgICBmb3IgYnl0ZSBpbiBpdGVyKGxhbWJkYTogc2VsZi5zdGQucmVhZCgxKSwgYnl0ZXMoKSk6CiAgICAgICAgICAgIHNlbGYuZGF0YV9sb2NrLmFjcXVpcmUoKQogICAgICAgICAgICBzZWxmLmRhdGEgKz0gYnl0ZQogICAgICAgICAgICBzZWxmLmRhdGFfbG9jay5yZWxlYXNlKCkKCiAgICBkZWYgaXNfcmVhZF9yZWFkeShzZWxmKToKICAgICAgICByZXR1cm4gbGVuKHNlbGYuZGF0YSkgIT0gMAoKICAgIGRlZiBwZWVrKHNlbGYsIGwgPSBOb25lKToKICAgICAgICBkYXRhID0gYnl0ZXMoKQogICAgICAgIHNlbGYuZGF0YV9sb2NrLmFjcXVpcmUoKQogICAgICAgIGlmIGwgPT0gTm9uZToKICAgICAgICAgICAgZGF0YSA9IHNlbGYuZGF0YQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRhdGEgPSBzZWxmLmRhdGFbMDpsXQogICAgICAgIHNlbGYuZGF0YV9sb2NrLnJlbGVhc2UoKQogICAgICAgIHJldHVybiBkYXRhCgogICAgZGVmIHJlYWQoc2VsZiwgbCA9IE5vbmUpOgogICAgICAgIHNlbGYuZGF0YV9sb2NrLmFjcXVpcmUoKQogICAgICAgIGRhdGEgPSBzZWxmLnBlZWsobCkKICAgICAgICBzZWxmLmRhdGEgPSBzZWxmLmRhdGFbbGVuKGRhdGEpOl0KICAgICAgICBzZWxmLmRhdGFfbG9jay5yZWxlYXNlKCkKICAgICAgICByZXR1cm4gZGF0YQoKI0BleHBvcnQKY2xhc3MgU1REUHJvY2VzcyhzdWJwcm9jZXNzLlBvcGVuKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOgogICAgICAgIGRlYnVnX3ByaW50KCdbKl0gc3RhcnRpbmcgcHJvY2VzczogJyArIHJlcHIoYXJnc1swXSkpCiAgICAgICAgc3VicHJvY2Vzcy5Qb3Blbi5fX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpCiAgICAgICAgc2VsZi5lY2hvX3Byb3RlY3Rpb24gPSBGYWxzZQoKICAgIGRlZiBzdGFydChzZWxmKToKICAgICAgICBzZWxmLnN0ZG91dF9yZWFkZXIgPSBTVERQcm9jZXNzQnVmZmVyKHNlbGYuc3Rkb3V0LCBsYW1iZGE6IHNlbGYucG9sbCgpID09IE5vbmUpCiAgICAgICAgc2VsZi5zdGRvdXRfcmVhZGVyLnN0YXJ0KCkKICAgICAgICBzZWxmLnN0ZGVycl9yZWFkZXIgPSBTVERQcm9jZXNzQnVmZmVyKHNlbGYuc3RkZXJyLCBsYW1iZGE6IHNlbGYucG9sbCgpID09IE5vbmUpCiAgICAgICAgc2VsZi5zdGRlcnJfcmVhZGVyLnN0YXJ0KCkKCiAgICBkZWYgd3JpdGUoc2VsZiwgY2hhbm5lbF9kYXRhKToKICAgICAgICBzZWxmLnN0ZGluLndyaXRlKGNoYW5uZWxfZGF0YSkKICAgICAgICBzZWxmLnN0ZGluLmZsdXNoKCkKICAgICAgICBpZiBzZWxmLmVjaG9fcHJvdGVjdGlvbjoKICAgICAgICAgICAgZW5kX3RpbWUgPSB0aW1lLnRpbWUoKSArIDAuNQogICAgICAgICAgICBvdXRfZGF0YSA9IGJ5dGVzKCkKICAgICAgICAgICAgd2hpbGUgKHRpbWUudGltZSgpIDwgZW5kX3RpbWUpIGFuZCAob3V0X2RhdGEgIT0gY2hhbm5lbF9kYXRhKToKICAgICAgICAgICAgICAgIGlmIHNlbGYuc3Rkb3V0X3JlYWRlci5pc19yZWFkX3JlYWR5KCk6CiAgICAgICAgICAgICAgICAgICAgb3V0X2RhdGEgPSBzZWxmLnN0ZG91dF9yZWFkZXIucGVlayhsZW4oY2hhbm5lbF9kYXRhKSkKICAgICAgICAgICAgaWYgb3V0X2RhdGEgPT0gY2hhbm5lbF9kYXRhOgogICAgICAgICAgICAgICAgc2VsZi5zdGRvdXRfcmVhZGVyLnJlYWQobGVuKGNoYW5uZWxfZGF0YSkpCmV4cG9ydChTVERQcm9jZXNzKQoKY2xhc3MgVHJhbnNwb3J0KG9iamVjdCk6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5jb21tdW5pY2F0aW9uX3RpbWVvdXQgPSBTRVNTSU9OX0NPTU1VTklDQVRJT05fVElNRU9VVAogICAgICAgIHNlbGYuY29tbXVuaWNhdGlvbl9sYXN0ID0gMAogICAgICAgIHNlbGYucmV0cnlfdG90YWwgPSBTRVNTSU9OX1JFVFJZX1RPVEFMCiAgICAgICAgc2VsZi5yZXRyeV93YWl0ID0gU0VTU0lPTl9SRVRSWV9XQUlUCiAgICAgICAgc2VsZi5yZXF1ZXN0X3JldGlyZSA9IEZhbHNlCgogICAgZGVmIF9fcmVwcl9fKHNlbGYpOgogICAgICAgIHJldHVybiAiPHswfSB1cmw9J3sxfScgPiIuZm9ybWF0KHNlbGYuX19jbGFzc19fLl9fbmFtZV9fLCBzZWxmLnVybCkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBjb21tdW5pY2F0aW9uX2hhc19leHBpcmVkKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLmNvbW11bmljYXRpb25fbGFzdCArIHNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0IDwgdGltZS50aW1lKCkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBzaG91bGRfcmV0aXJlKHNlbGYpOgogICAgICAgIHJldHVybiBzZWxmLmNvbW11bmljYXRpb25faGFzX2V4cGlyZWQgb3Igc2VsZi5yZXF1ZXN0X3JldGlyZQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBmcm9tX3JlcXVlc3QocmVxdWVzdCk6CiAgICAgICAgdXJsID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfVVJMKVsndmFsdWUnXQogICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCd0Y3AnKToKICAgICAgICAgICAgdHJhbnNwb3J0ID0gVGNwVHJhbnNwb3J0KHVybCkKICAgICAgICBlbGlmIHVybC5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgIHByb3h5ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfUFJPWFlfSE9TVCkuZ2V0KCd2YWx1ZScpCiAgICAgICAgICAgIHVzZXJfYWdlbnQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19VQSkuZ2V0KCd2YWx1ZScsIEhUVFBfVVNFUl9BR0VOVCkKICAgICAgICAgICAgaHR0cF9oZWFkZXJzID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfSEVBREVSUykuZ2V0KCd2YWx1ZScsIE5vbmUpCiAgICAgICAgICAgIHRyYW5zcG9ydCA9IEh0dHBUcmFuc3BvcnQodXJsLCBwcm94eT1wcm94eSwgdXNlcl9hZ2VudD11c2VyX2FnZW50KQogICAgICAgICAgICBpZiBodHRwX2hlYWRlcnM6CiAgICAgICAgICAgICAgICBoZWFkZXJzID0ge30KICAgICAgICAgICAgICAgIGZvciBoIGluIGh0dHBfaGVhZGVycy5zdHJpcCgpLnNwbGl0KCJcclxuIik6CiAgICAgICAgICAgICAgICAgICAgcCA9IGguc3BsaXQoJzonKQogICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbcFswXS51cHBlcigpXSA9ICcnLmpvaW4ocFsxOjBdKQogICAgICAgICAgICAgICAgaHR0cF9ob3N0ID0gaGVhZGVycy5nZXQoJ0hPU1QnKQogICAgICAgICAgICAgICAgaHR0cF9jb29raWUgPSBoZWFkZXJzLmdldCgnQ09PS0lFJykKICAgICAgICAgICAgICAgIGh0dHBfcmVmZXJlciA9IGhlYWRlcnMuZ2V0KCdSRUZFUkVSJykKICAgICAgICAgICAgICAgIHRyYW5zcG9ydCA9IEh0dHBUcmFuc3BvcnQodXJsLCBwcm94eT1wcm94eSwgdXNlcl9hZ2VudD11c2VyX2FnZW50LCBodHRwX2hvc3Q9aHR0cF9ob3N0LAogICAgICAgICAgICAgICAgICAgICAgICBodHRwX2Nvb2tpZT1odHRwX2Nvb2tpZSwgaHR0cF9yZWZlcmVyPWh0dHBfcmVmZXJlcikKICAgICAgICB0cmFuc3BvcnQuY29tbXVuaWNhdGlvbl90aW1lb3V0ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfQ09NTV9USU1FT1VUKS5nZXQoJ3ZhbHVlJywgU0VTU0lPTl9DT01NVU5JQ0FUSU9OX1RJTUVPVVQpCiAgICAgICAgdHJhbnNwb3J0LnJldHJ5X3RvdGFsID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfUkVUUllfVE9UQUwpLmdldCgndmFsdWUnLCBTRVNTSU9OX1JFVFJZX1RPVEFMKQogICAgICAgIHRyYW5zcG9ydC5yZXRyeV93YWl0ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfUkVUUllfV0FJVCkuZ2V0KCd2YWx1ZScsIFNFU1NJT05fUkVUUllfV0FJVCkKICAgICAgICByZXR1cm4gdHJhbnNwb3J0CgogICAgZGVmIF9hY3RpdmF0ZShzZWxmKToKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBhY3RpdmF0ZShzZWxmKToKICAgICAgICBlbmRfdGltZSA9IHRpbWUudGltZSgpICsgc2VsZi5yZXRyeV90b3RhbAogICAgICAgIHdoaWxlIHRpbWUudGltZSgpIDwgZW5kX3RpbWU6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFjdGl2YXRlX3N1Y2NlZWRlZCA9IHNlbGYuX2FjdGl2YXRlKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWN0aXZhdGVfc3VjY2VlZGVkID0gRmFsc2UKICAgICAgICAgICAgaWYgYWN0aXZhdGVfc3VjY2VlZGVkOgogICAgICAgICAgICAgICAgc2VsZi5jb21tdW5pY2F0aW9uX2xhc3QgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgdGltZS5zbGVlcChzZWxmLnJldHJ5X3dhaXQpCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIF9kZWFjdGl2YXRlKHNlbGYpOgogICAgICAgIHJldHVybgoKICAgIGRlZiBkZWFjdGl2YXRlKHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5fZGVhY3RpdmF0ZSgpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgc2VsZi5jb21tdW5pY2F0aW9uX2xhc3QgPSAwCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgZGVjcnlwdF9wYWNrZXQoc2VsZiwgcGt0KToKICAgICAgICBpZiBwa3QgYW5kIGxlbihwa3QpID4gUEFDS0VUX0hFQURFUl9TSVpFOgogICAgICAgICAgICAjIFdlIGRvbid0IHN1cHBvcnQgQUVTIGVuY3J5cHRpb24geWV0LCBzbyBqdXN0IGRvIHRoZSBub3JtYWwKICAgICAgICAgICAgIyBYT1IgdGhpbmcgYW5kIG1vdmUgb24KICAgICAgICAgICAgeG9yX2tleSA9IHN0cnVjdC51bnBhY2soJ0JCQkInLCBwa3RbOlBBQ0tFVF9YT1JfS0VZX1NJWkVdKQogICAgICAgICAgICByYXcgPSB4b3JfYnl0ZXMoeG9yX2tleSwgcGt0KQogICAgICAgICAgICByZXR1cm4gcmF3W1BBQ0tFVF9IRUFERVJfU0laRTpdCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgZ2V0X3BhY2tldChzZWxmKToKICAgICAgICBzZWxmLnJlcXVlc3RfcmV0aXJlID0gRmFsc2UKICAgICAgICB0cnk6CiAgICAgICAgICAgIHBrdCA9IHNlbGYuZGVjcnlwdF9wYWNrZXQoc2VsZi5fZ2V0X3BhY2tldCgpKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgZGVidWdfdHJhY2ViYWNrKCkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBpZiBwa3QgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICBzZWxmLmNvbW11bmljYXRpb25fbGFzdCA9IHRpbWUudGltZSgpCiAgICAgICAgcmV0dXJuIHBrdAoKICAgIGRlZiBlbmNyeXB0X3BhY2tldChzZWxmLCBwa3QpOgogICAgICAgICMgVGhlIHBhY2tldCBub3cgaGFzIHRvIGNvbnRhaW4gc2Vzc2lvbiBHVUlEIGFuZCBlbmNyeXB0aW9uIGZsYWcgaW5mbwogICAgICAgICMgQW5kIGdpdmVuIHRoYXQgd2UncmUgbm90IHlldCBzdXBwb3J0aW5nIEFFUywgd2UncmUgZ29pbmcgdG8ganVzdAogICAgICAgICMgYWx3YXlzIHJldHVybiB0aGUgc2Vzc2lvbiBndWlkIGFuZCB0aGUgZW5jcnlwdGlvbiBmbGFnIHNldCB0byAwCiAgICAgICAgIyBUT0RPOiB3ZSdsbCBhZGQgZW5jcnlwdGlvbiBzb29uIQogICAgICAgIHhvcl9rZXkgPSByYW5kX3hvcl9rZXkoKQogICAgICAgIHJhdyA9IGJpbmFzY2lpLmEyYl9oZXgoYnl0ZXMoU0VTU0lPTl9HVUlELCAnVVRGLTgnKSkgKyBzdHJ1Y3QucGFjaygnPkknLCBFTkNfTk9ORSkgKyBwa3QKICAgICAgICByZXN1bHQgPSBzdHJ1Y3QucGFjaygnQkJCQicsICp4b3Jfa2V5KSArIHhvcl9ieXRlcyh4b3Jfa2V5LCByYXcpCiAgICAgICAgcmV0dXJuIHJlc3VsdAoKICAgIGRlZiBzZW5kX3BhY2tldChzZWxmLCBwa3QpOgogICAgICAgIHNlbGYucmVxdWVzdF9yZXRpcmUgPSBGYWxzZQogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5fc2VuZF9wYWNrZXQoc2VsZi5lbmNyeXB0X3BhY2tldChwa3QpKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgZGVidWdfdHJhY2ViYWNrKCkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgc2VsZi5jb21tdW5pY2F0aW9uX2xhc3QgPSB0aW1lLnRpbWUoKQogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIHRsdl9wYWNrX3RpbWVvdXRzKHNlbGYpOgogICAgICAgIHJlc3BvbnNlICA9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX0NPTU1fVElNRU9VVCwgc2VsZi5jb21tdW5pY2F0aW9uX3RpbWVvdXQpCiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfUkVUUllfVE9UQUwsIHNlbGYucmV0cnlfdG90YWwpCiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfUkVUUllfV0FJVCwgc2VsZi5yZXRyeV93YWl0KQogICAgICAgIHJldHVybiByZXNwb25zZQoKICAgIGRlZiB0bHZfcGFja190cmFuc3BvcnRfZ3JvdXAoc2VsZik6CiAgICAgICAgdHJhbnNfZ3JvdXAgID0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfVVJMLCBzZWxmLnVybCkKICAgICAgICB0cmFuc19ncm91cCArPSBzZWxmLnRsdl9wYWNrX3RpbWVvdXRzKCkKICAgICAgICByZXR1cm4gdHJhbnNfZ3JvdXAKCmNsYXNzIEh0dHBUcmFuc3BvcnQoVHJhbnNwb3J0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB1cmwsIHByb3h5PU5vbmUsIHVzZXJfYWdlbnQ9Tm9uZSwgaHR0cF9ob3N0PU5vbmUsIGh0dHBfcmVmZXJlcj1Ob25lLCBodHRwX2Nvb2tpZT1Ob25lKToKICAgICAgICBzdXBlcihIdHRwVHJhbnNwb3J0LCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgb3BlbmVyX2FyZ3MgPSBbXQogICAgICAgIHNjaGVtZSA9IHVybC5zcGxpdCgnOicsIDEpWzBdCiAgICAgICAgaWYgc2NoZW1lID09ICdodHRwcycgYW5kICgoc3lzLnZlcnNpb25faW5mb1swXSA9PSAyIGFuZCBzeXMudmVyc2lvbl9pbmZvID49ICgyLCA3LCA5KSkgb3Igc3lzLnZlcnNpb25faW5mbyA+PSAoMywgNCwgMykpOgogICAgICAgICAgICBpbXBvcnQgc3NsCiAgICAgICAgICAgIHNzbF9jdHggPSBzc2wuU1NMQ29udGV4dChzc2wuUFJPVE9DT0xfU1NMdjIzKQogICAgICAgICAgICBzc2xfY3R4LmNoZWNrX2hvc3RuYW1lID0gRmFsc2UKICAgICAgICAgICAgc3NsX2N0eC52ZXJpZnlfbW9kZSA9IHNzbC5DRVJUX05PTkUKICAgICAgICAgICAgb3BlbmVyX2FyZ3MuYXBwZW5kKHVybGxpYi5IVFRQU0hhbmRsZXIoMCwgc3NsX2N0eCkpCiAgICAgICAgaWYgcHJveHk6CiAgICAgICAgICAgIG9wZW5lcl9hcmdzLmFwcGVuZCh1cmxsaWIuUHJveHlIYW5kbGVyKHtzY2hlbWU6IHByb3h5fSkpCiAgICAgICAgc2VsZi5wcm94eSA9IHByb3h5CiAgICAgICAgb3BlbmVyID0gdXJsbGliLmJ1aWxkX29wZW5lcigqb3BlbmVyX2FyZ3MpCiAgICAgICAgb3BlbmVyLmFkZGhlYWRlcnMgPSBbXQogICAgICAgIGlmIHVzZXJfYWdlbnQ6CiAgICAgICAgICAgIG9wZW5lci5hZGRoZWFkZXJzLmFwcGVuZCgoJ1VzZXItQWdlbnQnLCB1c2VyX2FnZW50KSkKICAgICAgICBpZiBodHRwX2Nvb2tpZToKICAgICAgICAgICAgb3BlbmVyLmFkZGhlYWRlcnMuYXBwZW5kKCgnQ29va2llJywgaHR0cF9jb29raWUpKQogICAgICAgIGlmIGh0dHBfcmVmZXJlcjoKICAgICAgICAgICAgb3BlbmVyLmFkZGhlYWRlcnMuYXBwZW5kKCgnUmVmZXJlcicsIGh0dHBfcmVmZXJlcikpCiAgICAgICAgc2VsZi51c2VyX2FnZW50ID0gdXNlcl9hZ2VudAogICAgICAgIHVybGxpYi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICAgICAgc2VsZi51cmwgPSB1cmwKICAgICAgICBzZWxmLl9odHRwX3JlcXVlc3RfaGVhZGVycyA9IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSd9CiAgICAgICAgaWYgaHR0cF9ob3N0OgogICAgICAgICAgICBzZWxmLl9odHRwX3JlcXVlc3RfaGVhZGVyc1snSG9zdCddID0gaHR0cF9ob3N0CiAgICAgICAgc2VsZi5fZmlyc3RfcGFja2V0ID0gTm9uZQogICAgICAgIHNlbGYuX2VtcHR5X2NudCA9IDAKCiAgICBkZWYgX2FjdGl2YXRlKHNlbGYpOgogICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgc2VsZi5fZmlyc3RfcGFja2V0ID0gTm9uZQogICAgICAgIHBhY2tldCA9IHNlbGYuX2dldF9wYWNrZXQoKQogICAgICAgIGlmIHBhY2tldCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBzZWxmLl9maXJzdF9wYWNrZXQgPSBwYWNrZXQKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBfZ2V0X3BhY2tldChzZWxmKToKICAgICAgICBpZiBzZWxmLl9maXJzdF9wYWNrZXQ6CiAgICAgICAgICAgIHBhY2tldCA9IHNlbGYuX2ZpcnN0X3BhY2tldAogICAgICAgICAgICBzZWxmLl9maXJzdF9wYWNrZXQgPSBOb25lCiAgICAgICAgICAgIHJldHVybiBwYWNrZXQKICAgICAgICBwYWNrZXQgPSBOb25lCiAgICAgICAgeG9yX2tleSA9IE5vbmUKICAgICAgICByZXF1ZXN0ID0gdXJsbGliLlJlcXVlc3Qoc2VsZi51cmwsIE5vbmUsIHNlbGYuX2h0dHBfcmVxdWVzdF9oZWFkZXJzKQogICAgICAgIHRyeToKICAgICAgICAgICAgdXJsX2ggPSB1cmxsaWIudXJsb3BlbihyZXF1ZXN0LCB0aW1lb3V0PXNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0KQogICAgICAgICAgICBwYWNrZXQgPSB1cmxfaC5yZWFkKCkKICAgICAgICAgICAgZm9yIF8gaW4gcmFuZ2UoMSk6CiAgICAgICAgICAgICAgICBpZiBwYWNrZXQgPT0gJyc6CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGlmIGxlbihwYWNrZXQpIDwgUEFDS0VUX0hFQURFUl9TSVpFOgogICAgICAgICAgICAgICAgICAgIHBhY2tldCA9IE5vbmUgICMgbG9va3MgY29ycnVwdAogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICB4b3Jfa2V5ID0gc3RydWN0LnVucGFjaygnQkJCQicsIHBhY2tldFs6UEFDS0VUX1hPUl9LRVlfU0laRV0pCiAgICAgICAgICAgICAgICBoZWFkZXIgPSB4b3JfYnl0ZXMoeG9yX2tleSwgcGFja2V0WzpQQUNLRVRfSEVBREVSX1NJWkVdKQogICAgICAgICAgICAgICAgcGt0X2xlbmd0aCA9IHN0cnVjdC51bnBhY2soJz5JJywgaGVhZGVyW1BBQ0tFVF9MRU5HVEhfT0ZGOlBBQ0tFVF9MRU5HVEhfT0ZGK1BBQ0tFVF9MRU5HVEhfU0laRV0pWzBdIC0gOAogICAgICAgICAgICAgICAgaWYgbGVuKHBhY2tldCkgIT0gKHBrdF9sZW5ndGggKyBQQUNLRVRfSEVBREVSX1NJWkUpOgogICAgICAgICAgICAgICAgICAgIHBhY2tldCA9IE5vbmUgICMgbG9va3MgY29ycnVwdAogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgZGVidWdfdHJhY2ViYWNrKCdGYWlsdXJlIHRvIHJlY2VpdmUgcGFja2V0IGZyb20gJyArIHNlbGYudXJsKQoKICAgICAgICBpZiBub3QgcGFja2V0OgogICAgICAgICAgICBkZWxheSA9IDEwICogc2VsZi5fZW1wdHlfY250CiAgICAgICAgICAgIGlmIHNlbGYuX2VtcHR5X2NudCA+PSAwOgogICAgICAgICAgICAgICAgZGVsYXkgKj0gMTAKICAgICAgICAgICAgc2VsZi5fZW1wdHlfY250ICs9IDEKICAgICAgICAgICAgdGltZS5zbGVlcChmbG9hdChtaW4oMTAwMDAsIGRlbGF5KSkgLyAxMDAwKQogICAgICAgICAgICByZXR1cm4gcGFja2V0CgogICAgICAgIHNlbGYuX2VtcHR5X2NudCA9IDAKICAgICAgICByZXR1cm4gcGFja2V0CgogICAgZGVmIF9zZW5kX3BhY2tldChzZWxmLCBwYWNrZXQpOgogICAgICAgIHJlcXVlc3QgPSB1cmxsaWIuUmVxdWVzdChzZWxmLnVybCwgcGFja2V0LCBzZWxmLl9odHRwX3JlcXVlc3RfaGVhZGVycykKICAgICAgICB1cmxfaCA9IHVybGxpYi51cmxvcGVuKHJlcXVlc3QsIHRpbWVvdXQ9c2VsZi5jb21tdW5pY2F0aW9uX3RpbWVvdXQpCiAgICAgICAgcmVzcG9uc2UgPSB1cmxfaC5yZWFkKCkKCiAgICBkZWYgcGF0Y2hfdXJpX3BhdGgoc2VsZiwgbmV3X3BhdGgpOgogICAgICAgIG1hdGNoID0gcmUubWF0Y2gocidodHRwcz86Ly9bXi9dKygvLiokKScsIHNlbGYudXJsKQogICAgICAgIGlmIG1hdGNoIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIHNlbGYudXJsID0gc2VsZi51cmxbOm1hdGNoLnNwYW4oMSlbMF1dICsgbmV3X3BhdGgKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiB0bHZfcGFja190cmFuc3BvcnRfZ3JvdXAoc2VsZik6CiAgICAgICAgdHJhbnNfZ3JvdXAgID0gc3VwZXIoSHR0cFRyYW5zcG9ydCwgc2VsZikudGx2X3BhY2tfdHJhbnNwb3J0X2dyb3VwKCkKICAgICAgICBpZiBzZWxmLnVzZXJfYWdlbnQ6CiAgICAgICAgICAgIHRyYW5zX2dyb3VwICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1VBLCBzZWxmLnVzZXJfYWdlbnQpCiAgICAgICAgaWYgc2VsZi5wcm94eToKICAgICAgICAgICAgdHJhbnNfZ3JvdXAgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfUFJPWFlfSE9TVCwgc2VsZi5wcm94eSkKICAgICAgICByZXR1cm4gdHJhbnNfZ3JvdXAKCmNsYXNzIFRjcFRyYW5zcG9ydChUcmFuc3BvcnQpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHVybCwgc29ja2V0PU5vbmUpOgogICAgICAgIHN1cGVyKFRjcFRyYW5zcG9ydCwgc2VsZikuX19pbml0X18oKQogICAgICAgIHNlbGYudXJsID0gdXJsCiAgICAgICAgc2VsZi5zb2NrZXQgPSBzb2NrZXQKICAgICAgICBzZWxmLl9jbGVhbnVwX3RocmVhZCA9IE5vbmUKICAgICAgICBzZWxmLl9maXJzdF9wYWNrZXQgPSBUcnVlCgogICAgZGVmIF9zb2NrX2NsZWFudXAoc2VsZiwgc29jayk6CiAgICAgICAgcmVtYWluaW5nX3RpbWUgPSBzZWxmLmNvbW11bmljYXRpb25fdGltZW91dAogICAgICAgIHdoaWxlIHJlbWFpbmluZ190aW1lID4gMDoKICAgICAgICAgICAgaXRlcl9zdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgaWYgc2VsZWN0LnNlbGVjdChbc29ja10sIFtdLCBbXSwgcmVtYWluaW5nX3RpbWUpWzBdOgogICAgICAgICAgICAgICAgaWYgbGVuKHNvY2sucmVjdig0MDk2KSkgPT0gMDoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICByZW1haW5pbmdfdGltZSAtPSB0aW1lLnRpbWUoKSAtIGl0ZXJfc3RhcnRfdGltZQogICAgICAgIHNvY2suY2xvc2UoKQoKICAgIGRlZiBfYWN0aXZhdGUoc2VsZik6CiAgICAgICAgYWRkcmVzcywgcG9ydCA9IHNlbGYudXJsWzY6XS5yc3BsaXQoJzonLCAxKQogICAgICAgIHBvcnQgPSBpbnQocG9ydC5yc3RyaXAoJy8nKSkKICAgICAgICB0aW1lb3V0ID0gbWF4KHNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0LCAzMCkKICAgICAgICBpZiBhZGRyZXNzIGluICgnJywgJzAuMC4wLjAnLCAnOjonKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VydmVyX3NvY2sgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVUNiwgc29ja2V0LlNPQ0tfU1RSRUFNKQogICAgICAgICAgICAgICAgc2VydmVyX3NvY2suc2V0c29ja29wdChzb2NrZXQuSVBQUk9UT19JUFY2LCBzb2NrZXQuSVBWNl9WNk9OTFksIDApCiAgICAgICAgICAgIGV4Y2VwdCAoQXR0cmlidXRlRXJyb3IsIHNvY2tldC5lcnJvcik6CiAgICAgICAgICAgICAgICBzZXJ2ZXJfc29jayA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX1NUUkVBTSkKICAgICAgICAgICAgc2VydmVyX3NvY2suYmluZCgoJycsIHBvcnQpKQogICAgICAgICAgICBzZXJ2ZXJfc29jay5saXN0ZW4oMSkKICAgICAgICAgICAgaWYgbm90IHNlbGVjdC5zZWxlY3QoW3NlcnZlcl9zb2NrXSwgW10sIFtdLCB0aW1lb3V0KVswXToKICAgICAgICAgICAgICAgIHNlcnZlcl9zb2NrLmNsb3NlKCkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBzb2NrLCBfID0gc2VydmVyX3NvY2suYWNjZXB0KCkKICAgICAgICAgICAgc2VydmVyX3NvY2suY2xvc2UoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmICc6JyBpbiBhZGRyZXNzOgogICAgICAgICAgICAgICAgc29jayA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQ2LCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzb2NrID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfU1RSRUFNKQogICAgICAgICAgICBzb2NrLnNldHRpbWVvdXQodGltZW91dCkKICAgICAgICAgICAgc29jay5jb25uZWN0KChhZGRyZXNzLCBwb3J0KSkKICAgICAgICAgICAgc29jay5zZXR0aW1lb3V0KE5vbmUpCiAgICAgICAgc2VsZi5zb2NrZXQgPSBzb2NrCiAgICAgICAgc2VsZi5fZmlyc3RfcGFja2V0ID0gVHJ1ZQogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIF9kZWFjdGl2YXRlKHNlbGYpOgogICAgICAgIGNsZWFudXAgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1zZWxmLl9zb2NrX2NsZWFudXAsIGFyZ3M9KHNlbGYuc29ja2V0LCkpCiAgICAgICAgY2xlYW51cC5ydW4oKQogICAgICAgIHNlbGYuc29ja2V0ID0gTm9uZQoKICAgIGRlZiBfZ2V0X3BhY2tldChzZWxmKToKICAgICAgICBmaXJzdCA9IHNlbGYuX2ZpcnN0X3BhY2tldAogICAgICAgIHNlbGYuX2ZpcnN0X3BhY2tldCA9IEZhbHNlCiAgICAgICAgaWYgbm90IHNlbGVjdC5zZWxlY3QoW3NlbGYuc29ja2V0XSwgW10sIFtdLCAwLjUpWzBdOgogICAgICAgICAgICByZXR1cm4gYnl0ZXMoKQogICAgICAgIHBhY2tldCA9IHNlbGYuc29ja2V0LnJlY3YoUEFDS0VUX0hFQURFUl9TSVpFKQogICAgICAgIGlmIHBhY2tldCA9PSAnJzogICMgcmVtb3RlIGlzIGNsb3NlZAogICAgICAgICAgICBzZWxmLnJlcXVlc3RfcmV0aXJlID0gVHJ1ZQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGlmIGxlbihwYWNrZXQpICE9IFBBQ0tFVF9IRUFERVJfU0laRToKICAgICAgICAgICAgaWYgZmlyc3QgYW5kIGxlbihwYWNrZXQpID09IDQ6CiAgICAgICAgICAgICAgICByZWNlaXZlZCA9IDAKICAgICAgICAgICAgICAgIGhlYWRlciA9IHBhY2tldFs6NF0KICAgICAgICAgICAgICAgIHBrdF9sZW5ndGggPSBzdHJ1Y3QudW5wYWNrKCc+SScsIGhlYWRlcilbMF0KICAgICAgICAgICAgICAgIHNlbGYuc29ja2V0LnNldHRpbWVvdXQobWF4KHNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0LCAzMCkpCiAgICAgICAgICAgICAgICB3aGlsZSByZWNlaXZlZCA8IHBrdF9sZW5ndGg6CiAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQgKz0gbGVuKHNlbGYuc29ja2V0LnJlY3YocGt0X2xlbmd0aCAtIHJlY2VpdmVkKSkKICAgICAgICAgICAgICAgIHNlbGYuc29ja2V0LnNldHRpbWVvdXQoTm9uZSkKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLl9nZXRfcGFja2V0KCkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgeG9yX2tleSA9IHN0cnVjdC51bnBhY2soJ0JCQkInLCBwYWNrZXRbOlBBQ0tFVF9YT1JfS0VZX1NJWkVdKQogICAgICAgICMgWE9SIHRoZSB3aG9sZSBoZWFkZXIgZmlyc3QKICAgICAgICBoZWFkZXIgPSB4b3JfYnl0ZXMoeG9yX2tleSwgcGFja2V0WzpQQUNLRVRfSEVBREVSX1NJWkVdKQogICAgICAgICMgRXh0cmFjdCBqdXN0IHRoZSBsZW5ndGgKICAgICAgICBwa3RfbGVuZ3RoID0gc3RydWN0LnVucGFjaygnPkknLCBoZWFkZXJbUEFDS0VUX0xFTkdUSF9PRkY6UEFDS0VUX0xFTkdUSF9PRkYrUEFDS0VUX0xFTkdUSF9TSVpFXSlbMF0KICAgICAgICBwa3RfbGVuZ3RoIC09IDgKICAgICAgICAjIFJlYWQgdGhlIHJlc3Qgb2YgdGhlIHBhY2tldAogICAgICAgIHJlc3QgPSBieXRlcygpCiAgICAgICAgd2hpbGUgbGVuKHJlc3QpIDwgcGt0X2xlbmd0aDoKICAgICAgICAgICAgcmVzdCArPSBzZWxmLnNvY2tldC5yZWN2KHBrdF9sZW5ndGggLSBsZW4ocmVzdCkpCiAgICAgICAgIyByZXR1cm4gdGhlIHdob2xlIHBhY2tldCwgYXMgaXQncyBkZWNvZGVkIHNlcGFyYXRlbHkKICAgICAgICByZXR1cm4gcGFja2V0ICsgcmVzdAoKICAgIGRlZiBfc2VuZF9wYWNrZXQoc2VsZiwgcGFja2V0KToKICAgICAgICBzZWxmLnNvY2tldC5zZW5kKHBhY2tldCkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBmcm9tX3NvY2tldChjbHMsIHNvY2spOgogICAgICAgIHVybCA9ICd0Y3A6Ly8nCiAgICAgICAgYWRkcmVzcywgcG9ydCA9IHNvY2suZ2V0c29ja25hbWUoKVs6Ml0KICAgICAgICAjIHRoaXMgd2lsbCBuZWVkIHRvIGJlIGNoYW5nZWQgaWYgdGhlIGJpbmQgc3RhZ2VyIGV2ZXIgc3VwcG9ydHMgYmluZGluZyB0byBhIHNwZWNpZmljIGFkZHJlc3MKICAgICAgICBpZiBub3QgYWRkcmVzcyBpbiAoJycsICcwLjAuMC4wJywgJzo6Jyk6CiAgICAgICAgICAgIGFkZHJlc3MsIHBvcnQgPSBzb2NrLmdldHBlZXJuYW1lKClbOjJdCiAgICAgICAgdXJsICs9IGFkZHJlc3MgKyAnOicgKyBzdHIocG9ydCkKICAgICAgICByZXR1cm4gY2xzKHVybCwgc29jaykKCmNsYXNzIFB5dGhvbk1ldGVycHJldGVyKG9iamVjdCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgdHJhbnNwb3J0KToKICAgICAgICBzZWxmLnRyYW5zcG9ydCA9IHRyYW5zcG9ydAogICAgICAgIHNlbGYuX3RyYW5zcG9ydF9zbGVlcCA9IE5vbmUKICAgICAgICBzZWxmLnJ1bm5pbmcgPSBGYWxzZQogICAgICAgIHNlbGYubGFzdF9yZWdpc3RlcmVkX2V4dGVuc2lvbiA9IE5vbmUKICAgICAgICBzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnMgPSB7fQogICAgICAgIHNlbGYuY2hhbm5lbHMgPSB7fQogICAgICAgIHNlbGYubmV4dF9jaGFubmVsX2lkID0gMQogICAgICAgIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHMgPSBbXQogICAgICAgIHNlbGYucHJvY2Vzc2VzID0ge30KICAgICAgICBzZWxmLm5leHRfcHJvY2Vzc19pZCA9IDEKICAgICAgICBzZWxmLnRyYW5zcG9ydHMgPSBbc2VsZi50cmFuc3BvcnRdCiAgICAgICAgc2VsZi5zZXNzaW9uX2V4cGlyeV90aW1lID0gU0VTU0lPTl9FWFBJUkFUSU9OX1RJTUVPVVQKICAgICAgICBzZWxmLnNlc3Npb25fZXhwaXJ5X2VuZCA9IHRpbWUudGltZSgpICsgc2VsZi5zZXNzaW9uX2V4cGlyeV90aW1lCiAgICAgICAgZm9yIGZ1bmMgaW4gbGlzdChmaWx0ZXIobGFtYmRhIHg6IHguc3RhcnRzd2l0aCgnX2NvcmUnKSwgZGlyKHNlbGYpKSk6CiAgICAgICAgICAgIHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9uc1tmdW5jWzE6XV0gPSBnZXRhdHRyKHNlbGYsIGZ1bmMpCiAgICAgICAgc2VsZi5ydW5uaW5nID0gVHJ1ZQoKICAgIGRlZiByZWdpc3Rlcl9leHRlbnNpb24oc2VsZiwgZXh0ZW5zaW9uX25hbWUpOgogICAgICAgIHNlbGYubGFzdF9yZWdpc3RlcmVkX2V4dGVuc2lvbiA9IGV4dGVuc2lvbl9uYW1lCiAgICAgICAgcmV0dXJuIHNlbGYubGFzdF9yZWdpc3RlcmVkX2V4dGVuc2lvbgoKICAgIGRlZiByZWdpc3Rlcl9mdW5jdGlvbihzZWxmLCBmdW5jKToKICAgICAgICBzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnNbZnVuYy5fX25hbWVfX10gPSBmdW5jCiAgICAgICAgcmV0dXJuIGZ1bmMKCiAgICBkZWYgcmVnaXN0ZXJfZnVuY3Rpb25faWYoc2VsZiwgY29uZGl0aW9uKToKICAgICAgICBpZiBjb25kaXRpb246CiAgICAgICAgICAgIHJldHVybiBzZWxmLnJlZ2lzdGVyX2Z1bmN0aW9uCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIGxhbWJkYSBmdW5jdGlvbjogZnVuY3Rpb24KCiAgICBkZWYgcmVnaXN0ZXJfZnVuY3Rpb25fd2luZGxsKHNlbGYsIGZ1bmMpOgogICAgICAgIGlmIGhhc193aW5kbGw6CiAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJfZnVuY3Rpb24oZnVuYykKICAgICAgICByZXR1cm4gZnVuYwoKICAgIGRlZiBhZGRfY2hhbm5lbChzZWxmLCBjaGFubmVsKToKICAgICAgICBhc3NlcnQoaXNpbnN0YW5jZShjaGFubmVsLCAoc3VicHJvY2Vzcy5Qb3BlbiwgTWV0ZXJwcmV0ZXJGaWxlLCBNZXRlcnByZXRlclNvY2tldCkpKQogICAgICAgIGlkeCA9IHNlbGYubmV4dF9jaGFubmVsX2lkCiAgICAgICAgc2VsZi5jaGFubmVsc1tpZHhdID0gY2hhbm5lbAogICAgICAgIGRlYnVnX3ByaW50KCdbKl0gYWRkZWQgY2hhbm5lbCBpZDogJyArIHN0cihpZHgpICsgJyB0eXBlOiAnICsgY2hhbm5lbC5fX2NsYXNzX18uX19uYW1lX18pCiAgICAgICAgc2VsZi5uZXh0X2NoYW5uZWxfaWQgKz0gMQogICAgICAgIHJldHVybiBpZHgKCiAgICBkZWYgYWRkX3Byb2Nlc3Moc2VsZiwgcHJvY2Vzcyk6CiAgICAgICAgaWR4ID0gc2VsZi5uZXh0X3Byb2Nlc3NfaWQKICAgICAgICBzZWxmLnByb2Nlc3Nlc1tpZHhdID0gcHJvY2VzcwogICAgICAgIGRlYnVnX3ByaW50KCdbKl0gYWRkZWQgcHJvY2VzcyBpZDogJyArIHN0cihpZHgpKQogICAgICAgIHNlbGYubmV4dF9wcm9jZXNzX2lkICs9IDEKICAgICAgICByZXR1cm4gaWR4CgogICAgZGVmIGdldF9wYWNrZXQoc2VsZik6CiAgICAgICAgcGt0ID0gc2VsZi50cmFuc3BvcnQuZ2V0X3BhY2tldCgpCiAgICAgICAgaWYgcGt0IGlzIE5vbmUgYW5kIHNlbGYudHJhbnNwb3J0LnNob3VsZF9yZXRpcmU6CiAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0X2NoYW5nZSgpCiAgICAgICAgcmV0dXJuIHBrdAoKICAgIGRlZiBzZW5kX3BhY2tldChzZWxmLCBwYWNrZXQpOgogICAgICAgIHNlbmRfc3VjY2VlZGVkID0gc2VsZi50cmFuc3BvcnQuc2VuZF9wYWNrZXQocGFja2V0KQogICAgICAgIGlmIG5vdCBzZW5kX3N1Y2NlZWRlZCBhbmQgc2VsZi50cmFuc3BvcnQuc2hvdWxkX3JldGlyZToKICAgICAgICAgICAgc2VsZi50cmFuc3BvcnRfY2hhbmdlKCkKICAgICAgICByZXR1cm4gc2VuZF9zdWNjZWVkZWQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBzZXNzaW9uX2hhc19leHBpcmVkKHNlbGYpOgogICAgICAgIGlmIHNlbGYuc2Vzc2lvbl9leHBpcnlfdGltZSA9PSAwOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICByZXR1cm4gdGltZS50aW1lKCkgPiBzZWxmLnNlc3Npb25fZXhwaXJ5X2VuZAoKICAgIGRlZiB0cmFuc3BvcnRfYWRkKHNlbGYsIG5ld190cmFuc3BvcnQpOgogICAgICAgIG5ld19wb3NpdGlvbiA9IHNlbGYudHJhbnNwb3J0cy5pbmRleChzZWxmLnRyYW5zcG9ydCkKICAgICAgICBzZWxmLnRyYW5zcG9ydHMuaW5zZXJ0KG5ld19wb3NpdGlvbiwgbmV3X3RyYW5zcG9ydCkKCiAgICBkZWYgdHJhbnNwb3J0X2NoYW5nZShzZWxmLCBuZXdfdHJhbnNwb3J0PU5vbmUpOgogICAgICAgIGlmIG5ld190cmFuc3BvcnQgaXMgTm9uZToKICAgICAgICAgICAgbmV3X3RyYW5zcG9ydCA9IHNlbGYudHJhbnNwb3J0X25leHQoKQogICAgICAgIHNlbGYudHJhbnNwb3J0LmRlYWN0aXZhdGUoKQogICAgICAgIGRlYnVnX3ByaW50KCdbKl0gY2hhbmdpbmcgdHJhbnNwb3J0IHRvOiAnICsgbmV3X3RyYW5zcG9ydC51cmwpCiAgICAgICAgd2hpbGUgbm90IG5ld190cmFuc3BvcnQuYWN0aXZhdGUoKToKICAgICAgICAgICAgbmV3X3RyYW5zcG9ydCA9IHNlbGYudHJhbnNwb3J0X25leHQobmV3X3RyYW5zcG9ydCkKICAgICAgICAgICAgZGVidWdfcHJpbnQoJ1sqXSBjaGFuZ2luZyB0cmFuc3BvcnQgdG86ICcgKyBuZXdfdHJhbnNwb3J0LnVybCkKICAgICAgICBzZWxmLnRyYW5zcG9ydCA9IG5ld190cmFuc3BvcnQKCiAgICBkZWYgdHJhbnNwb3J0X25leHQoc2VsZiwgY3VycmVudF90cmFuc3BvcnQ9Tm9uZSk6CiAgICAgICAgaWYgY3VycmVudF90cmFuc3BvcnQgaXMgTm9uZToKICAgICAgICAgICAgY3VycmVudF90cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydAogICAgICAgIG5ld19pZHggPSBzZWxmLnRyYW5zcG9ydHMuaW5kZXgoY3VycmVudF90cmFuc3BvcnQpICsgMQogICAgICAgIGlmIG5ld19pZHggPT0gbGVuKHNlbGYudHJhbnNwb3J0cyk6CiAgICAgICAgICAgIG5ld19pZHggPSAwCiAgICAgICAgcmV0dXJuIHNlbGYudHJhbnNwb3J0c1tuZXdfaWR4XQoKICAgIGRlZiB0cmFuc3BvcnRfcHJldihzZWxmLCBjdXJyZW50X3RyYW5zcG9ydD1Ob25lKToKICAgICAgICBpZiBjdXJyZW50X3RyYW5zcG9ydCBpcyBOb25lOgogICAgICAgICAgICBjdXJyZW50X3RyYW5zcG9ydCA9IHNlbGYudHJhbnNwb3J0CiAgICAgICAgbmV3X2lkeCA9IHNlbGYudHJhbnNwb3J0cy5pbmRleChjdXJyZW50X3RyYW5zcG9ydCkgLSAxCiAgICAgICAgaWYgbmV3X2lkeCA9PSAtMToKICAgICAgICAgICAgbmV3X2lkeCA9IGxlbihzZWxmLnRyYW5zcG9ydHMpIC0gMQogICAgICAgIHJldHVybiBzZWxmLnRyYW5zcG9ydHNbbmV3X2lkeF0KCiAgICBkZWYgcnVuKHNlbGYpOgogICAgICAgIHdoaWxlIHNlbGYucnVubmluZyBhbmQgbm90IHNlbGYuc2Vzc2lvbl9oYXNfZXhwaXJlZDoKICAgICAgICAgICAgcmVxdWVzdCA9IHNlbGYuZ2V0X3BhY2tldCgpCiAgICAgICAgICAgIGlmIHJlcXVlc3Q6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHNlbGYuY3JlYXRlX3Jlc3BvbnNlKHJlcXVlc3QpCiAgICAgICAgICAgICAgICBpZiByZXNwb25zZToKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcGFja2V0KHJlc3BvbnNlKQogICAgICAgICAgICAgICAgaWYgc2VsZi5fdHJhbnNwb3J0X3NsZWVwOgogICAgICAgICAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0LmRlYWN0aXZhdGUoKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoc2VsZi5fdHJhbnNwb3J0X3NsZWVwKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3RyYW5zcG9ydF9zbGVlcCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgc2VsZi50cmFuc3BvcnQuYWN0aXZhdGUoKToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50cmFuc3BvcnRfY2hhbmdlKCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICMgaXRlcmF0ZSBvdmVyIHRoZSBrZXlzIGJlY2F1c2Ugc2VsZi5jaGFubmVscyBjb3VsZCBiZSBtb2RpZmllZCBpZiBvbmUgaXMgY2xvc2VkCiAgICAgICAgICAgIGNoYW5uZWxfaWRzID0gbGlzdChzZWxmLmNoYW5uZWxzLmtleXMoKSkKICAgICAgICAgICAgZm9yIGNoYW5uZWxfaWQgaW4gY2hhbm5lbF9pZHM6CiAgICAgICAgICAgICAgICBjaGFubmVsID0gc2VsZi5jaGFubmVsc1tjaGFubmVsX2lkXQogICAgICAgICAgICAgICAgZGF0YSA9IGJ5dGVzKCkKICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgU1REUHJvY2Vzcyk6CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWxfaWQgaW4gc2VsZi5pbnRlcmFjdF9jaGFubmVsczoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICBpZiBjaGFubmVsLnN0ZGVycl9yZWFkZXIuaXNfcmVhZF9yZWFkeSgpOgogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gY2hhbm5lbC5zdGRlcnJfcmVhZGVyLnJlYWQoKQogICAgICAgICAgICAgICAgICAgIGVsaWYgY2hhbm5lbC5zdGRvdXRfcmVhZGVyLmlzX3JlYWRfcmVhZHkoKToKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGNoYW5uZWwuc3Rkb3V0X3JlYWRlci5yZWFkKCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNoYW5uZWwucG9sbCgpICE9IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlX2RlYWRfcmVzb3VyY2VfY2hhbm5lbChjaGFubmVsX2lkKQogICAgICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKGNoYW5uZWwsIE1ldGVycHJldGVyU29ja2V0Q2xpZW50KToKICAgICAgICAgICAgICAgICAgICB3aGlsZSBzZWxlY3Quc2VsZWN0KFtjaGFubmVsLmZpbGVubygpXSwgW10sIFtdLCAwKVswXToKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGNoYW5uZWwucmVjdigxKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgc29ja2V0LmVycm9yOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZCA9IGJ5dGVzKCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGQpID09IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZV9kZWFkX3Jlc291cmNlX2NoYW5uZWwoY2hhbm5lbF9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgKz0gZAogICAgICAgICAgICAgICAgZWxpZiBpc2luc3RhbmNlKGNoYW5uZWwsIE1ldGVycHJldGVyU29ja2V0U2VydmVyKToKICAgICAgICAgICAgICAgICAgICBpZiBzZWxlY3Quc2VsZWN0KFtjaGFubmVsLmZpbGVubygpXSwgW10sIFtdLCAwKVswXToKICAgICAgICAgICAgICAgICAgICAgICAgKGNsaWVudF9zb2NrLCBjbGllbnRfYWRkcikgPSBjaGFubmVsLmFjY2VwdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcnZlcl9hZGRyID0gY2hhbm5lbC5nZXRzb2NrbmFtZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudF9jaGFubmVsX2lkID0gc2VsZi5hZGRfY2hhbm5lbChNZXRlcnByZXRlclNvY2tldENsaWVudChjbGllbnRfc29jaykpCiAgICAgICAgICAgICAgICAgICAgICAgIHBrdCAgPSBzdHJ1Y3QucGFjaygnPkknLCBQQUNLRVRfVFlQRV9SRVFVRVNUKQogICAgICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfTUVUSE9ELCAndGNwX2NoYW5uZWxfb3BlbicpCiAgICAgICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9VVUlELCBiaW5hc2NpaS5hMmJfaGV4KGJ5dGVzKFBBWUxPQURfVVVJRCwgJ1VURi04JykpKQogICAgICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfQ0hBTk5FTF9JRCwgY2xpZW50X2NoYW5uZWxfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9DSEFOTkVMX1BBUkVOVElELCBjaGFubmVsX2lkKQogICAgICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfTE9DQUxfSE9TVCwgaW5ldF9wdG9uKGNoYW5uZWwuZmFtaWx5LCBzZXJ2ZXJfYWRkclswXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9MT0NBTF9QT1JULCBzZXJ2ZXJfYWRkclsxXSkKICAgICAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX1BFRVJfSE9TVCwgaW5ldF9wdG9uKGNsaWVudF9zb2NrLmZhbWlseSwgY2xpZW50X2FkZHJbMF0pKQogICAgICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfUEVFUl9QT1JULCBjbGllbnRfYWRkclsxXSkKICAgICAgICAgICAgICAgICAgICAgICAgcGt0ICA9IHN0cnVjdC5wYWNrKCc+SScsIGxlbihwa3QpICsgNCkgKyBwa3QKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kX3BhY2tldChwa3QpCiAgICAgICAgICAgICAgICBpZiBkYXRhOgogICAgICAgICAgICAgICAgICAgIHBrdCAgPSBzdHJ1Y3QucGFjaygnPkknLCBQQUNLRVRfVFlQRV9SRVFVRVNUKQogICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9NRVRIT0QsICdjb3JlX2NoYW5uZWxfd3JpdGUnKQogICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9VVUlELCBiaW5hc2NpaS5hMmJfaGV4KGJ5dGVzKFBBWUxPQURfVVVJRCwgJ1VURi04JykpKQogICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9DSEFOTkVMX0lELCBjaGFubmVsX2lkKQogICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9DSEFOTkVMX0RBVEEsIGRhdGEpCiAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX0xFTkdUSCwgbGVuKGRhdGEpKQogICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9SRVFVRVNUX0lELCBnZW5lcmF0ZV9yZXF1ZXN0X2lkKCkpCiAgICAgICAgICAgICAgICAgICAgcGt0ICA9IHN0cnVjdC5wYWNrKCc+SScsIGxlbihwa3QpICsgNCkgKyBwa3QKICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcGFja2V0KHBrdCkKCiAgICBkZWYgaGFuZGxlX2RlYWRfcmVzb3VyY2VfY2hhbm5lbChzZWxmLCBjaGFubmVsX2lkKToKICAgICAgICBkZWwgc2VsZi5jaGFubmVsc1tjaGFubmVsX2lkXQogICAgICAgIGlmIGNoYW5uZWxfaWQgaW4gc2VsZi5pbnRlcmFjdF9jaGFubmVsczoKICAgICAgICAgICAgc2VsZi5pbnRlcmFjdF9jaGFubmVscy5yZW1vdmUoY2hhbm5lbF9pZCkKICAgICAgICBwa3QgID0gc3RydWN0LnBhY2soJz5JJywgUEFDS0VUX1RZUEVfUkVRVUVTVCkKICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfTUVUSE9ELCAnY29yZV9jaGFubmVsX2Nsb3NlJykKICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfVVVJRCwgYmluYXNjaWkuYTJiX2hleChieXRlcyhQQVlMT0FEX1VVSUQsICdVVEYtOCcpKSkKICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfUkVRVUVTVF9JRCwgZ2VuZXJhdGVfcmVxdWVzdF9pZCgpKQogICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9DSEFOTkVMX0lELCBjaGFubmVsX2lkKQogICAgICAgIHBrdCAgPSBzdHJ1Y3QucGFjaygnPkknLCBsZW4ocGt0KSArIDQpICsgcGt0CiAgICAgICAgc2VsZi5zZW5kX3BhY2tldChwa3QpCgogICAgZGVmIF9jb3JlX3NldF91dWlkKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBuZXdfdXVpZCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1VVSUQpCiAgICAgICAgaWYgbmV3X3V1aWQ6CiAgICAgICAgICAgIFBBWUxPQURfVVVJRCA9IGJpbmFzY2lpLmIyYV9oZXgobmV3X3V1aWRbJ3ZhbHVlJ10pCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX2VudW1leHRjbWQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGV4dGVuc2lvbl9uYW1lID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfU1RSSU5HKVsndmFsdWUnXQogICAgICAgIGZvciBmdW5jX25hbWUgaW4gc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zLmtleXMoKToKICAgICAgICAgICAgaWYgZnVuY19uYW1lLnNwbGl0KCdfJywgMSlbMF0gPT0gZXh0ZW5zaW9uX25hbWU6CiAgICAgICAgICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9TVFJJTkcsIGZ1bmNfbmFtZSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfZ2V0X3Nlc3Npb25fZ3VpZChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfU0VTU0lPTl9HVUlELCBiaW5hc2NpaS5hMmJfaGV4KGJ5dGVzKFNFU1NJT05fR1VJRCwgJ1VURi04JykpKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9zZXRfc2Vzc2lvbl9ndWlkKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBuZXdfZ3VpZCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1NFU1NJT05fR1VJRCkKICAgICAgICBpZiBuZXdfZ3VpZDoKICAgICAgICAgICAgU0VTU0lPTl9HVUlEID0gYmluYXNjaWkuYjJhX2hleChuZXdfZ3VpZFsndmFsdWUnXSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfbWFjaGluZV9pZChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgc2VyaWFsID0gJycKICAgICAgICBtYWNoaW5lX25hbWUgPSBwbGF0Zm9ybS51bmFtZSgpWzFdCiAgICAgICAgaWYgaGFzX3dpbmRsbDoKICAgICAgICAgICAgZnJvbSBjdHlwZXMgaW1wb3J0IHdpbnR5cGVzCgogICAgICAgICAgICBrMzIgPSBjdHlwZXMud2luZGxsLmtlcm5lbDMyCiAgICAgICAgICAgIHN5c19kaXIgPSBjdHlwZXMuY3JlYXRlX3VuaWNvZGVfYnVmZmVyKDI2MCkKICAgICAgICAgICAgaWYgbm90IGszMi5HZXRTeXN0ZW1EaXJlY3RvcnlXKGN0eXBlcy5ieXJlZihzeXNfZGlyKSwgMjYwKToKICAgICAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFX1dJTkRPV1MKCiAgICAgICAgICAgIHZvbF9idWYgPSBjdHlwZXMuY3JlYXRlX3VuaWNvZGVfYnVmZmVyKDI2MCkKICAgICAgICAgICAgZnNfYnVmID0gY3R5cGVzLmNyZWF0ZV91bmljb2RlX2J1ZmZlcigyNjApCiAgICAgICAgICAgIHNlcmlhbF9udW0gPSB3aW50eXBlcy5EV09SRCgwKQoKICAgICAgICAgICAgaWYgbm90IGszMi5HZXRWb2x1bWVJbmZvcm1hdGlvblcoY3R5cGVzLmNfd2NoYXJfcChzeXNfZGlyLnZhbHVlWzozXSksCiAgICAgICAgICAgICAgICAgICAgdm9sX2J1ZiwgY3R5cGVzLnNpemVvZih2b2xfYnVmKSwgY3R5cGVzLmJ5cmVmKHNlcmlhbF9udW0pLCBOb25lLAogICAgICAgICAgICAgICAgICAgIE5vbmUsIGZzX2J1ZiwgY3R5cGVzLnNpemVvZihmc19idWYpKToKICAgICAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFX1dJTkRPV1MKICAgICAgICAgICAgc2VyaWFsX251bSA9IHNlcmlhbF9udW0udmFsdWUKICAgICAgICAgICAgc2VyaWFsID0gIiUwNHgiICUgKChzZXJpYWxfbnVtID4+IDE2KSAmIDB4ZmZmZikgKyAnLScgIiUwNHgiICUgKHNlcmlhbF9udW0gJiAweGZmZmYpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VyaWFsID0gZ2V0X2hkZF9sYWJlbCgpCgogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX01BQ0hJTkVfSUQsICIlczolcyIgJSAoc2VyaWFsLCBtYWNoaW5lX25hbWUpKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9uYXRpdmVfYXJjaChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfU1RSSU5HLCBnZXRfbmF0aXZlX2FyY2goKSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfcGF0Y2hfdXJsKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShzZWxmLnRyYW5zcG9ydCwgSHR0cFRyYW5zcG9ydCk6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIG5ld191cmlfcGF0aCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1VSTClbJ3ZhbHVlJ10KICAgICAgICBpZiBub3Qgc2VsZi50cmFuc3BvcnQucGF0Y2hfdXJpX3BhdGgobmV3X3VyaV9wYXRoKToKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX2xvYWRsaWIoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGRhdGFfdGx2ID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfREFUQSkKICAgICAgICBpZiAoZGF0YV90bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfQ09NUFJFU1NFRCkgPT0gVExWX01FVEFfVFlQRV9DT01QUkVTU0VEOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKCiAgICAgICAgc2VsZi5sYXN0X3JlZ2lzdGVyZWRfZXh0ZW5zaW9uID0gTm9uZQogICAgICAgIHN5bWJvbHNfZm9yX2V4dGVuc2lvbnMgPSB7J21ldGVycHJldGVyJzpzZWxmfQogICAgICAgIHN5bWJvbHNfZm9yX2V4dGVuc2lvbnMudXBkYXRlKEVYUE9SVEVEX1NZTUJPTFMpCiAgICAgICAgaSA9IGNvZGUuSW50ZXJhY3RpdmVJbnRlcnByZXRlcihzeW1ib2xzX2Zvcl9leHRlbnNpb25zKQogICAgICAgIGkucnVuY29kZShjb21waWxlKGRhdGFfdGx2Wyd2YWx1ZSddLCAnJywgJ2V4ZWMnKSkKICAgICAgICBleHRlbnNpb25fbmFtZSA9IHNlbGYubGFzdF9yZWdpc3RlcmVkX2V4dGVuc2lvbgoKICAgICAgICBpZiBleHRlbnNpb25fbmFtZToKICAgICAgICAgICAgY2hlY2tfZXh0ZW5zaW9uID0gbGFtYmRhIHg6IHguc3RhcnRzd2l0aChleHRlbnNpb25fbmFtZSkKICAgICAgICAgICAgbGliX21ldGhvZHMgPSBsaXN0KGZpbHRlcihjaGVja19leHRlbnNpb24sIGxpc3Qoc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zLmtleXMoKSkpKQogICAgICAgICAgICBmb3IgbWV0aG9kIGluIGxpYl9tZXRob2RzOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfTUVUSE9ELCBtZXRob2QpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX3NodXRkb3duKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9CT09MLCBUcnVlKQogICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX3RyYW5zcG9ydF9hZGQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIG5ld190cmFuc3BvcnQgPSBUcmFuc3BvcnQuZnJvbV9yZXF1ZXN0KHJlcXVlc3QpCiAgICAgICAgc2VsZi50cmFuc3BvcnRfYWRkKG5ld190cmFuc3BvcnQpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX3RyYW5zcG9ydF9jaGFuZ2Uoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIG5ld190cmFuc3BvcnQgPSBUcmFuc3BvcnQuZnJvbV9yZXF1ZXN0KHJlcXVlc3QpCiAgICAgICAgc2VsZi50cmFuc3BvcnRfYWRkKG5ld190cmFuc3BvcnQpCiAgICAgICAgc2VsZi5zZW5kX3BhY2tldCh0bHZfcGFja19yZXNwb25zZShFUlJPUl9TVUNDRVNTLCByZXNwb25zZSkpCiAgICAgICAgc2VsZi50cmFuc3BvcnRfY2hhbmdlKG5ld190cmFuc3BvcnQpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X2xpc3Qoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGlmIHNlbGYuc2Vzc2lvbl9leHBpcnlfdGltZSA+IDA6CiAgICAgICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1NFU1NJT05fRVhQLCBzZWxmLnNlc3Npb25fZXhwaXJ5X2VuZCAtIHRpbWUudGltZSgpKQogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX0dST1VQLCBzZWxmLnRyYW5zcG9ydC50bHZfcGFja190cmFuc3BvcnRfZ3JvdXAoKSkKCiAgICAgICAgdHJhbnNwb3J0ID0gc2VsZi50cmFuc3BvcnRfbmV4dCgpCiAgICAgICAgd2hpbGUgdHJhbnNwb3J0ICE9IHNlbGYudHJhbnNwb3J0OgogICAgICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19HUk9VUCwgdHJhbnNwb3J0LnRsdl9wYWNrX3RyYW5zcG9ydF9ncm91cCgpKQogICAgICAgICAgICB0cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydF9uZXh0KHRyYW5zcG9ydCkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X25leHQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIG5ld190cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydF9uZXh0KCkKICAgICAgICBpZiBuZXdfdHJhbnNwb3J0ID09IHNlbGYudHJhbnNwb3J0OgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICBzZWxmLnNlbmRfcGFja2V0KHRsdl9wYWNrX3Jlc3BvbnNlKEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlKSkKICAgICAgICBzZWxmLnRyYW5zcG9ydF9jaGFuZ2UobmV3X3RyYW5zcG9ydCkKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfcHJldihzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgbmV3X3RyYW5zcG9ydCA9IHNlbGYudHJhbnNwb3J0X3ByZXYoKQogICAgICAgIGlmIG5ld190cmFuc3BvcnQgPT0gc2VsZi50cmFuc3BvcnQ6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIHNlbGYuc2VuZF9wYWNrZXQodGx2X3BhY2tfcmVzcG9uc2UoRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UpKQogICAgICAgIHNlbGYudHJhbnNwb3J0X2NoYW5nZShuZXdfdHJhbnNwb3J0KQogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIF9jb3JlX3RyYW5zcG9ydF9yZW1vdmUoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHVybCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1VSTClbJ3ZhbHVlJ10KICAgICAgICBpZiBzZWxmLnRyYW5zcG9ydC51cmwgPT0gdXJsOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICB0cmFuc3BvcnRfZm91bmQgPSBGYWxzZQogICAgICAgIGZvciB0cmFuc3BvcnQgaW4gc2VsZi50cmFuc3BvcnRzOgogICAgICAgICAgICBpZiB0cmFuc3BvcnQudXJsID09IHVybDoKICAgICAgICAgICAgICAgIHRyYW5zcG9ydF9mb3VuZCA9IFRydWUKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgaWYgdHJhbnNwb3J0X2ZvdW5kOgogICAgICAgICAgICBzZWxmLnRyYW5zcG9ydHMucmVtb3ZlKHRyYW5zcG9ydCkKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCiAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX3RyYW5zcG9ydF9zZXRfdGltZW91dHMoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHRpbWVvdXRfdmFsdWUgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19TRVNTSU9OX0VYUCkuZ2V0KCd2YWx1ZScpCiAgICAgICAgaWYgbm90IHRpbWVvdXRfdmFsdWUgaXMgTm9uZToKICAgICAgICAgICAgc2VsZi5zZXNzaW9uX2V4cGlyeV90aW1lID0gdGltZW91dF92YWx1ZQogICAgICAgICAgICBzZWxmLnNlc3Npb25fZXhwaXJ5X2VuZCA9IHRpbWUudGltZSgpICsgc2VsZi5zZXNzaW9uX2V4cGlyeV90aW1lCiAgICAgICAgdGltZW91dF92YWx1ZSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX0NPTU1fVElNRU9VVCkuZ2V0KCd2YWx1ZScpCiAgICAgICAgaWYgdGltZW91dF92YWx1ZToKICAgICAgICAgICAgc2VsZi50cmFuc3BvcnQuY29tbXVuaWNhdGlvbl90aW1lb3V0ID0gdGltZW91dF92YWx1ZQogICAgICAgIHJldHJ5X3ZhbHVlID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfUkVUUllfVE9UQUwpLmdldCgndmFsdWUnKQogICAgICAgIGlmIHJldHJ5X3ZhbHVlOgogICAgICAgICAgICBzZWxmLnRyYW5zcG9ydC5yZXRyeV90b3RhbCA9IHJldHJ5X3ZhbHVlCiAgICAgICAgcmV0cnlfdmFsdWUgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19SRVRSWV9XQUlUKS5nZXQoJ3ZhbHVlJykKICAgICAgICBpZiByZXRyeV92YWx1ZToKICAgICAgICAgICAgc2VsZi50cmFuc3BvcnQucmV0cnlfd2FpdCA9IHJldHJ5X3ZhbHVlCgogICAgICAgIGlmIHNlbGYuc2Vzc2lvbl9leHBpcnlfdGltZSA+IDA6CiAgICAgICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX1NFU1NJT05fRVhQLCBzZWxmLnNlc3Npb25fZXhwaXJ5X2VuZCAtIHRpbWUudGltZSgpKQogICAgICAgIHJlc3BvbnNlICs9IHNlbGYudHJhbnNwb3J0LnRsdl9wYWNrX3RpbWVvdXRzKCkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X3NsZWVwKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBzZWNvbmRzID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfQ09NTV9USU1FT1VUKVsndmFsdWUnXQogICAgICAgIHNlbGYuc2VuZF9wYWNrZXQodGx2X3BhY2tfcmVzcG9uc2UoRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UpKQogICAgICAgIGlmIHNlY29uZHM6CiAgICAgICAgICAgIHNlbGYuX3RyYW5zcG9ydF9zbGVlcCA9IHNlY29uZHMKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfY2hhbm5lbF9vcGVuKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBjaGFubmVsX3R5cGUgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX1RZUEUpCiAgICAgICAgaGFuZGxlciA9ICdjaGFubmVsX29wZW5fJyArIGNoYW5uZWxfdHlwZVsndmFsdWUnXQogICAgICAgIGlmIGhhbmRsZXIgbm90IGluIHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9uczoKICAgICAgICAgICAgcmV0dXJuIGVycm9yX3Jlc3VsdChOb3RJbXBsZW1lbnRlZEVycm9yKSwgcmVzcG9uc2UKICAgICAgICBoYW5kbGVyID0gc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zW2hhbmRsZXJdCiAgICAgICAgcmV0dXJuIGhhbmRsZXIocmVxdWVzdCwgcmVzcG9uc2UpCgogICAgZGVmIF9jb3JlX2NoYW5uZWxfY2xvc2Uoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfaWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX0lEKVsndmFsdWUnXQogICAgICAgIGlmIGNoYW5uZWxfaWQgbm90IGluIHNlbGYuY2hhbm5lbHM6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgaWYgaXNpbnN0YW5jZShjaGFubmVsLCBzdWJwcm9jZXNzLlBvcGVuKToKICAgICAgICAgICAgY2hhbm5lbC5raWxsKCkKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgTWV0ZXJwcmV0ZXJGaWxlKToKICAgICAgICAgICAgY2hhbm5lbC5jbG9zZSgpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGNoYW5uZWwsIE1ldGVycHJldGVyU29ja2V0KToKICAgICAgICAgICAgY2hhbm5lbC5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgZGVsIHNlbGYuY2hhbm5lbHNbY2hhbm5lbF9pZF0KICAgICAgICBpZiBjaGFubmVsX2lkIGluIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHM6CiAgICAgICAgICAgIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHMucmVtb3ZlKGNoYW5uZWxfaWQpCiAgICAgICAgZGVidWdfcHJpbnQoJ1sqXSBjbG9zZWQgYW5kIHJlbW92ZWQgY2hhbm5lbCBpZDogJyArIHN0cihjaGFubmVsX2lkKSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfY2hhbm5lbF9lb2Yoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfaWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX0lEKVsndmFsdWUnXQogICAgICAgIGlmIGNoYW5uZWxfaWQgbm90IGluIHNlbGYuY2hhbm5lbHM6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgcmVzdWx0ID0gRmFsc2UKICAgICAgICBpZiBpc2luc3RhbmNlKGNoYW5uZWwsIE1ldGVycHJldGVyRmlsZSk6CiAgICAgICAgICAgIHJlc3VsdCA9IGNoYW5uZWwudGVsbCgpID49IG9zLmZzdGF0KGNoYW5uZWwuZmlsZW5vKCkpLnN0X3NpemUKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9CT09MLCByZXN1bHQpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX2NoYW5uZWxfaW50ZXJhY3Qoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfaWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX0lEKVsndmFsdWUnXQogICAgICAgIGlmIGNoYW5uZWxfaWQgbm90IGluIHNlbGYuY2hhbm5lbHM6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgdG9nZ2xlID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfQk9PTClbJ3ZhbHVlJ10KICAgICAgICBpZiB0b2dnbGU6CiAgICAgICAgICAgIGlmIGNoYW5uZWxfaWQgaW4gc2VsZi5pbnRlcmFjdF9jaGFubmVsczoKICAgICAgICAgICAgICAgIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHMucmVtb3ZlKGNoYW5uZWxfaWQpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmludGVyYWN0X2NoYW5uZWxzLmFwcGVuZChjaGFubmVsX2lkKQogICAgICAgIGVsaWYgY2hhbm5lbF9pZCBpbiBzZWxmLmludGVyYWN0X2NoYW5uZWxzOgogICAgICAgICAgICBzZWxmLmludGVyYWN0X2NoYW5uZWxzLnJlbW92ZShjaGFubmVsX2lkKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9jaGFubmVsX3JlYWQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfaWQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX0lEKVsndmFsdWUnXQogICAgICAgIGxlbmd0aCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0xFTkdUSClbJ3ZhbHVlJ10KICAgICAgICBpZiBjaGFubmVsX2lkIG5vdCBpbiBzZWxmLmNoYW5uZWxzOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICBjaGFubmVsID0gc2VsZi5jaGFubmVsc1tjaGFubmVsX2lkXQogICAgICAgIGRhdGEgPSAnJwogICAgICAgIGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgU1REUHJvY2Vzcyk6CiAgICAgICAgICAgIGlmIGNoYW5uZWwucG9sbCgpICE9IE5vbmU6CiAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZV9kZWFkX3Jlc291cmNlX2NoYW5uZWwoY2hhbm5lbF9pZCkKICAgICAgICAgICAgaWYgY2hhbm5lbC5zdGRvdXRfcmVhZGVyLmlzX3JlYWRfcmVhZHkoKToKICAgICAgICAgICAgICAgIGRhdGEgPSBjaGFubmVsLnN0ZG91dF9yZWFkZXIucmVhZChsZW5ndGgpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGNoYW5uZWwsIE1ldGVycHJldGVyRmlsZSk6CiAgICAgICAgICAgIGRhdGEgPSBjaGFubmVsLnJlYWQobGVuZ3RoKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlclNvY2tldCk6CiAgICAgICAgICAgIGRhdGEgPSBjaGFubmVsLnJlY3YobGVuZ3RoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX0NIQU5ORUxfREFUQSwgZGF0YSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfY2hhbm5lbF93cml0ZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgY2hhbm5lbF9pZCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfSUQpWyd2YWx1ZSddCiAgICAgICAgY2hhbm5lbF9kYXRhID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfQ0hBTk5FTF9EQVRBKVsndmFsdWUnXQogICAgICAgIGxlbmd0aCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0xFTkdUSClbJ3ZhbHVlJ10KICAgICAgICBpZiBjaGFubmVsX2lkIG5vdCBpbiBzZWxmLmNoYW5uZWxzOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICBjaGFubmVsID0gc2VsZi5jaGFubmVsc1tjaGFubmVsX2lkXQogICAgICAgIGwgPSBsZW4oY2hhbm5lbF9kYXRhKQogICAgICAgIGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgc3VicHJvY2Vzcy5Qb3Blbik6CiAgICAgICAgICAgIGlmIGNoYW5uZWwucG9sbCgpICE9IE5vbmU6CiAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZV9kZWFkX3Jlc291cmNlX2NoYW5uZWwoY2hhbm5lbF9pZCkKICAgICAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgICAgICBjaGFubmVsLndyaXRlKGNoYW5uZWxfZGF0YSkKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgTWV0ZXJwcmV0ZXJGaWxlKToKICAgICAgICAgICAgY2hhbm5lbC53cml0ZShjaGFubmVsX2RhdGEpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGNoYW5uZWwsIE1ldGVycHJldGVyU29ja2V0KToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbCA9IGNoYW5uZWwuc2VuZChjaGFubmVsX2RhdGEpCiAgICAgICAgICAgIGV4Y2VwdCBzb2NrZXQuZXJyb3I6CiAgICAgICAgICAgICAgICBjaGFubmVsLmNsb3NlKCkKICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlX2RlYWRfcmVzb3VyY2VfY2hhbm5lbChjaGFubmVsX2lkKQogICAgICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfTEVOR1RILCBsKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBjcmVhdGVfcmVzcG9uc2Uoc2VsZiwgcmVxdWVzdCk6CiAgICAgICAgcmVzcCA9IHN0cnVjdC5wYWNrKCc+SScsIFBBQ0tFVF9UWVBFX1JFU1BPTlNFKQogICAgICAgIG1ldGhvZF90bHYgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9NRVRIT0QpCiAgICAgICAgcmVzcCArPSB0bHZfcGFjayhtZXRob2RfdGx2KQogICAgICAgIHJlc3AgKz0gdGx2X3BhY2soVExWX1RZUEVfVVVJRCwgYmluYXNjaWkuYTJiX2hleChieXRlcyhQQVlMT0FEX1VVSUQsICdVVEYtOCcpKSkKCiAgICAgICAgaGFuZGxlcl9uYW1lID0gbWV0aG9kX3RsdlsndmFsdWUnXQogICAgICAgIGlmIGhhbmRsZXJfbmFtZSBpbiBzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnM6CiAgICAgICAgICAgIGhhbmRsZXIgPSBzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnNbaGFuZGxlcl9uYW1lXQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZWJ1Z19wcmludCgnWypdIHJ1bm5pbmcgbWV0aG9kICcgKyBoYW5kbGVyX25hbWUpCiAgICAgICAgICAgICAgICByZXN1bHQgPSBoYW5kbGVyKHJlcXVlc3QsIHJlc3ApCiAgICAgICAgICAgICAgICBpZiByZXN1bHQgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIHJlc3VsdCwgcmVzcCA9IHJlc3VsdAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgZGVidWdfdHJhY2ViYWNrKCdbLV0gbWV0aG9kICcgKyBoYW5kbGVyX25hbWUgKyAnIHJlc3VsdGVkIGluIGFuIGVycm9yJykKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGVycm9yX3Jlc3VsdCgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiByZXN1bHQgIT0gRVJST1JfU1VDQ0VTUzoKICAgICAgICAgICAgICAgICAgICBkZWJ1Z19wcmludCgnWy1dIG1ldGhvZCAnICsgaGFuZGxlcl9uYW1lICsgJyByZXN1bHRlZCBpbiBlcnJvcjogIycgKyBzdHIocmVzdWx0KSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBkZWJ1Z19wcmludCgnWy1dIG1ldGhvZCAnICsgaGFuZGxlcl9uYW1lICsgJyB3YXMgcmVxdWVzdGVkIGJ1dCBkb2VzIG5vdCBleGlzdCcpCiAgICAgICAgICAgIHJlc3VsdCA9IGVycm9yX3Jlc3VsdChOb3RJbXBsZW1lbnRlZEVycm9yKQoKICAgICAgICByZXFpZF90bHYgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9SRVFVRVNUX0lEKQogICAgICAgIGlmIG5vdCByZXFpZF90bHY6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIHJlc3AgKz0gdGx2X3BhY2socmVxaWRfdGx2KQogICAgICAgIHJldHVybiB0bHZfcGFja19yZXNwb25zZShyZXN1bHQsIHJlc3ApCgpfdHJ5X3RvX2ZvcmsgPSBUUllfVE9fRk9SSyBhbmQgaGFzYXR0cihvcywgJ2ZvcmsnKQppZiBub3QgX3RyeV90b19mb3JrIG9yIChfdHJ5X3RvX2ZvcmsgYW5kIG9zLmZvcmsoKSA9PSAwKToKICAgIGlmIGhhc2F0dHIob3MsICdzZXRzaWQnKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG9zLnNldHNpZCgpCiAgICAgICAgZXhjZXB0IE9TRXJyb3I6CiAgICAgICAgICAgIHBhc3MKICAgIGlmIEhUVFBfQ09OTkVDVElPTl9VUkwgYW5kIGhhc191cmxsaWI6CiAgICAgICAgdHJhbnNwb3J0ID0gSHR0cFRyYW5zcG9ydChIVFRQX0NPTk5FQ1RJT05fVVJMLCBwcm94eT1IVFRQX1BST1hZLCB1c2VyX2FnZW50PUhUVFBfVVNFUl9BR0VOVCwKICAgICAgICAgICAgICAgIGh0dHBfaG9zdD1IVFRQX0hPU1QsIGh0dHBfcmVmZXJlcj1IVFRQX1JFRkVSRVIsIGh0dHBfY29va2llPUhUVFBfQ09PS0lFKQogICAgZWxzZToKICAgICAgICAjIFBBVENILVNFVFVQLVNUQUdFTEVTUy1UQ1AtU09DS0VUICMKICAgICAgICB0cmFuc3BvcnQgPSBUY3BUcmFuc3BvcnQuZnJvbV9zb2NrZXQocykKICAgIG1ldCA9IFB5dGhvbk1ldGVycHJldGVyKHRyYW5zcG9ydCkKICAgICMgUEFUQ0gtU0VUVVAtVFJBTlNQT1JUUyAjCiAgICBtZXQucnVuKCkK')))