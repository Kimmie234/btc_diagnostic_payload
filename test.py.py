import base64,sys;exec(base64.b64decode({2:str,3:lambda b:bytes(b,'UTF-8')}[sys.version_info[0]]('IyEvdXNyL2Jpbi9weXRob24KaW1wb3J0IGJpbmFzY2lpCmltcG9ydCBjb2RlCmltcG9ydCBvcwppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IHJhbmRvbQppbXBvcnQgcmUKaW1wb3J0IHNlbGVjdAppbXBvcnQgc29ja2V0CmltcG9ydCBzdHJ1Y3QKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IHN5cwppbXBvcnQgdGhyZWFkaW5nCmltcG9ydCB0aW1lCmltcG9ydCB0cmFjZWJhY2sKCnRyeToKICAgIGltcG9ydCBjdHlwZXMKZXhjZXB0IEltcG9ydEVycm9yOgogICAgaGFzX3dpbmRsbCA9IEZhbHNlCmVsc2U6CiAgICBoYXNfd2luZGxsID0gaGFzYXR0cihjdHlwZXMsICd3aW5kbGwnKQoKdHJ5OgogICAgdXJsbGliX2ltcG9ydHMgPSBbJ1Byb3h5SGFuZGxlcicsICdSZXF1ZXN0JywgJ2J1aWxkX29wZW5lcicsICdpbnN0YWxsX29wZW5lcicsICd1cmxvcGVuJ10KICAgIGlmIHN5cy52ZXJzaW9uX2luZm9bMF0gPCAzOgogICAgICAgIHVybGxpYiA9IF9faW1wb3J0X18oJ3VybGxpYjInLCBmcm9tbGlzdD11cmxsaWJfaW1wb3J0cykKICAgIGVsc2U6CiAgICAgICAgdXJsbGliID0gX19pbXBvcnRfXygndXJsbGliLnJlcXVlc3QnLCBmcm9tbGlzdD11cmxsaWJfaW1wb3J0cykKZXhjZXB0IEltcG9ydEVycm9yOgogICAgaGFzX3VybGxpYiA9IEZhbHNlCmVsc2U6CiAgICBoYXNfdXJsbGliID0gVHJ1ZQoKaWYgc3lzLnZlcnNpb25faW5mb1swXSA8IDM6CiAgICBpc19zdHIgPSBsYW1iZGEgb2JqOiBpc3N1YmNsYXNzKG9iai5fX2NsYXNzX18sIHN0cikKICAgIGlzX2J5dGVzID0gbGFtYmRhIG9iajogaXNzdWJjbGFzcyhvYmouX19jbGFzc19fLCBzdHIpCiAgICBieXRlcyA9IGxhbWJkYSAqYXJnczogc3RyKCphcmdzWzoxXSkKICAgIE5VTExfQllURSA9ICdceDAwJwogICAgdW5pY29kZSA9IGxhbWJkYSB4OiAoeC5kZWNvZGUoJ1VURi04JykgaWYgaXNpbnN0YW5jZSh4LCBzdHIpIGVsc2UgeCkKZWxzZToKICAgIGlmIGlzaW5zdGFuY2UoX19idWlsdGluc19fLCBkaWN0KToKICAgICAgICBpc19zdHIgPSBsYW1iZGEgb2JqOiBpc3N1YmNsYXNzKG9iai5fX2NsYXNzX18sIF9fYnVpbHRpbnNfX1snc3RyJ10pCiAgICAgICAgc3RyID0gbGFtYmRhIHg6IF9fYnVpbHRpbnNfX1snc3RyJ10oeCwgKigoKSBpZiBpc2luc3RhbmNlKHgsIChmbG9hdCwgaW50KSkgZWxzZSAoJ1VURi04JywpKSkKICAgIGVsc2U6CiAgICAgICAgaXNfc3RyID0gbGFtYmRhIG9iajogaXNzdWJjbGFzcyhvYmouX19jbGFzc19fLCBfX2J1aWx0aW5zX18uc3RyKQogICAgICAgIHN0ciA9IGxhbWJkYSB4OiBfX2J1aWx0aW5zX18uc3RyKHgsICooKCkgaWYgaXNpbnN0YW5jZSh4LCAoZmxvYXQsIGludCkpIGVsc2UgKCdVVEYtOCcsKSkpCiAgICBpc19ieXRlcyA9IGxhbWJkYSBvYmo6IGlzc3ViY2xhc3Mob2JqLl9fY2xhc3NfXywgYnl0ZXMpCiAgICBOVUxMX0JZVEUgPSBieXRlcygnXHgwMCcsICdVVEYtOCcpCiAgICBsb25nID0gaW50CiAgICB1bmljb2RlID0gbGFtYmRhIHg6ICh4LmRlY29kZSgnVVRGLTgnKSBpZiBpc2luc3RhbmNlKHgsIGJ5dGVzKSBlbHNlIHgpCgojIHJlc2VlZCB0aGUgcmFuZG9tIGdlbmVyYXRvci4KcmFuZG9tLnNlZWQoKQoKIwojIENvbnN0YW50cwojCgojIHRoZXNlIHZhbHVlcyB3aWxsIGJlIHBhdGNoZWQsIERPIE5PVCBDSEFOR0UgVEhFTQpERUJVR0dJTkcgPSBGYWxzZQpUUllfVE9fRk9SSyA9IFRydWUKSFRUUF9DT05ORUNUSU9OX1VSTCA9ICdodHRwczovLzE5Mi4xNjguMTIyLjE4Mzo1MDAwMC81QUJXUC8nCkhUVFBfUFJPWFkgPSBOb25lCkhUVFBfVVNFUl9BR0VOVCA9ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFRyaWRlbnQvNy4wOyBydjoxMS4wKSBsaWtlIEdlY2tvJwpIVFRQX0NPT0tJRSA9IE5vbmUKSFRUUF9IT1NUID0gTm9uZQpIVFRQX1JFRkVSRVIgPSBOb25lClBBWUxPQURfVVVJRCA9ICc3YzNjZGNkYmVmZThjYzQwZDIxMGM3MDQ4OGYxZDJlMycKU0VTU0lPTl9HVUlEID0gJzAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwJwpTRVNTSU9OX0NPTU1VTklDQVRJT05fVElNRU9VVCA9IDMwMApTRVNTSU9OX0VYUElSQVRJT05fVElNRU9VVCA9IDYwNDgwMApTRVNTSU9OX1JFVFJZX1RPVEFMID0gMzYwMApTRVNTSU9OX1JFVFJZX1dBSVQgPSAxMAoKUEFDS0VUX1RZUEVfUkVRVUVTVCAgICAgICAgPSAwClBBQ0tFVF9UWVBFX1JFU1BPTlNFICAgICAgID0gMQpQQUNLRVRfVFlQRV9QTEFJTl9SRVFVRVNUICA9IDEwClBBQ0tFVF9UWVBFX1BMQUlOX1JFU1BPTlNFID0gMTEKCkVSUk9SX1NVQ0NFU1MgPSAwCiMgbm90IGRlZmluZWQgaW4gb3JpZ2luYWwgQyBpbXBsZW1lbnRhdGlvbgpFUlJPUl9GQUlMVVJFID0gMQpFUlJPUl9GQUlMVVJFX1BZVEhPTiA9IDIKRVJST1JfRkFJTFVSRV9XSU5ET1dTID0gMwoKQ0hBTk5FTF9DTEFTU19CVUZGRVJFRCA9IDAKQ0hBTk5FTF9DTEFTU19TVFJFQU0gICA9IDEKQ0hBTk5FTF9DTEFTU19EQVRBR1JBTSA9IDIKQ0hBTk5FTF9DTEFTU19QT09MICAgICA9IDMKCiMKIyBUTFYgTWV0YSBUeXBlcwojClRMVl9NRVRBX1RZUEVfTk9ORSAgICAgICA9ICggICAwICAgKQpUTFZfTUVUQV9UWVBFX1NUUklORyAgICAgPSAoMSA8PCAxNikKVExWX01FVEFfVFlQRV9VSU5UICAgICAgID0gKDEgPDwgMTcpClRMVl9NRVRBX1RZUEVfUkFXICAgICAgICA9ICgxIDw8IDE4KQpUTFZfTUVUQV9UWVBFX0JPT0wgICAgICAgPSAoMSA8PCAxOSkKVExWX01FVEFfVFlQRV9RV09SRCAgICAgID0gKDEgPDwgMjApClRMVl9NRVRBX1RZUEVfQ09NUFJFU1NFRCA9ICgxIDw8IDI5KQpUTFZfTUVUQV9UWVBFX0dST1VQICAgICAgPSAoMSA8PCAzMCkKVExWX01FVEFfVFlQRV9DT01QTEVYICAgID0gKDEgPDwgMzEpCiMgbm90IGRlZmluZWQgaW4gb3JpZ2luYWwKVExWX01FVEFfVFlQRV9NQVNLID0gKDE8PDMxKSsoMTw8MzApKygxPDwyOSkrKDE8PDE5KSsoMTw8MTgpKygxPDwxNykrKDE8PDE2KQoKIwojIFRMViBiYXNlIHN0YXJ0aW5nIHBvaW50cwojClRMVl9SRVNFUlZFRCAgID0gMApUTFZfRVhURU5TSU9OUyA9IDIwMDAwClRMVl9VU0VSICAgICAgID0gNDAwMDAKVExWX1RFTVAgICAgICAgPSA2MDAwMAoKIwojIFRMViBTcGVjaWZpYyBUeXBlcwojClRMVl9UWVBFX0FOWSAgICAgICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfTk9ORSAgICB8IDAKVExWX1RZUEVfTUVUSE9EICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgMQpUTFZfVFlQRV9SRVFVRVNUX0lEICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCAyClRMVl9UWVBFX0VYQ0VQVElPTiAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfR1JPVVAgICB8IDMKVExWX1RZUEVfUkVTVUxUICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNAoKVExWX1RZUEVfU1RSSU5HICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgMTAKVExWX1RZUEVfVUlOVCAgICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgMTEKVExWX1RZUEVfQk9PTCAgICAgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9CT09MICAgIHwgMTIKClRMVl9UWVBFX0xFTkdUSCAgICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDI1ClRMVl9UWVBFX0RBVEEgICAgICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfUkFXICAgICB8IDI2ClRMVl9UWVBFX0ZMQUdTICAgICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDI3CgpUTFZfVFlQRV9DSEFOTkVMX0lEICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA1MApUTFZfVFlQRV9DSEFOTkVMX1RZUEUgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA1MQpUTFZfVFlQRV9DSEFOTkVMX0RBVEEgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1JBVyAgICAgfCA1MgpUTFZfVFlQRV9DSEFOTkVMX0RBVEFfR1JPVVAgICAgPSBUTFZfTUVUQV9UWVBFX0dST1VQICAgfCA1MwpUTFZfVFlQRV9DSEFOTkVMX0NMQVNTICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA1NApUTFZfVFlQRV9DSEFOTkVMX1BBUkVOVElEICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA1NQoKVExWX1RZUEVfU0VFS19XSEVOQ0UgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNzAKVExWX1RZUEVfU0VFS19PRkZTRVQgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNzEKVExWX1RZUEVfU0VFS19QT1MgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgNzIKClRMVl9UWVBFX0VYQ0VQVElPTl9DT0RFICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDMwMApUTFZfVFlQRV9FWENFUFRJT05fU1RSSU5HICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCAzMDEKClRMVl9UWVBFX0xJQlJBUllfUEFUSCAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQwMApUTFZfVFlQRV9UQVJHRVRfUEFUSCAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0MDEKClRMVl9UWVBFX1RSQU5TX1RZUEUgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDQzMApUTFZfVFlQRV9UUkFOU19VUkwgICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0MzEKVExWX1RZUEVfVFJBTlNfVUEgICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDMyClRMVl9UWVBFX1RSQU5TX0NPTU1fVElNRU9VVCAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDQzMwpUTFZfVFlQRV9UUkFOU19TRVNTSU9OX0VYUCAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA0MzQKVExWX1RZUEVfVFJBTlNfQ0VSVF9IQVNIICAgICAgID0gVExWX01FVEFfVFlQRV9SQVcgICAgIHwgNDM1ClRMVl9UWVBFX1RSQU5TX1BST1hZX0hPU1QgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDQzNgpUTFZfVFlQRV9UUkFOU19QUk9YWV9VU0VSICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCA0MzcKVExWX1RZUEVfVFJBTlNfUFJPWFlfUEFTUyAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDM4ClRMVl9UWVBFX1RSQU5TX1JFVFJZX1RPVEFMICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDQzOQpUTFZfVFlQRV9UUkFOU19SRVRSWV9XQUlUICAgICAgPSBUTFZfTUVUQV9UWVBFX1VJTlQgICAgfCA0NDAKVExWX1RZUEVfVFJBTlNfSEVBREVSUyAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDQxClRMVl9UWVBFX1RSQU5TX0dST1VQICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfR1JPVVAgICB8IDQ0MgoKVExWX1RZUEVfTUFDSElORV9JRCAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9TVFJJTkcgIHwgNDYwClRMVl9UWVBFX1VVSUQgICAgICAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfUkFXICAgICB8IDQ2MQpUTFZfVFlQRV9TRVNTSU9OX0dVSUQgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1JBVyAgICAgfCA0NjIKClRMVl9UWVBFX1BFRVJfSE9TVCAgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfU1RSSU5HICB8IDE1MDAKVExWX1RZUEVfUEVFUl9QT1JUICAgICAgICAgICAgID0gVExWX01FVEFfVFlQRV9VSU5UICAgIHwgMTUwMQpUTFZfVFlQRV9MT0NBTF9IT1NUICAgICAgICAgICAgPSBUTFZfTUVUQV9UWVBFX1NUUklORyAgfCAxNTAyClRMVl9UWVBFX0xPQ0FMX1BPUlQgICAgICAgICAgICA9IFRMVl9NRVRBX1RZUEVfVUlOVCAgICB8IDE1MDMKCkVYUE9SVEVEX1NZTUJPTFMgPSB7fQpFWFBPUlRFRF9TWU1CT0xTWydERUJVR0dJTkcnXSA9IERFQlVHR0lORwoKIyBQYWNrZXQgaGVhZGVyIHNpemVzCkVOQ19OT05FID0gMApQQUNLRVRfWE9SX0tFWV9TSVpFID0gNApQQUNLRVRfU0VTU0lPTl9HVUlEX1NJWkUgPSAxNgpQQUNLRVRfRU5DUllQVF9GTEFHX1NJWkUgPSA0ClBBQ0tFVF9MRU5HVEhfU0laRSA9IDQKUEFDS0VUX1RZUEVfU0laRSA9IDQKUEFDS0VUX0xFTkdUSF9PRkYgPSAoUEFDS0VUX1hPUl9LRVlfU0laRSArIFBBQ0tFVF9TRVNTSU9OX0dVSURfU0laRSArCiAgICAgICAgUEFDS0VUX0VOQ1JZUFRfRkxBR19TSVpFKQpQQUNLRVRfSEVBREVSX1NJWkUgPSAoUEFDS0VUX1hPUl9LRVlfU0laRSArIFBBQ0tFVF9TRVNTSU9OX0dVSURfU0laRSArCiAgICAgICAgUEFDS0VUX0VOQ1JZUFRfRkxBR19TSVpFICsgUEFDS0VUX0xFTkdUSF9TSVpFICsgUEFDS0VUX1RZUEVfU0laRSkKCmNsYXNzIFNZU1RFTV9JTkZPKGN0eXBlcy5TdHJ1Y3R1cmUpOgogICAgX2ZpZWxkc18gPSBbKCJ3UHJvY2Vzc29yQXJjaGl0ZWN0dXJlIiwgY3R5cGVzLmNfdWludDE2KSwKICAgICAgICAoIndSZXNlcnZlZCIsIGN0eXBlcy5jX3VpbnQxNiksCiAgICAgICAgKCJkd1BhZ2VTaXplIiwgY3R5cGVzLmNfdWludDMyKSwKICAgICAgICAoImxwTWluaW11bUFwcGxpY2F0aW9uQWRkcmVzcyIsIGN0eXBlcy5jX3ZvaWRfcCksCiAgICAgICAgKCJscE1heGltdW1BcHBsaWNhdGlvbkFkZHJlc3MiLCBjdHlwZXMuY192b2lkX3ApLAogICAgICAgICgiZHdBY3RpdmVQcm9jZXNzb3JNYXNrIiwgY3R5cGVzLmNfdWludDMyKSwKICAgICAgICAoImR3TnVtYmVyT2ZQcm9jZXNzb3JzIiwgY3R5cGVzLmNfdWludDMyKSwKICAgICAgICAoImR3UHJvY2Vzc29yVHlwZSIsIGN0eXBlcy5jX3VpbnQzMiksCiAgICAgICAgKCJkd0FsbG9jYXRpb25HcmFudWxhcml0eSIsIGN0eXBlcy5jX3VpbnQzMiksCiAgICAgICAgKCJ3UHJvY2Vzc29yTGV2ZWwiLCBjdHlwZXMuY191aW50MTYpLAogICAgICAgICgid1Byb2Nlc3NvclJldmlzaW9uIiwgY3R5cGVzLmNfdWludDE2KV0KCmRlZiByYW5kX3hvcl9rZXkoKToKICAgIHJldHVybiB0dXBsZShyYW5kb20ucmFuZGludCgxLCAyNTUpIGZvciBfIGluIHJhbmdlKDQpKQoKZGVmIHhvcl9ieXRlcyhrZXksIGRhdGEpOgogICAgaWYgc3lzLnZlcnNpb25faW5mb1swXSA8IDM6CiAgICAgICAgZGV4b3JlZCA9ICcnLmpvaW4oY2hyKG9yZChkYXRhW2ldKSBeIGtleVtpICUgbGVuKGtleSldKSBmb3IgaSBpbiByYW5nZShsZW4oZGF0YSkpKQogICAgZWxzZToKICAgICAgICBkZXhvcmVkID0gYnl0ZXMoZGF0YVtpXSBeIGtleVtpICUgbGVuKGtleSldIGZvciBpIGluIHJhbmdlKGxlbihkYXRhKSkpCiAgICByZXR1cm4gZGV4b3JlZAoKZGVmIGV4cG9ydChzeW1ib2wpOgogICAgRVhQT1JURURfU1lNQk9MU1tzeW1ib2wuX19uYW1lX19dID0gc3ltYm9sCiAgICByZXR1cm4gc3ltYm9sCgpkZWYgZ2VuZXJhdGVfcmVxdWVzdF9pZCgpOgogICAgY2hhcnMgPSAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXonCiAgICByZXR1cm4gJycuam9pbihyYW5kb20uY2hvaWNlKGNoYXJzKSBmb3IgeCBpbiByYW5nZSgzMikpCgpAZXhwb3J0CmRlZiBjcmMxNihkYXRhKToKICAgIHBvbHkgPSAweDEwMjEKICAgIHJlZyA9IDB4MDAwMAogICAgaWYgaXNfc3RyKGRhdGEpOgogICAgICAgIGRhdGEgPSBsaXN0KG1hcChvcmQsIGRhdGEpKQogICAgZWxpZiBpc19ieXRlcyhkYXRhKToKICAgICAgICBkYXRhID0gbGlzdChkYXRhKQogICAgZGF0YS5hcHBlbmQoMCkKICAgIGRhdGEuYXBwZW5kKDApCiAgICBmb3IgYnl0ZSBpbiBkYXRhOgogICAgICAgIG1hc2sgPSAweDgwCiAgICAgICAgd2hpbGUgbWFzayA+IDA6CiAgICAgICAgICAgIHJlZyA8PD0gMQogICAgICAgICAgICBpZiBieXRlICYgbWFzazoKICAgICAgICAgICAgICAgIHJlZyArPSAxCiAgICAgICAgICAgIG1hc2sgPj49IDEKICAgICAgICAgICAgaWYgcmVnID4gMHhmZmZmOgogICAgICAgICAgICAgICAgcmVnICY9IDB4ZmZmZgogICAgICAgICAgICAgICAgcmVnIF49IHBvbHkKICAgIHJldHVybiByZWcKCkBleHBvcnQKZGVmIGRlYnVnX3ByaW50KG1zZyk6CiAgICBpZiBERUJVR0dJTkc6CiAgICAgICAgcHJpbnQobXNnKQoKQGV4cG9ydApkZWYgZGVidWdfdHJhY2ViYWNrKG1zZz1Ob25lKToKICAgIGlmIERFQlVHR0lORzoKICAgICAgICBpZiBtc2c6CiAgICAgICAgICAgIHByaW50KG1zZykKICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZGVycikKCkBleHBvcnQKZGVmIGVycm9yX3Jlc3VsdChleGNlcHRpb249Tm9uZSk6CiAgICBpZiBub3QgZXhjZXB0aW9uOgogICAgICAgIF8sIGV4Y2VwdGlvbiwgXyA9IHN5cy5leGNfaW5mbygpCiAgICBleGNlcHRpb25fY3JjID0gY3JjMTYoZXhjZXB0aW9uLl9fY2xhc3NfXy5fX25hbWVfXykKICAgIGlmIGV4Y2VwdGlvbl9jcmMgPT0gMHg0Y2IyOiAjIFdpbmRvd3NFcnJvcgogICAgICAgIHJldHVybiBlcnJvcl9yZXN1bHRfd2luZG93cyhleGNlcHRpb24uZXJybm8pCiAgICBlbHNlOgogICAgICAgIHJlc3VsdCA9ICgoZXhjZXB0aW9uX2NyYyA8PCAxNikgfCBFUlJPUl9GQUlMVVJFX1BZVEhPTikKICAgIHJldHVybiByZXN1bHQKCkBleHBvcnQKZGVmIGVycm9yX3Jlc3VsdF93aW5kb3dzKGVycm9yX251bWJlcj1Ob25lKToKICAgIGlmIG5vdCBoYXNfd2luZGxsOgogICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFCiAgICBpZiBlcnJvcl9udW1iZXIgPT0gTm9uZToKICAgICAgICBlcnJvcl9udW1iZXIgPSBjdHlwZXMud2luZGxsLmtlcm5lbDMyLkdldExhc3RFcnJvcigpCiAgICBpZiBlcnJvcl9udW1iZXIgPiAweGZmZmY6CiAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUKICAgIHJlc3VsdCA9ICgoZXJyb3JfbnVtYmVyIDw8IDE2KSB8IEVSUk9SX0ZBSUxVUkVfV0lORE9XUykKICAgIHJldHVybiByZXN1bHQKCkBleHBvcnQKZGVmIGdldF9oZGRfbGFiZWwoKToKICAgIGZvciBfLCBfLCBmaWxlcyBpbiBvcy53YWxrKCcvZGV2L2Rpc2svYnktaWQvJyk6CiAgICAgICAgZm9yIGYgaW4gZmlsZXM6CiAgICAgICAgICAgIGZvciBwIGluIFsnYXRhLScsICdtYi0nXToKICAgICAgICAgICAgICAgIGlmIGZbOmxlbihwKV0gPT0gcDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZltsZW4ocCk6XQogICAgcmV0dXJuICcnCgpAZXhwb3J0CmRlZiBnZXRfbmF0aXZlX2FyY2goKToKICAgIGFyY2ggPSBnZXRfc3lzdGVtX2FyY2goKQogICAgaWYgYXJjaCA9PSAneDY0JyBhbmQgY3R5cGVzLnNpemVvZihjdHlwZXMuY192b2lkX3ApID09IDQ6CiAgICAgICAgYXJjaCA9ICd4ODYnCiAgICByZXR1cm4gYXJjaAoKQGV4cG9ydApkZWYgZ2V0X3N5c3RlbV9hcmNoKCk6CiAgICB1bmFtZV9pbmZvID0gcGxhdGZvcm0udW5hbWUoKQogICAgYXJjaCA9IHVuYW1lX2luZm9bNF0KICAgIGlmIGhhc193aW5kbGw6CiAgICAgICAgc3lzaW5mbyA9IFNZU1RFTV9JTkZPKCkKICAgICAgICBjdHlwZXMud2luZGxsLmtlcm5lbDMyLkdldE5hdGl2ZVN5c3RlbUluZm8oY3R5cGVzLmJ5cmVmKHN5c2luZm8pKQogICAgICAgIHZhbHVlcyA9IHswOid4ODYnLCA1Oidhcm1sZScsIDY6J0lBNjQnLCA5Oid4NjQnfQogICAgICAgIGFyY2ggPSB2YWx1ZXMuZ2V0KHN5c2luZm8ud1Byb2Nlc3NvckFyY2hpdGVjdHVyZSwgdW5hbWVfaW5mb1s0XSkKICAgIGlmIGFyY2ggPT0gJ3g4Nl82NCc6CiAgICAgICAgYXJjaCA9ICd4NjQnCiAgICByZXR1cm4gYXJjaAoKQGV4cG9ydApkZWYgaW5ldF9wdG9uKGZhbWlseSwgYWRkcmVzcyk6CiAgICBpZiBoYXNhdHRyKHNvY2tldCwgJ2luZXRfcHRvbicpOgogICAgICAgIHJldHVybiBzb2NrZXQuaW5ldF9wdG9uKGZhbWlseSwgYWRkcmVzcykKICAgIGVsaWYgaGFzX3dpbmRsbDoKICAgICAgICBXU0FTdHJpbmdUb0FkZHJlc3MgPSBjdHlwZXMud2luZGxsLndzMl8zMi5XU0FTdHJpbmdUb0FkZHJlc3NBCiAgICAgICAgbHBBZGRyZXNzID0gKGN0eXBlcy5jX3VieXRlICogMjgpKCkKICAgICAgICBscEFkZHJlc3NMZW5ndGggPSBjdHlwZXMuY19pbnQoY3R5cGVzLnNpemVvZihscEFkZHJlc3MpKQogICAgICAgIGlmIFdTQVN0cmluZ1RvQWRkcmVzcyhhZGRyZXNzLCBmYW1pbHksIE5vbmUsIGN0eXBlcy5ieXJlZihscEFkZHJlc3MpLCBjdHlwZXMuYnlyZWYobHBBZGRyZXNzTGVuZ3RoKSkgIT0gMDoKICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCdXU0FTdHJpbmdUb0FkZHJlc3MgZmFpbGVkJykKICAgICAgICBpZiBmYW1pbHkgPT0gc29ja2V0LkFGX0lORVQ6CiAgICAgICAgICAgIHJldHVybiAnJy5qb2luKG1hcChjaHIsIGxwQWRkcmVzc1s0OjhdKSkKICAgICAgICBlbGlmIGZhbWlseSA9PSBzb2NrZXQuQUZfSU5FVDY6CiAgICAgICAgICAgIHJldHVybiAnJy5qb2luKG1hcChjaHIsIGxwQWRkcmVzc1s4OjI0XSkpCiAgICByYWlzZSBFeGNlcHRpb24oJ25vIHN1aXRhYmxlIGluZXRfcHRvbiBmdW5jdGlvbmFsaXR5IGlzIGF2YWlsYWJsZScpCgpAZXhwb3J0CmRlZiBwYWNrZXRfZW51bV90bHZzKHBrdCwgdGx2X3R5cGU9Tm9uZSk6CiAgICBvZmZzZXQgPSAwCiAgICB3aGlsZSBvZmZzZXQgPCBsZW4ocGt0KToKICAgICAgICB0bHYgPSBzdHJ1Y3QudW5wYWNrKCc+SUknLCBwa3Rbb2Zmc2V0Om9mZnNldCArIDhdKQogICAgICAgIGlmIHRsdl90eXBlIGlzIE5vbmUgb3IgKHRsdlsxXSAmIH5UTFZfTUVUQV9UWVBFX0NPTVBSRVNTRUQpID09IHRsdl90eXBlOgogICAgICAgICAgICB2YWwgPSBwa3Rbb2Zmc2V0ICsgODoob2Zmc2V0ICsgOCArICh0bHZbMF0gLSA4KSldCiAgICAgICAgICAgIGlmICh0bHZbMV0gJiBUTFZfTUVUQV9UWVBFX1NUUklORykgPT0gVExWX01FVEFfVFlQRV9TVFJJTkc6CiAgICAgICAgICAgICAgICB2YWwgPSBzdHIodmFsLnNwbGl0KE5VTExfQllURSwgMSlbMF0pCiAgICAgICAgICAgIGVsaWYgKHRsdlsxXSAmIFRMVl9NRVRBX1RZUEVfVUlOVCkgPT0gVExWX01FVEFfVFlQRV9VSU5UOgogICAgICAgICAgICAgICAgdmFsID0gc3RydWN0LnVucGFjaygnPkknLCB2YWwpWzBdCiAgICAgICAgICAgIGVsaWYgKHRsdlsxXSAmIFRMVl9NRVRBX1RZUEVfUVdPUkQpID09IFRMVl9NRVRBX1RZUEVfUVdPUkQ6CiAgICAgICAgICAgICAgICB2YWwgPSBzdHJ1Y3QudW5wYWNrKCc+UScsIHZhbClbMF0KICAgICAgICAgICAgZWxpZiAodGx2WzFdICYgVExWX01FVEFfVFlQRV9CT09MKSA9PSBUTFZfTUVUQV9UWVBFX0JPT0w6CiAgICAgICAgICAgICAgICB2YWwgPSBib29sKHN0cnVjdC51bnBhY2soJ2InLCB2YWwpWzBdKQogICAgICAgICAgICBlbGlmICh0bHZbMV0gJiBUTFZfTUVUQV9UWVBFX1JBVykgPT0gVExWX01FVEFfVFlQRV9SQVc6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHlpZWxkIHsndHlwZSc6IHRsdlsxXSwgJ2xlbmd0aCc6IHRsdlswXSwgJ3ZhbHVlJzogdmFsfQogICAgICAgIG9mZnNldCArPSB0bHZbMF0KICAgIHJhaXNlIFN0b3BJdGVyYXRpb24oKQoKQGV4cG9ydApkZWYgcGFja2V0X2dldF90bHYocGt0LCB0bHZfdHlwZSk6CiAgICB0cnk6CiAgICAgICAgdGx2ID0gbGlzdChwYWNrZXRfZW51bV90bHZzKHBrdCwgdGx2X3R5cGUpKVswXQogICAgZXhjZXB0IEluZGV4RXJyb3I6CiAgICAgICAgcmV0dXJuIHt9CiAgICByZXR1cm4gdGx2CgpAZXhwb3J0CmRlZiB0bHZfcGFjaygqYXJncyk6CiAgICBpZiBsZW4oYXJncykgPT0gMjoKICAgICAgICB0bHYgPSB7J3R5cGUnOmFyZ3NbMF0sICd2YWx1ZSc6YXJnc1sxXX0KICAgIGVsc2U6CiAgICAgICAgdGx2ID0gYXJnc1swXQogICAgZGF0YSA9ICcnCiAgICB2YWx1ZSA9IHRsdlsndmFsdWUnXQogICAgaWYgKHRsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9VSU5UKSA9PSBUTFZfTUVUQV9UWVBFX1VJTlQ6CiAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgZmxvYXQpOgogICAgICAgICAgICB2YWx1ZSA9IGludChyb3VuZCh2YWx1ZSkpCiAgICAgICAgZGF0YSA9IHN0cnVjdC5wYWNrKCc+SUlJJywgMTIsIHRsdlsndHlwZSddLCB2YWx1ZSkKICAgIGVsaWYgKHRsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9RV09SRCkgPT0gVExWX01FVEFfVFlQRV9RV09SRDoKICAgICAgICBkYXRhID0gc3RydWN0LnBhY2soJz5JSVEnLCAxNiwgdGx2Wyd0eXBlJ10sIHZhbHVlKQogICAgZWxpZiAodGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX0JPT0wpID09IFRMVl9NRVRBX1RZUEVfQk9PTDoKICAgICAgICBkYXRhID0gc3RydWN0LnBhY2soJz5JSScsIDksIHRsdlsndHlwZSddKSArIGJ5dGVzKGNocihpbnQoYm9vbCh2YWx1ZSkpKSwgJ1VURi04JykKICAgIGVsc2U6CiAgICAgICAgaWYgc3lzLnZlcnNpb25faW5mb1swXSA8IDMgYW5kIHZhbHVlLl9fY2xhc3NfXy5fX25hbWVfXyA9PSAndW5pY29kZSc6CiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuZW5jb2RlKCdVVEYtOCcpCiAgICAgICAgZWxpZiBub3QgaXNfYnl0ZXModmFsdWUpOgogICAgICAgICAgICB2YWx1ZSA9IGJ5dGVzKHZhbHVlLCAnVVRGLTgnKQogICAgICAgIGlmICh0bHZbJ3R5cGUnXSAmIFRMVl9NRVRBX1RZUEVfU1RSSU5HKSA9PSBUTFZfTUVUQV9UWVBFX1NUUklORzoKICAgICAgICAgICAgZGF0YSA9IHN0cnVjdC5wYWNrKCc+SUknLCA4ICsgbGVuKHZhbHVlKSArIDEsIHRsdlsndHlwZSddKSArIHZhbHVlICsgTlVMTF9CWVRFCiAgICAgICAgZWxpZiAodGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX1JBVykgPT0gVExWX01FVEFfVFlQRV9SQVc6CiAgICAgICAgICAgIGRhdGEgPSBzdHJ1Y3QucGFjaygnPklJJywgOCArIGxlbih2YWx1ZSksIHRsdlsndHlwZSddKSArIHZhbHVlCiAgICAgICAgZWxpZiAodGx2Wyd0eXBlJ10gJiBUTFZfTUVUQV9UWVBFX0dST1VQKSA9PSBUTFZfTUVUQV9UWVBFX0dST1VQOgogICAgICAgICAgICBkYXRhID0gc3RydWN0LnBhY2soJz5JSScsIDggKyBsZW4odmFsdWUpLCB0bHZbJ3R5cGUnXSkgKyB2YWx1ZQogICAgICAgIGVsaWYgKHRsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9DT01QTEVYKSA9PSBUTFZfTUVUQV9UWVBFX0NPTVBMRVg6CiAgICAgICAgICAgIGRhdGEgPSBzdHJ1Y3QucGFjaygnPklJJywgOCArIGxlbih2YWx1ZSksIHRsdlsndHlwZSddKSArIHZhbHVlCiAgICByZXR1cm4gZGF0YQoKQGV4cG9ydApkZWYgdGx2X3BhY2tfcmVzcG9uc2UocmVzdWx0LCByZXNwb25zZSk6CiAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9SRVNVTFQsIHJlc3VsdCkKICAgIHJlc3BvbnNlID0gc3RydWN0LnBhY2soJz5JJywgbGVuKHJlc3BvbnNlKSArIDQpICsgcmVzcG9uc2UKICAgIHJldHVybiByZXNwb25zZQoKI0BleHBvcnQKY2xhc3MgTWV0ZXJwcmV0ZXJGaWxlKG9iamVjdCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgZmlsZV9vYmopOgogICAgICAgIHNlbGYuZmlsZV9vYmogPSBmaWxlX29iagoKICAgIGRlZiBfX2dldGF0dHJfXyhzZWxmLCBuYW1lKToKICAgICAgICByZXR1cm4gZ2V0YXR0cihzZWxmLmZpbGVfb2JqLCBuYW1lKQpleHBvcnQoTWV0ZXJwcmV0ZXJGaWxlKQoKI0BleHBvcnQKY2xhc3MgTWV0ZXJwcmV0ZXJTb2NrZXQob2JqZWN0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzb2NrKToKICAgICAgICBzZWxmLnNvY2sgPSBzb2NrCgogICAgZGVmIF9fZ2V0YXR0cl9fKHNlbGYsIG5hbWUpOgogICAgICAgIHJldHVybiBnZXRhdHRyKHNlbGYuc29jaywgbmFtZSkKZXhwb3J0KE1ldGVycHJldGVyU29ja2V0KQoKI0BleHBvcnQKY2xhc3MgTWV0ZXJwcmV0ZXJTb2NrZXRDbGllbnQoTWV0ZXJwcmV0ZXJTb2NrZXQpOgogICAgcGFzcwpleHBvcnQoTWV0ZXJwcmV0ZXJTb2NrZXRDbGllbnQpCgojQGV4cG9ydApjbGFzcyBNZXRlcnByZXRlclNvY2tldFNlcnZlcihNZXRlcnByZXRlclNvY2tldCk6CiAgICBwYXNzCmV4cG9ydChNZXRlcnByZXRlclNvY2tldFNlcnZlcikKCmNsYXNzIFNURFByb2Nlc3NCdWZmZXIodGhyZWFkaW5nLlRocmVhZCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgc3RkLCBpc19hbGl2ZSk6CiAgICAgICAgdGhyZWFkaW5nLlRocmVhZC5fX2luaXRfXyhzZWxmKQogICAgICAgIHNlbGYuc3RkID0gc3RkCiAgICAgICAgc2VsZi5pc19hbGl2ZSA9IGlzX2FsaXZlCiAgICAgICAgc2VsZi5kYXRhID0gYnl0ZXMoKQogICAgICAgIHNlbGYuZGF0YV9sb2NrID0gdGhyZWFkaW5nLlJMb2NrKCkKCiAgICBkZWYgcnVuKHNlbGYpOgogICAgICAgIGZvciBieXRlIGluIGl0ZXIobGFtYmRhOiBzZWxmLnN0ZC5yZWFkKDEpLCBieXRlcygpKToKICAgICAgICAgICAgc2VsZi5kYXRhX2xvY2suYWNxdWlyZSgpCiAgICAgICAgICAgIHNlbGYuZGF0YSArPSBieXRlCiAgICAgICAgICAgIHNlbGYuZGF0YV9sb2NrLnJlbGVhc2UoKQoKICAgIGRlZiBpc19yZWFkX3JlYWR5KHNlbGYpOgogICAgICAgIHJldHVybiBsZW4oc2VsZi5kYXRhKSAhPSAwCgogICAgZGVmIHBlZWsoc2VsZiwgbCA9IE5vbmUpOgogICAgICAgIGRhdGEgPSBieXRlcygpCiAgICAgICAgc2VsZi5kYXRhX2xvY2suYWNxdWlyZSgpCiAgICAgICAgaWYgbCA9PSBOb25lOgogICAgICAgICAgICBkYXRhID0gc2VsZi5kYXRhCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGF0YSA9IHNlbGYuZGF0YVswOmxdCiAgICAgICAgc2VsZi5kYXRhX2xvY2sucmVsZWFzZSgpCiAgICAgICAgcmV0dXJuIGRhdGEKCiAgICBkZWYgcmVhZChzZWxmLCBsID0gTm9uZSk6CiAgICAgICAgc2VsZi5kYXRhX2xvY2suYWNxdWlyZSgpCiAgICAgICAgZGF0YSA9IHNlbGYucGVlayhsKQogICAgICAgIHNlbGYuZGF0YSA9IHNlbGYuZGF0YVtsZW4oZGF0YSk6XQogICAgICAgIHNlbGYuZGF0YV9sb2NrLnJlbGVhc2UoKQogICAgICAgIHJldHVybiBkYXRhCgojQGV4cG9ydApjbGFzcyBTVERQcm9jZXNzKHN1YnByb2Nlc3MuUG9wZW4pOgogICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgZGVidWdfcHJpbnQoJ1sqXSBzdGFydGluZyBwcm9jZXNzOiAnICsgcmVwcihhcmdzWzBdKSkKICAgICAgICBzdWJwcm9jZXNzLlBvcGVuLl9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncykKICAgICAgICBzZWxmLmVjaG9fcHJvdGVjdGlvbiA9IEZhbHNlCgogICAgZGVmIHN0YXJ0KHNlbGYpOgogICAgICAgIHNlbGYuc3Rkb3V0X3JlYWRlciA9IFNURFByb2Nlc3NCdWZmZXIoc2VsZi5zdGRvdXQsIGxhbWJkYTogc2VsZi5wb2xsKCkgPT0gTm9uZSkKICAgICAgICBzZWxmLnN0ZG91dF9yZWFkZXIuc3RhcnQoKQogICAgICAgIHNlbGYuc3RkZXJyX3JlYWRlciA9IFNURFByb2Nlc3NCdWZmZXIoc2VsZi5zdGRlcnIsIGxhbWJkYTogc2VsZi5wb2xsKCkgPT0gTm9uZSkKICAgICAgICBzZWxmLnN0ZGVycl9yZWFkZXIuc3RhcnQoKQoKICAgIGRlZiB3cml0ZShzZWxmLCBjaGFubmVsX2RhdGEpOgogICAgICAgIHNlbGYuc3RkaW4ud3JpdGUoY2hhbm5lbF9kYXRhKQogICAgICAgIHNlbGYuc3RkaW4uZmx1c2goKQogICAgICAgIGlmIHNlbGYuZWNob19wcm90ZWN0aW9uOgogICAgICAgICAgICBlbmRfdGltZSA9IHRpbWUudGltZSgpICsgMC41CiAgICAgICAgICAgIG91dF9kYXRhID0gYnl0ZXMoKQogICAgICAgICAgICB3aGlsZSAodGltZS50aW1lKCkgPCBlbmRfdGltZSkgYW5kIChvdXRfZGF0YSAhPSBjaGFubmVsX2RhdGEpOgogICAgICAgICAgICAgICAgaWYgc2VsZi5zdGRvdXRfcmVhZGVyLmlzX3JlYWRfcmVhZHkoKToKICAgICAgICAgICAgICAgICAgICBvdXRfZGF0YSA9IHNlbGYuc3Rkb3V0X3JlYWRlci5wZWVrKGxlbihjaGFubmVsX2RhdGEpKQogICAgICAgICAgICBpZiBvdXRfZGF0YSA9PSBjaGFubmVsX2RhdGE6CiAgICAgICAgICAgICAgICBzZWxmLnN0ZG91dF9yZWFkZXIucmVhZChsZW4oY2hhbm5lbF9kYXRhKSkKZXhwb3J0KFNURFByb2Nlc3MpCgpjbGFzcyBUcmFuc3BvcnQob2JqZWN0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzZWxmLmNvbW11bmljYXRpb25fdGltZW91dCA9IFNFU1NJT05fQ09NTVVOSUNBVElPTl9USU1FT1VUCiAgICAgICAgc2VsZi5jb21tdW5pY2F0aW9uX2xhc3QgPSAwCiAgICAgICAgc2VsZi5yZXRyeV90b3RhbCA9IFNFU1NJT05fUkVUUllfVE9UQUwKICAgICAgICBzZWxmLnJldHJ5X3dhaXQgPSBTRVNTSU9OX1JFVFJZX1dBSVQKICAgICAgICBzZWxmLnJlcXVlc3RfcmV0aXJlID0gRmFsc2UKCiAgICBkZWYgX19yZXByX18oc2VsZik6CiAgICAgICAgcmV0dXJuICI8ezB9IHVybD0nezF9JyA+Ii5mb3JtYXQoc2VsZi5fX2NsYXNzX18uX19uYW1lX18sIHNlbGYudXJsKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGNvbW11bmljYXRpb25faGFzX2V4cGlyZWQoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuY29tbXVuaWNhdGlvbl9sYXN0ICsgc2VsZi5jb21tdW5pY2F0aW9uX3RpbWVvdXQgPCB0aW1lLnRpbWUoKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHNob3VsZF9yZXRpcmUoc2VsZik6CiAgICAgICAgcmV0dXJuIHNlbGYuY29tbXVuaWNhdGlvbl9oYXNfZXhwaXJlZCBvciBzZWxmLnJlcXVlc3RfcmV0aXJlCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGZyb21fcmVxdWVzdChyZXF1ZXN0KToKICAgICAgICB1cmwgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19VUkwpWyd2YWx1ZSddCiAgICAgICAgaWYgdXJsLnN0YXJ0c3dpdGgoJ3RjcCcpOgogICAgICAgICAgICB0cmFuc3BvcnQgPSBUY3BUcmFuc3BvcnQodXJsKQogICAgICAgIGVsaWYgdXJsLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgcHJveHkgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19QUk9YWV9IT1NUKS5nZXQoJ3ZhbHVlJykKICAgICAgICAgICAgdXNlcl9hZ2VudCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1VBKS5nZXQoJ3ZhbHVlJywgSFRUUF9VU0VSX0FHRU5UKQogICAgICAgICAgICBodHRwX2hlYWRlcnMgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19IRUFERVJTKS5nZXQoJ3ZhbHVlJywgTm9uZSkKICAgICAgICAgICAgdHJhbnNwb3J0ID0gSHR0cFRyYW5zcG9ydCh1cmwsIHByb3h5PXByb3h5LCB1c2VyX2FnZW50PXVzZXJfYWdlbnQpCiAgICAgICAgICAgIGlmIGh0dHBfaGVhZGVyczoKICAgICAgICAgICAgICAgIGhlYWRlcnMgPSB7fQogICAgICAgICAgICAgICAgZm9yIGggaW4gaHR0cF9oZWFkZXJzLnN0cmlwKCkuc3BsaXQoIlxyXG4iKToKICAgICAgICAgICAgICAgICAgICBwID0gaC5zcGxpdCgnOicpCiAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1twWzBdLnVwcGVyKCldID0gJycuam9pbihwWzE6MF0pCiAgICAgICAgICAgICAgICBodHRwX2hvc3QgPSBoZWFkZXJzLmdldCgnSE9TVCcpCiAgICAgICAgICAgICAgICBodHRwX2Nvb2tpZSA9IGhlYWRlcnMuZ2V0KCdDT09LSUUnKQogICAgICAgICAgICAgICAgaHR0cF9yZWZlcmVyID0gaGVhZGVycy5nZXQoJ1JFRkVSRVInKQogICAgICAgICAgICAgICAgdHJhbnNwb3J0ID0gSHR0cFRyYW5zcG9ydCh1cmwsIHByb3h5PXByb3h5LCB1c2VyX2FnZW50PXVzZXJfYWdlbnQsIGh0dHBfaG9zdD1odHRwX2hvc3QsCiAgICAgICAgICAgICAgICAgICAgICAgIGh0dHBfY29va2llPWh0dHBfY29va2llLCBodHRwX3JlZmVyZXI9aHR0cF9yZWZlcmVyKQogICAgICAgIHRyYW5zcG9ydC5jb21tdW5pY2F0aW9uX3RpbWVvdXQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19DT01NX1RJTUVPVVQpLmdldCgndmFsdWUnLCBTRVNTSU9OX0NPTU1VTklDQVRJT05fVElNRU9VVCkKICAgICAgICB0cmFuc3BvcnQucmV0cnlfdG90YWwgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19SRVRSWV9UT1RBTCkuZ2V0KCd2YWx1ZScsIFNFU1NJT05fUkVUUllfVE9UQUwpCiAgICAgICAgdHJhbnNwb3J0LnJldHJ5X3dhaXQgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19SRVRSWV9XQUlUKS5nZXQoJ3ZhbHVlJywgU0VTU0lPTl9SRVRSWV9XQUlUKQogICAgICAgIHJldHVybiB0cmFuc3BvcnQKCiAgICBkZWYgX2FjdGl2YXRlKHNlbGYpOgogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIGFjdGl2YXRlKHNlbGYpOgogICAgICAgIGVuZF90aW1lID0gdGltZS50aW1lKCkgKyBzZWxmLnJldHJ5X3RvdGFsCiAgICAgICAgd2hpbGUgdGltZS50aW1lKCkgPCBlbmRfdGltZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWN0aXZhdGVfc3VjY2VlZGVkID0gc2VsZi5fYWN0aXZhdGUoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBhY3RpdmF0ZV9zdWNjZWVkZWQgPSBGYWxzZQogICAgICAgICAgICBpZiBhY3RpdmF0ZV9zdWNjZWVkZWQ6CiAgICAgICAgICAgICAgICBzZWxmLmNvbW11bmljYXRpb25fbGFzdCA9IHRpbWUudGltZSgpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICB0aW1lLnNsZWVwKHNlbGYucmV0cnlfd2FpdCkKICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgX2RlYWN0aXZhdGUoc2VsZik6CiAgICAgICAgcmV0dXJuCgogICAgZGVmIGRlYWN0aXZhdGUoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLl9kZWFjdGl2YXRlKCkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBzZWxmLmNvbW11bmljYXRpb25fbGFzdCA9IDAKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBkZWNyeXB0X3BhY2tldChzZWxmLCBwa3QpOgogICAgICAgIGlmIHBrdCBhbmQgbGVuKHBrdCkgPiBQQUNLRVRfSEVBREVSX1NJWkU6CiAgICAgICAgICAgICMgV2UgZG9uJ3Qgc3VwcG9ydCBBRVMgZW5jcnlwdGlvbiB5ZXQsIHNvIGp1c3QgZG8gdGhlIG5vcm1hbAogICAgICAgICAgICAjIFhPUiB0aGluZyBhbmQgbW92ZSBvbgogICAgICAgICAgICB4b3Jfa2V5ID0gc3RydWN0LnVucGFjaygnQkJCQicsIHBrdFs6UEFDS0VUX1hPUl9LRVlfU0laRV0pCiAgICAgICAgICAgIHJhdyA9IHhvcl9ieXRlcyh4b3Jfa2V5LCBwa3QpCiAgICAgICAgICAgIHJldHVybiByYXdbUEFDS0VUX0hFQURFUl9TSVpFOl0KICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBnZXRfcGFja2V0KHNlbGYpOgogICAgICAgIHNlbGYucmVxdWVzdF9yZXRpcmUgPSBGYWxzZQogICAgICAgIHRyeToKICAgICAgICAgICAgcGt0ID0gc2VsZi5kZWNyeXB0X3BhY2tldChzZWxmLl9nZXRfcGFja2V0KCkpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBkZWJ1Z190cmFjZWJhY2soKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGlmIHBrdCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIHNlbGYuY29tbXVuaWNhdGlvbl9sYXN0ID0gdGltZS50aW1lKCkKICAgICAgICByZXR1cm4gcGt0CgogICAgZGVmIGVuY3J5cHRfcGFja2V0KHNlbGYsIHBrdCk6CiAgICAgICAgIyBUaGUgcGFja2V0IG5vdyBoYXMgdG8gY29udGFpbiBzZXNzaW9uIEdVSUQgYW5kIGVuY3J5cHRpb24gZmxhZyBpbmZvCiAgICAgICAgIyBBbmQgZ2l2ZW4gdGhhdCB3ZSdyZSBub3QgeWV0IHN1cHBvcnRpbmcgQUVTLCB3ZSdyZSBnb2luZyB0byBqdXN0CiAgICAgICAgIyBhbHdheXMgcmV0dXJuIHRoZSBzZXNzaW9uIGd1aWQgYW5kIHRoZSBlbmNyeXB0aW9uIGZsYWcgc2V0IHRvIDAKICAgICAgICAjIFRPRE86IHdlJ2xsIGFkZCBlbmNyeXB0aW9uIHNvb24hCiAgICAgICAgeG9yX2tleSA9IHJhbmRfeG9yX2tleSgpCiAgICAgICAgcmF3ID0gYmluYXNjaWkuYTJiX2hleChieXRlcyhTRVNTSU9OX0dVSUQsICdVVEYtOCcpKSArIHN0cnVjdC5wYWNrKCc+SScsIEVOQ19OT05FKSArIHBrdAogICAgICAgIHJlc3VsdCA9IHN0cnVjdC5wYWNrKCdCQkJCJywgKnhvcl9rZXkpICsgeG9yX2J5dGVzKHhvcl9rZXksIHJhdykKICAgICAgICByZXR1cm4gcmVzdWx0CgogICAgZGVmIHNlbmRfcGFja2V0KHNlbGYsIHBrdCk6CiAgICAgICAgc2VsZi5yZXF1ZXN0X3JldGlyZSA9IEZhbHNlCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLl9zZW5kX3BhY2tldChzZWxmLmVuY3J5cHRfcGFja2V0KHBrdCkpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBkZWJ1Z190cmFjZWJhY2soKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBzZWxmLmNvbW11bmljYXRpb25fbGFzdCA9IHRpbWUudGltZSgpCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgdGx2X3BhY2tfdGltZW91dHMoc2VsZik6CiAgICAgICAgcmVzcG9uc2UgID0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfQ09NTV9USU1FT1VULCBzZWxmLmNvbW11bmljYXRpb25fdGltZW91dCkKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19SRVRSWV9UT1RBTCwgc2VsZi5yZXRyeV90b3RhbCkKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19SRVRSWV9XQUlULCBzZWxmLnJldHJ5X3dhaXQpCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlCgogICAgZGVmIHRsdl9wYWNrX3RyYW5zcG9ydF9ncm91cChzZWxmKToKICAgICAgICB0cmFuc19ncm91cCAgPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19VUkwsIHNlbGYudXJsKQogICAgICAgIHRyYW5zX2dyb3VwICs9IHNlbGYudGx2X3BhY2tfdGltZW91dHMoKQogICAgICAgIHJldHVybiB0cmFuc19ncm91cAoKY2xhc3MgSHR0cFRyYW5zcG9ydChUcmFuc3BvcnQpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHVybCwgcHJveHk9Tm9uZSwgdXNlcl9hZ2VudD1Ob25lLCBodHRwX2hvc3Q9Tm9uZSwgaHR0cF9yZWZlcmVyPU5vbmUsIGh0dHBfY29va2llPU5vbmUpOgogICAgICAgIHN1cGVyKEh0dHBUcmFuc3BvcnQsIHNlbGYpLl9faW5pdF9fKCkKICAgICAgICBvcGVuZXJfYXJncyA9IFtdCiAgICAgICAgc2NoZW1lID0gdXJsLnNwbGl0KCc6JywgMSlbMF0KICAgICAgICBpZiBzY2hlbWUgPT0gJ2h0dHBzJyBhbmQgKChzeXMudmVyc2lvbl9pbmZvWzBdID09IDIgYW5kIHN5cy52ZXJzaW9uX2luZm8gPj0gKDIsIDcsIDkpKSBvciBzeXMudmVyc2lvbl9pbmZvID49ICgzLCA0LCAzKSk6CiAgICAgICAgICAgIGltcG9ydCBzc2wKICAgICAgICAgICAgc3NsX2N0eCA9IHNzbC5TU0xDb250ZXh0KHNzbC5QUk9UT0NPTF9TU0x2MjMpCiAgICAgICAgICAgIHNzbF9jdHguY2hlY2tfaG9zdG5hbWUgPSBGYWxzZQogICAgICAgICAgICBzc2xfY3R4LnZlcmlmeV9tb2RlID0gc3NsLkNFUlRfTk9ORQogICAgICAgICAgICBvcGVuZXJfYXJncy5hcHBlbmQodXJsbGliLkhUVFBTSGFuZGxlcigwLCBzc2xfY3R4KSkKICAgICAgICBpZiBwcm94eToKICAgICAgICAgICAgb3BlbmVyX2FyZ3MuYXBwZW5kKHVybGxpYi5Qcm94eUhhbmRsZXIoe3NjaGVtZTogcHJveHl9KSkKICAgICAgICBzZWxmLnByb3h5ID0gcHJveHkKICAgICAgICBvcGVuZXIgPSB1cmxsaWIuYnVpbGRfb3BlbmVyKCpvcGVuZXJfYXJncykKICAgICAgICBvcGVuZXIuYWRkaGVhZGVycyA9IFtdCiAgICAgICAgaWYgdXNlcl9hZ2VudDoKICAgICAgICAgICAgb3BlbmVyLmFkZGhlYWRlcnMuYXBwZW5kKCgnVXNlci1BZ2VudCcsIHVzZXJfYWdlbnQpKQogICAgICAgIGlmIGh0dHBfY29va2llOgogICAgICAgICAgICBvcGVuZXIuYWRkaGVhZGVycy5hcHBlbmQoKCdDb29raWUnLCBodHRwX2Nvb2tpZSkpCiAgICAgICAgaWYgaHR0cF9yZWZlcmVyOgogICAgICAgICAgICBvcGVuZXIuYWRkaGVhZGVycy5hcHBlbmQoKCdSZWZlcmVyJywgaHR0cF9yZWZlcmVyKSkKICAgICAgICBzZWxmLnVzZXJfYWdlbnQgPSB1c2VyX2FnZW50CiAgICAgICAgdXJsbGliLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgICAgICBzZWxmLnVybCA9IHVybAogICAgICAgIHNlbGYuX2h0dHBfcmVxdWVzdF9oZWFkZXJzID0geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJ30KICAgICAgICBpZiBodHRwX2hvc3Q6CiAgICAgICAgICAgIHNlbGYuX2h0dHBfcmVxdWVzdF9oZWFkZXJzWydIb3N0J10gPSBodHRwX2hvc3QKICAgICAgICBzZWxmLl9maXJzdF9wYWNrZXQgPSBOb25lCiAgICAgICAgc2VsZi5fZW1wdHlfY250ID0gMAoKICAgIGRlZiBfYWN0aXZhdGUoc2VsZik6CiAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBzZWxmLl9maXJzdF9wYWNrZXQgPSBOb25lCiAgICAgICAgcGFja2V0ID0gc2VsZi5fZ2V0X3BhY2tldCgpCiAgICAgICAgaWYgcGFja2V0IGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIHNlbGYuX2ZpcnN0X3BhY2tldCA9IHBhY2tldAogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIF9nZXRfcGFja2V0KHNlbGYpOgogICAgICAgIGlmIHNlbGYuX2ZpcnN0X3BhY2tldDoKICAgICAgICAgICAgcGFja2V0ID0gc2VsZi5fZmlyc3RfcGFja2V0CiAgICAgICAgICAgIHNlbGYuX2ZpcnN0X3BhY2tldCA9IE5vbmUKICAgICAgICAgICAgcmV0dXJuIHBhY2tldAogICAgICAgIHBhY2tldCA9IE5vbmUKICAgICAgICB4b3Jfa2V5ID0gTm9uZQogICAgICAgIHJlcXVlc3QgPSB1cmxsaWIuUmVxdWVzdChzZWxmLnVybCwgTm9uZSwgc2VsZi5faHR0cF9yZXF1ZXN0X2hlYWRlcnMpCiAgICAgICAgdHJ5OgogICAgICAgICAgICB1cmxfaCA9IHVybGxpYi51cmxvcGVuKHJlcXVlc3QsIHRpbWVvdXQ9c2VsZi5jb21tdW5pY2F0aW9uX3RpbWVvdXQpCiAgICAgICAgICAgIHBhY2tldCA9IHVybF9oLnJlYWQoKQogICAgICAgICAgICBmb3IgXyBpbiByYW5nZSgxKToKICAgICAgICAgICAgICAgIGlmIHBhY2tldCA9PSAnJzoKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgaWYgbGVuKHBhY2tldCkgPCBQQUNLRVRfSEVBREVSX1NJWkU6CiAgICAgICAgICAgICAgICAgICAgcGFja2V0ID0gTm9uZSAgIyBsb29rcyBjb3JydXB0CiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIHhvcl9rZXkgPSBzdHJ1Y3QudW5wYWNrKCdCQkJCJywgcGFja2V0WzpQQUNLRVRfWE9SX0tFWV9TSVpFXSkKICAgICAgICAgICAgICAgIGhlYWRlciA9IHhvcl9ieXRlcyh4b3Jfa2V5LCBwYWNrZXRbOlBBQ0tFVF9IRUFERVJfU0laRV0pCiAgICAgICAgICAgICAgICBwa3RfbGVuZ3RoID0gc3RydWN0LnVucGFjaygnPkknLCBoZWFkZXJbUEFDS0VUX0xFTkdUSF9PRkY6UEFDS0VUX0xFTkdUSF9PRkYrUEFDS0VUX0xFTkdUSF9TSVpFXSlbMF0gLSA4CiAgICAgICAgICAgICAgICBpZiBsZW4ocGFja2V0KSAhPSAocGt0X2xlbmd0aCArIFBBQ0tFVF9IRUFERVJfU0laRSk6CiAgICAgICAgICAgICAgICAgICAgcGFja2V0ID0gTm9uZSAgIyBsb29rcyBjb3JydXB0CiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBkZWJ1Z190cmFjZWJhY2soJ0ZhaWx1cmUgdG8gcmVjZWl2ZSBwYWNrZXQgZnJvbSAnICsgc2VsZi51cmwpCgogICAgICAgIGlmIG5vdCBwYWNrZXQ6CiAgICAgICAgICAgIGRlbGF5ID0gMTAgKiBzZWxmLl9lbXB0eV9jbnQKICAgICAgICAgICAgaWYgc2VsZi5fZW1wdHlfY250ID49IDA6CiAgICAgICAgICAgICAgICBkZWxheSAqPSAxMAogICAgICAgICAgICBzZWxmLl9lbXB0eV9jbnQgKz0gMQogICAgICAgICAgICB0aW1lLnNsZWVwKGZsb2F0KG1pbigxMDAwMCwgZGVsYXkpKSAvIDEwMDApCiAgICAgICAgICAgIHJldHVybiBwYWNrZXQKCiAgICAgICAgc2VsZi5fZW1wdHlfY250ID0gMAogICAgICAgIHJldHVybiBwYWNrZXQKCiAgICBkZWYgX3NlbmRfcGFja2V0KHNlbGYsIHBhY2tldCk6CiAgICAgICAgcmVxdWVzdCA9IHVybGxpYi5SZXF1ZXN0KHNlbGYudXJsLCBwYWNrZXQsIHNlbGYuX2h0dHBfcmVxdWVzdF9oZWFkZXJzKQogICAgICAgIHVybF9oID0gdXJsbGliLnVybG9wZW4ocmVxdWVzdCwgdGltZW91dD1zZWxmLmNvbW11bmljYXRpb25fdGltZW91dCkKICAgICAgICByZXNwb25zZSA9IHVybF9oLnJlYWQoKQoKICAgIGRlZiBwYXRjaF91cmlfcGF0aChzZWxmLCBuZXdfcGF0aCk6CiAgICAgICAgbWF0Y2ggPSByZS5tYXRjaChyJ2h0dHBzPzovL1teL10rKC8uKiQpJywgc2VsZi51cmwpCiAgICAgICAgaWYgbWF0Y2ggaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgc2VsZi51cmwgPSBzZWxmLnVybFs6bWF0Y2guc3BhbigxKVswXV0gKyBuZXdfcGF0aAogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmIHRsdl9wYWNrX3RyYW5zcG9ydF9ncm91cChzZWxmKToKICAgICAgICB0cmFuc19ncm91cCAgPSBzdXBlcihIdHRwVHJhbnNwb3J0LCBzZWxmKS50bHZfcGFja190cmFuc3BvcnRfZ3JvdXAoKQogICAgICAgIGlmIHNlbGYudXNlcl9hZ2VudDoKICAgICAgICAgICAgdHJhbnNfZ3JvdXAgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfVUEsIHNlbGYudXNlcl9hZ2VudCkKICAgICAgICBpZiBzZWxmLnByb3h5OgogICAgICAgICAgICB0cmFuc19ncm91cCArPSB0bHZfcGFjayhUTFZfVFlQRV9UUkFOU19QUk9YWV9IT1NULCBzZWxmLnByb3h5KQogICAgICAgIHJldHVybiB0cmFuc19ncm91cAoKY2xhc3MgVGNwVHJhbnNwb3J0KFRyYW5zcG9ydCk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgdXJsLCBzb2NrZXQ9Tm9uZSk6CiAgICAgICAgc3VwZXIoVGNwVHJhbnNwb3J0LCBzZWxmKS5fX2luaXRfXygpCiAgICAgICAgc2VsZi51cmwgPSB1cmwKICAgICAgICBzZWxmLnNvY2tldCA9IHNvY2tldAogICAgICAgIHNlbGYuX2NsZWFudXBfdGhyZWFkID0gTm9uZQogICAgICAgIHNlbGYuX2ZpcnN0X3BhY2tldCA9IFRydWUKCiAgICBkZWYgX3NvY2tfY2xlYW51cChzZWxmLCBzb2NrKToKICAgICAgICByZW1haW5pbmdfdGltZSA9IHNlbGYuY29tbXVuaWNhdGlvbl90aW1lb3V0CiAgICAgICAgd2hpbGUgcmVtYWluaW5nX3RpbWUgPiAwOgogICAgICAgICAgICBpdGVyX3N0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICBpZiBzZWxlY3Quc2VsZWN0KFtzb2NrXSwgW10sIFtdLCByZW1haW5pbmdfdGltZSlbMF06CiAgICAgICAgICAgICAgICBpZiBsZW4oc29jay5yZWN2KDQwOTYpKSA9PSAwOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIHJlbWFpbmluZ190aW1lIC09IHRpbWUudGltZSgpIC0gaXRlcl9zdGFydF90aW1lCiAgICAgICAgc29jay5jbG9zZSgpCgogICAgZGVmIF9hY3RpdmF0ZShzZWxmKToKICAgICAgICBhZGRyZXNzLCBwb3J0ID0gc2VsZi51cmxbNjpdLnJzcGxpdCgnOicsIDEpCiAgICAgICAgcG9ydCA9IGludChwb3J0LnJzdHJpcCgnLycpKQogICAgICAgIHRpbWVvdXQgPSBtYXgoc2VsZi5jb21tdW5pY2F0aW9uX3RpbWVvdXQsIDMwKQogICAgICAgIGlmIGFkZHJlc3MgaW4gKCcnLCAnMC4wLjAuMCcsICc6OicpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZXJ2ZXJfc29jayA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQ2LCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgICAgICAgICAgICBzZXJ2ZXJfc29jay5zZXRzb2Nrb3B0KHNvY2tldC5JUFBST1RPX0lQVjYsIHNvY2tldC5JUFY2X1Y2T05MWSwgMCkKICAgICAgICAgICAgZXhjZXB0IChBdHRyaWJ1dGVFcnJvciwgc29ja2V0LmVycm9yKToKICAgICAgICAgICAgICAgIHNlcnZlcl9zb2NrID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfU1RSRUFNKQogICAgICAgICAgICBzZXJ2ZXJfc29jay5iaW5kKCgnJywgcG9ydCkpCiAgICAgICAgICAgIHNlcnZlcl9zb2NrLmxpc3RlbigxKQogICAgICAgICAgICBpZiBub3Qgc2VsZWN0LnNlbGVjdChbc2VydmVyX3NvY2tdLCBbXSwgW10sIHRpbWVvdXQpWzBdOgogICAgICAgICAgICAgICAgc2VydmVyX3NvY2suY2xvc2UoKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIHNvY2ssIF8gPSBzZXJ2ZXJfc29jay5hY2NlcHQoKQogICAgICAgICAgICBzZXJ2ZXJfc29jay5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgJzonIGluIGFkZHJlc3M6CiAgICAgICAgICAgICAgICBzb2NrID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVDYsIHNvY2tldC5TT0NLX1NUUkVBTSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNvY2sgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgICAgICAgIHNvY2suc2V0dGltZW91dCh0aW1lb3V0KQogICAgICAgICAgICBzb2NrLmNvbm5lY3QoKGFkZHJlc3MsIHBvcnQpKQogICAgICAgICAgICBzb2NrLnNldHRpbWVvdXQoTm9uZSkKICAgICAgICBzZWxmLnNvY2tldCA9IHNvY2sKICAgICAgICBzZWxmLl9maXJzdF9wYWNrZXQgPSBUcnVlCiAgICAgICAgcmV0dXJuIFRydWUKCiAgICBkZWYgX2RlYWN0aXZhdGUoc2VsZik6CiAgICAgICAgY2xlYW51cCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PXNlbGYuX3NvY2tfY2xlYW51cCwgYXJncz0oc2VsZi5zb2NrZXQsKSkKICAgICAgICBjbGVhbnVwLnJ1bigpCiAgICAgICAgc2VsZi5zb2NrZXQgPSBOb25lCgogICAgZGVmIF9nZXRfcGFja2V0KHNlbGYpOgogICAgICAgIGZpcnN0ID0gc2VsZi5fZmlyc3RfcGFja2V0CiAgICAgICAgc2VsZi5fZmlyc3RfcGFja2V0ID0gRmFsc2UKICAgICAgICBpZiBub3Qgc2VsZWN0LnNlbGVjdChbc2VsZi5zb2NrZXRdLCBbXSwgW10sIDAuNSlbMF06CiAgICAgICAgICAgIHJldHVybiBieXRlcygpCiAgICAgICAgcGFja2V0ID0gc2VsZi5zb2NrZXQucmVjdihQQUNLRVRfSEVBREVSX1NJWkUpCiAgICAgICAgaWYgcGFja2V0ID09ICcnOiAgIyByZW1vdGUgaXMgY2xvc2VkCiAgICAgICAgICAgIHNlbGYucmVxdWVzdF9yZXRpcmUgPSBUcnVlCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgaWYgbGVuKHBhY2tldCkgIT0gUEFDS0VUX0hFQURFUl9TSVpFOgogICAgICAgICAgICBpZiBmaXJzdCBhbmQgbGVuKHBhY2tldCkgPT0gNDoKICAgICAgICAgICAgICAgIHJlY2VpdmVkID0gMAogICAgICAgICAgICAgICAgaGVhZGVyID0gcGFja2V0Wzo0XQogICAgICAgICAgICAgICAgcGt0X2xlbmd0aCA9IHN0cnVjdC51bnBhY2soJz5JJywgaGVhZGVyKVswXQogICAgICAgICAgICAgICAgc2VsZi5zb2NrZXQuc2V0dGltZW91dChtYXgoc2VsZi5jb21tdW5pY2F0aW9uX3RpbWVvdXQsIDMwKSkKICAgICAgICAgICAgICAgIHdoaWxlIHJlY2VpdmVkIDwgcGt0X2xlbmd0aDoKICAgICAgICAgICAgICAgICAgICByZWNlaXZlZCArPSBsZW4oc2VsZi5zb2NrZXQucmVjdihwa3RfbGVuZ3RoIC0gcmVjZWl2ZWQpKQogICAgICAgICAgICAgICAgc2VsZi5zb2NrZXQuc2V0dGltZW91dChOb25lKQogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2dldF9wYWNrZXQoKQogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICB4b3Jfa2V5ID0gc3RydWN0LnVucGFjaygnQkJCQicsIHBhY2tldFs6UEFDS0VUX1hPUl9LRVlfU0laRV0pCiAgICAgICAgIyBYT1IgdGhlIHdob2xlIGhlYWRlciBmaXJzdAogICAgICAgIGhlYWRlciA9IHhvcl9ieXRlcyh4b3Jfa2V5LCBwYWNrZXRbOlBBQ0tFVF9IRUFERVJfU0laRV0pCiAgICAgICAgIyBFeHRyYWN0IGp1c3QgdGhlIGxlbmd0aAogICAgICAgIHBrdF9sZW5ndGggPSBzdHJ1Y3QudW5wYWNrKCc+SScsIGhlYWRlcltQQUNLRVRfTEVOR1RIX09GRjpQQUNLRVRfTEVOR1RIX09GRitQQUNLRVRfTEVOR1RIX1NJWkVdKVswXQogICAgICAgIHBrdF9sZW5ndGggLT0gOAogICAgICAgICMgUmVhZCB0aGUgcmVzdCBvZiB0aGUgcGFja2V0CiAgICAgICAgcmVzdCA9IGJ5dGVzKCkKICAgICAgICB3aGlsZSBsZW4ocmVzdCkgPCBwa3RfbGVuZ3RoOgogICAgICAgICAgICByZXN0ICs9IHNlbGYuc29ja2V0LnJlY3YocGt0X2xlbmd0aCAtIGxlbihyZXN0KSkKICAgICAgICAjIHJldHVybiB0aGUgd2hvbGUgcGFja2V0LCBhcyBpdCdzIGRlY29kZWQgc2VwYXJhdGVseQogICAgICAgIHJldHVybiBwYWNrZXQgKyByZXN0CgogICAgZGVmIF9zZW5kX3BhY2tldChzZWxmLCBwYWNrZXQpOgogICAgICAgIHNlbGYuc29ja2V0LnNlbmQocGFja2V0KQoKICAgIEBjbGFzc21ldGhvZAogICAgZGVmIGZyb21fc29ja2V0KGNscywgc29jayk6CiAgICAgICAgdXJsID0gJ3RjcDovLycKICAgICAgICBhZGRyZXNzLCBwb3J0ID0gc29jay5nZXRzb2NrbmFtZSgpWzoyXQogICAgICAgICMgdGhpcyB3aWxsIG5lZWQgdG8gYmUgY2hhbmdlZCBpZiB0aGUgYmluZCBzdGFnZXIgZXZlciBzdXBwb3J0cyBiaW5kaW5nIHRvIGEgc3BlY2lmaWMgYWRkcmVzcwogICAgICAgIGlmIG5vdCBhZGRyZXNzIGluICgnJywgJzAuMC4wLjAnLCAnOjonKToKICAgICAgICAgICAgYWRkcmVzcywgcG9ydCA9IHNvY2suZ2V0cGVlcm5hbWUoKVs6Ml0KICAgICAgICB1cmwgKz0gYWRkcmVzcyArICc6JyArIHN0cihwb3J0KQogICAgICAgIHJldHVybiBjbHModXJsLCBzb2NrKQoKY2xhc3MgUHl0aG9uTWV0ZXJwcmV0ZXIob2JqZWN0KToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB0cmFuc3BvcnQpOgogICAgICAgIHNlbGYudHJhbnNwb3J0ID0gdHJhbnNwb3J0CiAgICAgICAgc2VsZi5fdHJhbnNwb3J0X3NsZWVwID0gTm9uZQogICAgICAgIHNlbGYucnVubmluZyA9IEZhbHNlCiAgICAgICAgc2VsZi5sYXN0X3JlZ2lzdGVyZWRfZXh0ZW5zaW9uID0gTm9uZQogICAgICAgIHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9ucyA9IHt9CiAgICAgICAgc2VsZi5jaGFubmVscyA9IHt9CiAgICAgICAgc2VsZi5uZXh0X2NoYW5uZWxfaWQgPSAxCiAgICAgICAgc2VsZi5pbnRlcmFjdF9jaGFubmVscyA9IFtdCiAgICAgICAgc2VsZi5wcm9jZXNzZXMgPSB7fQogICAgICAgIHNlbGYubmV4dF9wcm9jZXNzX2lkID0gMQogICAgICAgIHNlbGYudHJhbnNwb3J0cyA9IFtzZWxmLnRyYW5zcG9ydF0KICAgICAgICBzZWxmLnNlc3Npb25fZXhwaXJ5X3RpbWUgPSBTRVNTSU9OX0VYUElSQVRJT05fVElNRU9VVAogICAgICAgIHNlbGYuc2Vzc2lvbl9leHBpcnlfZW5kID0gdGltZS50aW1lKCkgKyBzZWxmLnNlc3Npb25fZXhwaXJ5X3RpbWUKICAgICAgICBmb3IgZnVuYyBpbiBsaXN0KGZpbHRlcihsYW1iZGEgeDogeC5zdGFydHN3aXRoKCdfY29yZScpLCBkaXIoc2VsZikpKToKICAgICAgICAgICAgc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zW2Z1bmNbMTpdXSA9IGdldGF0dHIoc2VsZiwgZnVuYykKICAgICAgICBzZWxmLnJ1bm5pbmcgPSBUcnVlCgogICAgZGVmIHJlZ2lzdGVyX2V4dGVuc2lvbihzZWxmLCBleHRlbnNpb25fbmFtZSk6CiAgICAgICAgc2VsZi5sYXN0X3JlZ2lzdGVyZWRfZXh0ZW5zaW9uID0gZXh0ZW5zaW9uX25hbWUKICAgICAgICByZXR1cm4gc2VsZi5sYXN0X3JlZ2lzdGVyZWRfZXh0ZW5zaW9uCgogICAgZGVmIHJlZ2lzdGVyX2Z1bmN0aW9uKHNlbGYsIGZ1bmMpOgogICAgICAgIHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9uc1tmdW5jLl9fbmFtZV9fXSA9IGZ1bmMKICAgICAgICByZXR1cm4gZnVuYwoKICAgIGRlZiByZWdpc3Rlcl9mdW5jdGlvbl9pZihzZWxmLCBjb25kaXRpb24pOgogICAgICAgIGlmIGNvbmRpdGlvbjoKICAgICAgICAgICAgcmV0dXJuIHNlbGYucmVnaXN0ZXJfZnVuY3Rpb24KICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gbGFtYmRhIGZ1bmN0aW9uOiBmdW5jdGlvbgoKICAgIGRlZiByZWdpc3Rlcl9mdW5jdGlvbl93aW5kbGwoc2VsZiwgZnVuYyk6CiAgICAgICAgaWYgaGFzX3dpbmRsbDoKICAgICAgICAgICAgc2VsZi5yZWdpc3Rlcl9mdW5jdGlvbihmdW5jKQogICAgICAgIHJldHVybiBmdW5jCgogICAgZGVmIGFkZF9jaGFubmVsKHNlbGYsIGNoYW5uZWwpOgogICAgICAgIGFzc2VydChpc2luc3RhbmNlKGNoYW5uZWwsIChzdWJwcm9jZXNzLlBvcGVuLCBNZXRlcnByZXRlckZpbGUsIE1ldGVycHJldGVyU29ja2V0KSkpCiAgICAgICAgaWR4ID0gc2VsZi5uZXh0X2NoYW5uZWxfaWQKICAgICAgICBzZWxmLmNoYW5uZWxzW2lkeF0gPSBjaGFubmVsCiAgICAgICAgZGVidWdfcHJpbnQoJ1sqXSBhZGRlZCBjaGFubmVsIGlkOiAnICsgc3RyKGlkeCkgKyAnIHR5cGU6ICcgKyBjaGFubmVsLl9fY2xhc3NfXy5fX25hbWVfXykKICAgICAgICBzZWxmLm5leHRfY2hhbm5lbF9pZCArPSAxCiAgICAgICAgcmV0dXJuIGlkeAoKICAgIGRlZiBhZGRfcHJvY2VzcyhzZWxmLCBwcm9jZXNzKToKICAgICAgICBpZHggPSBzZWxmLm5leHRfcHJvY2Vzc19pZAogICAgICAgIHNlbGYucHJvY2Vzc2VzW2lkeF0gPSBwcm9jZXNzCiAgICAgICAgZGVidWdfcHJpbnQoJ1sqXSBhZGRlZCBwcm9jZXNzIGlkOiAnICsgc3RyKGlkeCkpCiAgICAgICAgc2VsZi5uZXh0X3Byb2Nlc3NfaWQgKz0gMQogICAgICAgIHJldHVybiBpZHgKCiAgICBkZWYgZ2V0X3BhY2tldChzZWxmKToKICAgICAgICBwa3QgPSBzZWxmLnRyYW5zcG9ydC5nZXRfcGFja2V0KCkKICAgICAgICBpZiBwa3QgaXMgTm9uZSBhbmQgc2VsZi50cmFuc3BvcnQuc2hvdWxkX3JldGlyZToKICAgICAgICAgICAgc2VsZi50cmFuc3BvcnRfY2hhbmdlKCkKICAgICAgICByZXR1cm4gcGt0CgogICAgZGVmIHNlbmRfcGFja2V0KHNlbGYsIHBhY2tldCk6CiAgICAgICAgc2VuZF9zdWNjZWVkZWQgPSBzZWxmLnRyYW5zcG9ydC5zZW5kX3BhY2tldChwYWNrZXQpCiAgICAgICAgaWYgbm90IHNlbmRfc3VjY2VlZGVkIGFuZCBzZWxmLnRyYW5zcG9ydC5zaG91bGRfcmV0aXJlOgogICAgICAgICAgICBzZWxmLnRyYW5zcG9ydF9jaGFuZ2UoKQogICAgICAgIHJldHVybiBzZW5kX3N1Y2NlZWRlZAoKICAgIEBwcm9wZXJ0eQogICAgZGVmIHNlc3Npb25faGFzX2V4cGlyZWQoc2VsZik6CiAgICAgICAgaWYgc2VsZi5zZXNzaW9uX2V4cGlyeV90aW1lID09IDA6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIHJldHVybiB0aW1lLnRpbWUoKSA+IHNlbGYuc2Vzc2lvbl9leHBpcnlfZW5kCgogICAgZGVmIHRyYW5zcG9ydF9hZGQoc2VsZiwgbmV3X3RyYW5zcG9ydCk6CiAgICAgICAgbmV3X3Bvc2l0aW9uID0gc2VsZi50cmFuc3BvcnRzLmluZGV4KHNlbGYudHJhbnNwb3J0KQogICAgICAgIHNlbGYudHJhbnNwb3J0cy5pbnNlcnQobmV3X3Bvc2l0aW9uLCBuZXdfdHJhbnNwb3J0KQoKICAgIGRlZiB0cmFuc3BvcnRfY2hhbmdlKHNlbGYsIG5ld190cmFuc3BvcnQ9Tm9uZSk6CiAgICAgICAgaWYgbmV3X3RyYW5zcG9ydCBpcyBOb25lOgogICAgICAgICAgICBuZXdfdHJhbnNwb3J0ID0gc2VsZi50cmFuc3BvcnRfbmV4dCgpCiAgICAgICAgc2VsZi50cmFuc3BvcnQuZGVhY3RpdmF0ZSgpCiAgICAgICAgZGVidWdfcHJpbnQoJ1sqXSBjaGFuZ2luZyB0cmFuc3BvcnQgdG86ICcgKyBuZXdfdHJhbnNwb3J0LnVybCkKICAgICAgICB3aGlsZSBub3QgbmV3X3RyYW5zcG9ydC5hY3RpdmF0ZSgpOgogICAgICAgICAgICBuZXdfdHJhbnNwb3J0ID0gc2VsZi50cmFuc3BvcnRfbmV4dChuZXdfdHJhbnNwb3J0KQogICAgICAgICAgICBkZWJ1Z19wcmludCgnWypdIGNoYW5naW5nIHRyYW5zcG9ydCB0bzogJyArIG5ld190cmFuc3BvcnQudXJsKQogICAgICAgIHNlbGYudHJhbnNwb3J0ID0gbmV3X3RyYW5zcG9ydAoKICAgIGRlZiB0cmFuc3BvcnRfbmV4dChzZWxmLCBjdXJyZW50X3RyYW5zcG9ydD1Ob25lKToKICAgICAgICBpZiBjdXJyZW50X3RyYW5zcG9ydCBpcyBOb25lOgogICAgICAgICAgICBjdXJyZW50X3RyYW5zcG9ydCA9IHNlbGYudHJhbnNwb3J0CiAgICAgICAgbmV3X2lkeCA9IHNlbGYudHJhbnNwb3J0cy5pbmRleChjdXJyZW50X3RyYW5zcG9ydCkgKyAxCiAgICAgICAgaWYgbmV3X2lkeCA9PSBsZW4oc2VsZi50cmFuc3BvcnRzKToKICAgICAgICAgICAgbmV3X2lkeCA9IDAKICAgICAgICByZXR1cm4gc2VsZi50cmFuc3BvcnRzW25ld19pZHhdCgogICAgZGVmIHRyYW5zcG9ydF9wcmV2KHNlbGYsIGN1cnJlbnRfdHJhbnNwb3J0PU5vbmUpOgogICAgICAgIGlmIGN1cnJlbnRfdHJhbnNwb3J0IGlzIE5vbmU6CiAgICAgICAgICAgIGN1cnJlbnRfdHJhbnNwb3J0ID0gc2VsZi50cmFuc3BvcnQKICAgICAgICBuZXdfaWR4ID0gc2VsZi50cmFuc3BvcnRzLmluZGV4KGN1cnJlbnRfdHJhbnNwb3J0KSAtIDEKICAgICAgICBpZiBuZXdfaWR4ID09IC0xOgogICAgICAgICAgICBuZXdfaWR4ID0gbGVuKHNlbGYudHJhbnNwb3J0cykgLSAxCiAgICAgICAgcmV0dXJuIHNlbGYudHJhbnNwb3J0c1tuZXdfaWR4XQoKICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgd2hpbGUgc2VsZi5ydW5uaW5nIGFuZCBub3Qgc2VsZi5zZXNzaW9uX2hhc19leHBpcmVkOgogICAgICAgICAgICByZXF1ZXN0ID0gc2VsZi5nZXRfcGFja2V0KCkKICAgICAgICAgICAgaWYgcmVxdWVzdDoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2VsZi5jcmVhdGVfcmVzcG9uc2UocmVxdWVzdCkKICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9wYWNrZXQocmVzcG9uc2UpCiAgICAgICAgICAgICAgICBpZiBzZWxmLl90cmFuc3BvcnRfc2xlZXA6CiAgICAgICAgICAgICAgICAgICAgc2VsZi50cmFuc3BvcnQuZGVhY3RpdmF0ZSgpCiAgICAgICAgICAgICAgICAgICAgdGltZS5zbGVlcChzZWxmLl90cmFuc3BvcnRfc2xlZXApCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fdHJhbnNwb3J0X3NsZWVwID0gTm9uZQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnRyYW5zcG9ydC5hY3RpdmF0ZSgpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRyYW5zcG9ydF9jaGFuZ2UoKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgIyBpdGVyYXRlIG92ZXIgdGhlIGtleXMgYmVjYXVzZSBzZWxmLmNoYW5uZWxzIGNvdWxkIGJlIG1vZGlmaWVkIGlmIG9uZSBpcyBjbG9zZWQKICAgICAgICAgICAgY2hhbm5lbF9pZHMgPSBsaXN0KHNlbGYuY2hhbm5lbHMua2V5cygpKQogICAgICAgICAgICBmb3IgY2hhbm5lbF9pZCBpbiBjaGFubmVsX2lkczoKICAgICAgICAgICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgICAgICAgICBkYXRhID0gYnl0ZXMoKQogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShjaGFubmVsLCBTVERQcm9jZXNzKToKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2hhbm5lbF9pZCBpbiBzZWxmLmludGVyYWN0X2NoYW5uZWxzOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGNoYW5uZWwuc3RkZXJyX3JlYWRlci5pc19yZWFkX3JlYWR5KCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBjaGFubmVsLnN0ZGVycl9yZWFkZXIucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBjaGFubmVsLnN0ZG91dF9yZWFkZXIuaXNfcmVhZF9yZWFkeSgpOgogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gY2hhbm5lbC5zdGRvdXRfcmVhZGVyLnJlYWQoKQogICAgICAgICAgICAgICAgICAgIGVsaWYgY2hhbm5lbC5wb2xsKCkgIT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVfZGVhZF9yZXNvdXJjZV9jaGFubmVsKGNoYW5uZWxfaWQpCiAgICAgICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgTWV0ZXJwcmV0ZXJTb2NrZXRDbGllbnQpOgogICAgICAgICAgICAgICAgICAgIHdoaWxlIHNlbGVjdC5zZWxlY3QoW2NoYW5uZWwuZmlsZW5vKCldLCBbXSwgW10sIDApWzBdOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gY2hhbm5lbC5yZWN2KDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBzb2NrZXQuZXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkID0gYnl0ZXMoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4oZCkgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlX2RlYWRfcmVzb3VyY2VfY2hhbm5lbChjaGFubmVsX2lkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSArPSBkCiAgICAgICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgTWV0ZXJwcmV0ZXJTb2NrZXRTZXJ2ZXIpOgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGVjdC5zZWxlY3QoW2NoYW5uZWwuZmlsZW5vKCldLCBbXSwgW10sIDApWzBdOgogICAgICAgICAgICAgICAgICAgICAgICAoY2xpZW50X3NvY2ssIGNsaWVudF9hZGRyKSA9IGNoYW5uZWwuYWNjZXB0KCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyX2FkZHIgPSBjaGFubmVsLmdldHNvY2tuYW1lKCkKICAgICAgICAgICAgICAgICAgICAgICAgY2xpZW50X2NoYW5uZWxfaWQgPSBzZWxmLmFkZF9jaGFubmVsKE1ldGVycHJldGVyU29ja2V0Q2xpZW50KGNsaWVudF9zb2NrKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGt0ICA9IHN0cnVjdC5wYWNrKCc+SScsIFBBQ0tFVF9UWVBFX1JFUVVFU1QpCiAgICAgICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9NRVRIT0QsICd0Y3BfY2hhbm5lbF9vcGVuJykKICAgICAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX1VVSUQsIGJpbmFzY2lpLmEyYl9oZXgoYnl0ZXMoUEFZTE9BRF9VVUlELCAnVVRGLTgnKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9DSEFOTkVMX0lELCBjbGllbnRfY2hhbm5lbF9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX0NIQU5ORUxfUEFSRU5USUQsIGNoYW5uZWxfaWQpCiAgICAgICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9MT0NBTF9IT1NULCBpbmV0X3B0b24oY2hhbm5lbC5mYW1pbHksIHNlcnZlcl9hZGRyWzBdKSkKICAgICAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX0xPQ0FMX1BPUlQsIHNlcnZlcl9hZGRyWzFdKQogICAgICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfUEVFUl9IT1NULCBpbmV0X3B0b24oY2xpZW50X3NvY2suZmFtaWx5LCBjbGllbnRfYWRkclswXSkpCiAgICAgICAgICAgICAgICAgICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9QRUVSX1BPUlQsIGNsaWVudF9hZGRyWzFdKQogICAgICAgICAgICAgICAgICAgICAgICBwa3QgID0gc3RydWN0LnBhY2soJz5JJywgbGVuKHBrdCkgKyA0KSArIHBrdAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNlbmRfcGFja2V0KHBrdCkKICAgICAgICAgICAgICAgIGlmIGRhdGE6CiAgICAgICAgICAgICAgICAgICAgcGt0ICA9IHN0cnVjdC5wYWNrKCc+SScsIFBBQ0tFVF9UWVBFX1JFUVVFU1QpCiAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX01FVEhPRCwgJ2NvcmVfY2hhbm5lbF93cml0ZScpCiAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX1VVSUQsIGJpbmFzY2lpLmEyYl9oZXgoYnl0ZXMoUEFZTE9BRF9VVUlELCAnVVRGLTgnKSkpCiAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX0NIQU5ORUxfSUQsIGNoYW5uZWxfaWQpCiAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX0NIQU5ORUxfREFUQSwgZGF0YSkKICAgICAgICAgICAgICAgICAgICBwa3QgKz0gdGx2X3BhY2soVExWX1RZUEVfTEVOR1RILCBsZW4oZGF0YSkpCiAgICAgICAgICAgICAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX1JFUVVFU1RfSUQsIGdlbmVyYXRlX3JlcXVlc3RfaWQoKSkKICAgICAgICAgICAgICAgICAgICBwa3QgID0gc3RydWN0LnBhY2soJz5JJywgbGVuKHBrdCkgKyA0KSArIHBrdAogICAgICAgICAgICAgICAgICAgIHNlbGYuc2VuZF9wYWNrZXQocGt0KQoKICAgIGRlZiBoYW5kbGVfZGVhZF9yZXNvdXJjZV9jaGFubmVsKHNlbGYsIGNoYW5uZWxfaWQpOgogICAgICAgIGRlbCBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgaWYgY2hhbm5lbF9pZCBpbiBzZWxmLmludGVyYWN0X2NoYW5uZWxzOgogICAgICAgICAgICBzZWxmLmludGVyYWN0X2NoYW5uZWxzLnJlbW92ZShjaGFubmVsX2lkKQogICAgICAgIHBrdCAgPSBzdHJ1Y3QucGFjaygnPkknLCBQQUNLRVRfVFlQRV9SRVFVRVNUKQogICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9NRVRIT0QsICdjb3JlX2NoYW5uZWxfY2xvc2UnKQogICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9VVUlELCBiaW5hc2NpaS5hMmJfaGV4KGJ5dGVzKFBBWUxPQURfVVVJRCwgJ1VURi04JykpKQogICAgICAgIHBrdCArPSB0bHZfcGFjayhUTFZfVFlQRV9SRVFVRVNUX0lELCBnZW5lcmF0ZV9yZXF1ZXN0X2lkKCkpCiAgICAgICAgcGt0ICs9IHRsdl9wYWNrKFRMVl9UWVBFX0NIQU5ORUxfSUQsIGNoYW5uZWxfaWQpCiAgICAgICAgcGt0ICA9IHN0cnVjdC5wYWNrKCc+SScsIGxlbihwa3QpICsgNCkgKyBwa3QKICAgICAgICBzZWxmLnNlbmRfcGFja2V0KHBrdCkKCiAgICBkZWYgX2NvcmVfc2V0X3V1aWQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIG5ld191dWlkID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVVVJRCkKICAgICAgICBpZiBuZXdfdXVpZDoKICAgICAgICAgICAgUEFZTE9BRF9VVUlEID0gYmluYXNjaWkuYjJhX2hleChuZXdfdXVpZFsndmFsdWUnXSkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfZW51bWV4dGNtZChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgZXh0ZW5zaW9uX25hbWUgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9TVFJJTkcpWyd2YWx1ZSddCiAgICAgICAgZm9yIGZ1bmNfbmFtZSBpbiBzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnMua2V5cygpOgogICAgICAgICAgICBpZiBmdW5jX25hbWUuc3BsaXQoJ18nLCAxKVswXSA9PSBleHRlbnNpb25fbmFtZToKICAgICAgICAgICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1NUUklORywgZnVuY19uYW1lKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9nZXRfc2Vzc2lvbl9ndWlkKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9TRVNTSU9OX0dVSUQsIGJpbmFzY2lpLmEyYl9oZXgoYnl0ZXMoU0VTU0lPTl9HVUlELCAnVVRGLTgnKSkpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX3NldF9zZXNzaW9uX2d1aWQoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIG5ld19ndWlkID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfU0VTU0lPTl9HVUlEKQogICAgICAgIGlmIG5ld19ndWlkOgogICAgICAgICAgICBTRVNTSU9OX0dVSUQgPSBiaW5hc2NpaS5iMmFfaGV4KG5ld19ndWlkWyd2YWx1ZSddKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9tYWNoaW5lX2lkKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBzZXJpYWwgPSAnJwogICAgICAgIG1hY2hpbmVfbmFtZSA9IHBsYXRmb3JtLnVuYW1lKClbMV0KICAgICAgICBpZiBoYXNfd2luZGxsOgogICAgICAgICAgICBmcm9tIGN0eXBlcyBpbXBvcnQgd2ludHlwZXMKCiAgICAgICAgICAgIGszMiA9IGN0eXBlcy53aW5kbGwua2VybmVsMzIKICAgICAgICAgICAgc3lzX2RpciA9IGN0eXBlcy5jcmVhdGVfdW5pY29kZV9idWZmZXIoMjYwKQogICAgICAgICAgICBpZiBub3QgazMyLkdldFN5c3RlbURpcmVjdG9yeVcoY3R5cGVzLmJ5cmVmKHN5c19kaXIpLCAyNjApOgogICAgICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkVfV0lORE9XUwoKICAgICAgICAgICAgdm9sX2J1ZiA9IGN0eXBlcy5jcmVhdGVfdW5pY29kZV9idWZmZXIoMjYwKQogICAgICAgICAgICBmc19idWYgPSBjdHlwZXMuY3JlYXRlX3VuaWNvZGVfYnVmZmVyKDI2MCkKICAgICAgICAgICAgc2VyaWFsX251bSA9IHdpbnR5cGVzLkRXT1JEKDApCgogICAgICAgICAgICBpZiBub3QgazMyLkdldFZvbHVtZUluZm9ybWF0aW9uVyhjdHlwZXMuY193Y2hhcl9wKHN5c19kaXIudmFsdWVbOjNdKSwKICAgICAgICAgICAgICAgICAgICB2b2xfYnVmLCBjdHlwZXMuc2l6ZW9mKHZvbF9idWYpLCBjdHlwZXMuYnlyZWYoc2VyaWFsX251bSksIE5vbmUsCiAgICAgICAgICAgICAgICAgICAgTm9uZSwgZnNfYnVmLCBjdHlwZXMuc2l6ZW9mKGZzX2J1ZikpOgogICAgICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkVfV0lORE9XUwogICAgICAgICAgICBzZXJpYWxfbnVtID0gc2VyaWFsX251bS52YWx1ZQogICAgICAgICAgICBzZXJpYWwgPSAiJTA0eCIgJSAoKHNlcmlhbF9udW0gPj4gMTYpICYgMHhmZmZmKSArICctJyAiJTA0eCIgJSAoc2VyaWFsX251bSAmIDB4ZmZmZikKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZXJpYWwgPSBnZXRfaGRkX2xhYmVsKCkKCiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfTUFDSElORV9JRCwgIiVzOiVzIiAlIChzZXJpYWwsIG1hY2hpbmVfbmFtZSkpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX25hdGl2ZV9hcmNoKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9TVFJJTkcsIGdldF9uYXRpdmVfYXJjaCgpKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9wYXRjaF91cmwoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHNlbGYudHJhbnNwb3J0LCBIdHRwVHJhbnNwb3J0KToKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgbmV3X3VyaV9wYXRoID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfVVJMKVsndmFsdWUnXQogICAgICAgIGlmIG5vdCBzZWxmLnRyYW5zcG9ydC5wYXRjaF91cmlfcGF0aChuZXdfdXJpX3BhdGgpOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfbG9hZGxpYihzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgZGF0YV90bHYgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9EQVRBKQogICAgICAgIGlmIChkYXRhX3RsdlsndHlwZSddICYgVExWX01FVEFfVFlQRV9DT01QUkVTU0VEKSA9PSBUTFZfTUVUQV9UWVBFX0NPTVBSRVNTRUQ6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQoKICAgICAgICBzZWxmLmxhc3RfcmVnaXN0ZXJlZF9leHRlbnNpb24gPSBOb25lCiAgICAgICAgc3ltYm9sc19mb3JfZXh0ZW5zaW9ucyA9IHsnbWV0ZXJwcmV0ZXInOnNlbGZ9CiAgICAgICAgc3ltYm9sc19mb3JfZXh0ZW5zaW9ucy51cGRhdGUoRVhQT1JURURfU1lNQk9MUykKICAgICAgICBpID0gY29kZS5JbnRlcmFjdGl2ZUludGVycHJldGVyKHN5bWJvbHNfZm9yX2V4dGVuc2lvbnMpCiAgICAgICAgaS5ydW5jb2RlKGNvbXBpbGUoZGF0YV90bHZbJ3ZhbHVlJ10sICcnLCAnZXhlYycpKQogICAgICAgIGV4dGVuc2lvbl9uYW1lID0gc2VsZi5sYXN0X3JlZ2lzdGVyZWRfZXh0ZW5zaW9uCgogICAgICAgIGlmIGV4dGVuc2lvbl9uYW1lOgogICAgICAgICAgICBjaGVja19leHRlbnNpb24gPSBsYW1iZGEgeDogeC5zdGFydHN3aXRoKGV4dGVuc2lvbl9uYW1lKQogICAgICAgICAgICBsaWJfbWV0aG9kcyA9IGxpc3QoZmlsdGVyKGNoZWNrX2V4dGVuc2lvbiwgbGlzdChzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnMua2V5cygpKSkpCiAgICAgICAgICAgIGZvciBtZXRob2QgaW4gbGliX21ldGhvZHM6CiAgICAgICAgICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9NRVRIT0QsIG1ldGhvZCkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfc2h1dGRvd24oc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX0JPT0wsIFRydWUpCiAgICAgICAgc2VsZi5ydW5uaW5nID0gRmFsc2UKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X2FkZChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgbmV3X3RyYW5zcG9ydCA9IFRyYW5zcG9ydC5mcm9tX3JlcXVlc3QocmVxdWVzdCkKICAgICAgICBzZWxmLnRyYW5zcG9ydF9hZGQobmV3X3RyYW5zcG9ydCkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X2NoYW5nZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgbmV3X3RyYW5zcG9ydCA9IFRyYW5zcG9ydC5mcm9tX3JlcXVlc3QocmVxdWVzdCkKICAgICAgICBzZWxmLnRyYW5zcG9ydF9hZGQobmV3X3RyYW5zcG9ydCkKICAgICAgICBzZWxmLnNlbmRfcGFja2V0KHRsdl9wYWNrX3Jlc3BvbnNlKEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlKSkKICAgICAgICBzZWxmLnRyYW5zcG9ydF9jaGFuZ2UobmV3X3RyYW5zcG9ydCkKICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfbGlzdChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgaWYgc2VsZi5zZXNzaW9uX2V4cGlyeV90aW1lID4gMDoKICAgICAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfU0VTU0lPTl9FWFAsIHNlbGYuc2Vzc2lvbl9leHBpcnlfZW5kIC0gdGltZS50aW1lKCkpCiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfR1JPVVAsIHNlbGYudHJhbnNwb3J0LnRsdl9wYWNrX3RyYW5zcG9ydF9ncm91cCgpKQoKICAgICAgICB0cmFuc3BvcnQgPSBzZWxmLnRyYW5zcG9ydF9uZXh0KCkKICAgICAgICB3aGlsZSB0cmFuc3BvcnQgIT0gc2VsZi50cmFuc3BvcnQ6CiAgICAgICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX1RSQU5TX0dST1VQLCB0cmFuc3BvcnQudGx2X3BhY2tfdHJhbnNwb3J0X2dyb3VwKCkpCiAgICAgICAgICAgIHRyYW5zcG9ydCA9IHNlbGYudHJhbnNwb3J0X25leHQodHJhbnNwb3J0KQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfbmV4dChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgbmV3X3RyYW5zcG9ydCA9IHNlbGYudHJhbnNwb3J0X25leHQoKQogICAgICAgIGlmIG5ld190cmFuc3BvcnQgPT0gc2VsZi50cmFuc3BvcnQ6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIHNlbGYuc2VuZF9wYWNrZXQodGx2X3BhY2tfcmVzcG9uc2UoRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UpKQogICAgICAgIHNlbGYudHJhbnNwb3J0X2NoYW5nZShuZXdfdHJhbnNwb3J0KQogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIF9jb3JlX3RyYW5zcG9ydF9wcmV2KHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBuZXdfdHJhbnNwb3J0ID0gc2VsZi50cmFuc3BvcnRfcHJldigpCiAgICAgICAgaWYgbmV3X3RyYW5zcG9ydCA9PSBzZWxmLnRyYW5zcG9ydDoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgc2VsZi5zZW5kX3BhY2tldCh0bHZfcGFja19yZXNwb25zZShFUlJPUl9TVUNDRVNTLCByZXNwb25zZSkpCiAgICAgICAgc2VsZi50cmFuc3BvcnRfY2hhbmdlKG5ld190cmFuc3BvcnQpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X3JlbW92ZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgdXJsID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfVVJMKVsndmFsdWUnXQogICAgICAgIGlmIHNlbGYudHJhbnNwb3J0LnVybCA9PSB1cmw6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIHRyYW5zcG9ydF9mb3VuZCA9IEZhbHNlCiAgICAgICAgZm9yIHRyYW5zcG9ydCBpbiBzZWxmLnRyYW5zcG9ydHM6CiAgICAgICAgICAgIGlmIHRyYW5zcG9ydC51cmwgPT0gdXJsOgogICAgICAgICAgICAgICAgdHJhbnNwb3J0X2ZvdW5kID0gVHJ1ZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBpZiB0cmFuc3BvcnRfZm91bmQ6CiAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0cy5yZW1vdmUodHJhbnNwb3J0KQogICAgICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfdHJhbnNwb3J0X3NldF90aW1lb3V0cyhzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgdGltZW91dF92YWx1ZSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1NFU1NJT05fRVhQKS5nZXQoJ3ZhbHVlJykKICAgICAgICBpZiBub3QgdGltZW91dF92YWx1ZSBpcyBOb25lOgogICAgICAgICAgICBzZWxmLnNlc3Npb25fZXhwaXJ5X3RpbWUgPSB0aW1lb3V0X3ZhbHVlCiAgICAgICAgICAgIHNlbGYuc2Vzc2lvbl9leHBpcnlfZW5kID0gdGltZS50aW1lKCkgKyBzZWxmLnNlc3Npb25fZXhwaXJ5X3RpbWUKICAgICAgICB0aW1lb3V0X3ZhbHVlID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfVFJBTlNfQ09NTV9USU1FT1VUKS5nZXQoJ3ZhbHVlJykKICAgICAgICBpZiB0aW1lb3V0X3ZhbHVlOgogICAgICAgICAgICBzZWxmLnRyYW5zcG9ydC5jb21tdW5pY2F0aW9uX3RpbWVvdXQgPSB0aW1lb3V0X3ZhbHVlCiAgICAgICAgcmV0cnlfdmFsdWUgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19SRVRSWV9UT1RBTCkuZ2V0KCd2YWx1ZScpCiAgICAgICAgaWYgcmV0cnlfdmFsdWU6CiAgICAgICAgICAgIHNlbGYudHJhbnNwb3J0LnJldHJ5X3RvdGFsID0gcmV0cnlfdmFsdWUKICAgICAgICByZXRyeV92YWx1ZSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1RSQU5TX1JFVFJZX1dBSVQpLmdldCgndmFsdWUnKQogICAgICAgIGlmIHJldHJ5X3ZhbHVlOgogICAgICAgICAgICBzZWxmLnRyYW5zcG9ydC5yZXRyeV93YWl0ID0gcmV0cnlfdmFsdWUKCiAgICAgICAgaWYgc2VsZi5zZXNzaW9uX2V4cGlyeV90aW1lID4gMDoKICAgICAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfVFJBTlNfU0VTU0lPTl9FWFAsIHNlbGYuc2Vzc2lvbl9leHBpcnlfZW5kIC0gdGltZS50aW1lKCkpCiAgICAgICAgcmVzcG9uc2UgKz0gc2VsZi50cmFuc3BvcnQudGx2X3BhY2tfdGltZW91dHMoKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV90cmFuc3BvcnRfc2xlZXAoc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIHNlY29uZHMgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9UUkFOU19DT01NX1RJTUVPVVQpWyd2YWx1ZSddCiAgICAgICAgc2VsZi5zZW5kX3BhY2tldCh0bHZfcGFja19yZXNwb25zZShFUlJPUl9TVUNDRVNTLCByZXNwb25zZSkpCiAgICAgICAgaWYgc2Vjb25kczoKICAgICAgICAgICAgc2VsZi5fdHJhbnNwb3J0X3NsZWVwID0gc2Vjb25kcwogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9jaGFubmVsX29wZW4oc2VsZiwgcmVxdWVzdCwgcmVzcG9uc2UpOgogICAgICAgIGNoYW5uZWxfdHlwZSA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfVFlQRSkKICAgICAgICBoYW5kbGVyID0gJ2NoYW5uZWxfb3Blbl8nICsgY2hhbm5lbF90eXBlWyd2YWx1ZSddCiAgICAgICAgaWYgaGFuZGxlciBub3QgaW4gc2VsZi5leHRlbnNpb25fZnVuY3Rpb25zOgogICAgICAgICAgICByZXR1cm4gZXJyb3JfcmVzdWx0KE5vdEltcGxlbWVudGVkRXJyb3IpLCByZXNwb25zZQogICAgICAgIGhhbmRsZXIgPSBzZWxmLmV4dGVuc2lvbl9mdW5jdGlvbnNbaGFuZGxlcl0KICAgICAgICByZXR1cm4gaGFuZGxlcihyZXF1ZXN0LCByZXNwb25zZSkKCiAgICBkZWYgX2NvcmVfY2hhbm5lbF9jbG9zZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgY2hhbm5lbF9pZCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfSUQpWyd2YWx1ZSddCiAgICAgICAgaWYgY2hhbm5lbF9pZCBub3QgaW4gc2VsZi5jaGFubmVsczoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgY2hhbm5lbCA9IHNlbGYuY2hhbm5lbHNbY2hhbm5lbF9pZF0KICAgICAgICBpZiBpc2luc3RhbmNlKGNoYW5uZWwsIHN1YnByb2Nlc3MuUG9wZW4pOgogICAgICAgICAgICBjaGFubmVsLmtpbGwoKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlckZpbGUpOgogICAgICAgICAgICBjaGFubmVsLmNsb3NlKCkKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgTWV0ZXJwcmV0ZXJTb2NrZXQpOgogICAgICAgICAgICBjaGFubmVsLmNsb3NlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICBkZWwgc2VsZi5jaGFubmVsc1tjaGFubmVsX2lkXQogICAgICAgIGlmIGNoYW5uZWxfaWQgaW4gc2VsZi5pbnRlcmFjdF9jaGFubmVsczoKICAgICAgICAgICAgc2VsZi5pbnRlcmFjdF9jaGFubmVscy5yZW1vdmUoY2hhbm5lbF9pZCkKICAgICAgICBkZWJ1Z19wcmludCgnWypdIGNsb3NlZCBhbmQgcmVtb3ZlZCBjaGFubmVsIGlkOiAnICsgc3RyKGNoYW5uZWxfaWQpKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9jaGFubmVsX2VvZihzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgY2hhbm5lbF9pZCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfSUQpWyd2YWx1ZSddCiAgICAgICAgaWYgY2hhbm5lbF9pZCBub3QgaW4gc2VsZi5jaGFubmVsczoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgY2hhbm5lbCA9IHNlbGYuY2hhbm5lbHNbY2hhbm5lbF9pZF0KICAgICAgICByZXN1bHQgPSBGYWxzZQogICAgICAgIGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgTWV0ZXJwcmV0ZXJGaWxlKToKICAgICAgICAgICAgcmVzdWx0ID0gY2hhbm5lbC50ZWxsKCkgPj0gb3MuZnN0YXQoY2hhbm5lbC5maWxlbm8oKSkuc3Rfc2l6ZQogICAgICAgIHJlc3BvbnNlICs9IHRsdl9wYWNrKFRMVl9UWVBFX0JPT0wsIHJlc3VsdCkKICAgICAgICByZXR1cm4gRVJST1JfU1VDQ0VTUywgcmVzcG9uc2UKCiAgICBkZWYgX2NvcmVfY2hhbm5lbF9pbnRlcmFjdChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgY2hhbm5lbF9pZCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfSUQpWyd2YWx1ZSddCiAgICAgICAgaWYgY2hhbm5lbF9pZCBub3QgaW4gc2VsZi5jaGFubmVsczoKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgY2hhbm5lbCA9IHNlbGYuY2hhbm5lbHNbY2hhbm5lbF9pZF0KICAgICAgICB0b2dnbGUgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9CT09MKVsndmFsdWUnXQogICAgICAgIGlmIHRvZ2dsZToKICAgICAgICAgICAgaWYgY2hhbm5lbF9pZCBpbiBzZWxmLmludGVyYWN0X2NoYW5uZWxzOgogICAgICAgICAgICAgICAgc2VsZi5pbnRlcmFjdF9jaGFubmVscy5yZW1vdmUoY2hhbm5lbF9pZCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHMuYXBwZW5kKGNoYW5uZWxfaWQpCiAgICAgICAgZWxpZiBjaGFubmVsX2lkIGluIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHM6CiAgICAgICAgICAgIHNlbGYuaW50ZXJhY3RfY2hhbm5lbHMucmVtb3ZlKGNoYW5uZWxfaWQpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIF9jb3JlX2NoYW5uZWxfcmVhZChzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICAgY2hhbm5lbF9pZCA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX0NIQU5ORUxfSUQpWyd2YWx1ZSddCiAgICAgICAgbGVuZ3RoID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfTEVOR1RIKVsndmFsdWUnXQogICAgICAgIGlmIGNoYW5uZWxfaWQgbm90IGluIHNlbGYuY2hhbm5lbHM6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgZGF0YSA9ICcnCiAgICAgICAgaWYgaXNpbnN0YW5jZShjaGFubmVsLCBTVERQcm9jZXNzKToKICAgICAgICAgICAgaWYgY2hhbm5lbC5wb2xsKCkgIT0gTm9uZToKICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlX2RlYWRfcmVzb3VyY2VfY2hhbm5lbChjaGFubmVsX2lkKQogICAgICAgICAgICBpZiBjaGFubmVsLnN0ZG91dF9yZWFkZXIuaXNfcmVhZF9yZWFkeSgpOgogICAgICAgICAgICAgICAgZGF0YSA9IGNoYW5uZWwuc3Rkb3V0X3JlYWRlci5yZWFkKGxlbmd0aCkKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgTWV0ZXJwcmV0ZXJGaWxlKToKICAgICAgICAgICAgZGF0YSA9IGNoYW5uZWwucmVhZChsZW5ndGgpCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGNoYW5uZWwsIE1ldGVycHJldGVyU29ja2V0KToKICAgICAgICAgICAgZGF0YSA9IGNoYW5uZWwucmVjdihsZW5ndGgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgcmVzcG9uc2UgKz0gdGx2X3BhY2soVExWX1RZUEVfQ0hBTk5FTF9EQVRBLCBkYXRhKQogICAgICAgIHJldHVybiBFUlJPUl9TVUNDRVNTLCByZXNwb25zZQoKICAgIGRlZiBfY29yZV9jaGFubmVsX3dyaXRlKHNlbGYsIHJlcXVlc3QsIHJlc3BvbnNlKToKICAgICAgICBjaGFubmVsX2lkID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfQ0hBTk5FTF9JRClbJ3ZhbHVlJ10KICAgICAgICBjaGFubmVsX2RhdGEgPSBwYWNrZXRfZ2V0X3RsdihyZXF1ZXN0LCBUTFZfVFlQRV9DSEFOTkVMX0RBVEEpWyd2YWx1ZSddCiAgICAgICAgbGVuZ3RoID0gcGFja2V0X2dldF90bHYocmVxdWVzdCwgVExWX1RZUEVfTEVOR1RIKVsndmFsdWUnXQogICAgICAgIGlmIGNoYW5uZWxfaWQgbm90IGluIHNlbGYuY2hhbm5lbHM6CiAgICAgICAgICAgIHJldHVybiBFUlJPUl9GQUlMVVJFLCByZXNwb25zZQogICAgICAgIGNoYW5uZWwgPSBzZWxmLmNoYW5uZWxzW2NoYW5uZWxfaWRdCiAgICAgICAgbCA9IGxlbihjaGFubmVsX2RhdGEpCiAgICAgICAgaWYgaXNpbnN0YW5jZShjaGFubmVsLCBzdWJwcm9jZXNzLlBvcGVuKToKICAgICAgICAgICAgaWYgY2hhbm5lbC5wb2xsKCkgIT0gTm9uZToKICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlX2RlYWRfcmVzb3VyY2VfY2hhbm5lbChjaGFubmVsX2lkKQogICAgICAgICAgICAgICAgcmV0dXJuIEVSUk9SX0ZBSUxVUkUsIHJlc3BvbnNlCiAgICAgICAgICAgIGNoYW5uZWwud3JpdGUoY2hhbm5lbF9kYXRhKQogICAgICAgIGVsaWYgaXNpbnN0YW5jZShjaGFubmVsLCBNZXRlcnByZXRlckZpbGUpOgogICAgICAgICAgICBjaGFubmVsLndyaXRlKGNoYW5uZWxfZGF0YSkKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoY2hhbm5lbCwgTWV0ZXJwcmV0ZXJTb2NrZXQpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBsID0gY2hhbm5lbC5zZW5kKGNoYW5uZWxfZGF0YSkKICAgICAgICAgICAgZXhjZXB0IHNvY2tldC5lcnJvcjoKICAgICAgICAgICAgICAgIGNoYW5uZWwuY2xvc2UoKQogICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVfZGVhZF9yZXNvdXJjZV9jaGFubmVsKGNoYW5uZWxfaWQpCiAgICAgICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gRVJST1JfRkFJTFVSRSwgcmVzcG9uc2UKICAgICAgICByZXNwb25zZSArPSB0bHZfcGFjayhUTFZfVFlQRV9MRU5HVEgsIGwpCiAgICAgICAgcmV0dXJuIEVSUk9SX1NVQ0NFU1MsIHJlc3BvbnNlCgogICAgZGVmIGNyZWF0ZV9yZXNwb25zZShzZWxmLCByZXF1ZXN0KToKICAgICAgICByZXNwID0gc3RydWN0LnBhY2soJz5JJywgUEFDS0VUX1RZUEVfUkVTUE9OU0UpCiAgICAgICAgbWV0aG9kX3RsdiA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX01FVEhPRCkKICAgICAgICByZXNwICs9IHRsdl9wYWNrKG1ldGhvZF90bHYpCiAgICAgICAgcmVzcCArPSB0bHZfcGFjayhUTFZfVFlQRV9VVUlELCBiaW5hc2NpaS5hMmJfaGV4KGJ5dGVzKFBBWUxPQURfVVVJRCwgJ1VURi04JykpKQoKICAgICAgICBoYW5kbGVyX25hbWUgPSBtZXRob2RfdGx2Wyd2YWx1ZSddCiAgICAgICAgaWYgaGFuZGxlcl9uYW1lIGluIHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9uczoKICAgICAgICAgICAgaGFuZGxlciA9IHNlbGYuZXh0ZW5zaW9uX2Z1bmN0aW9uc1toYW5kbGVyX25hbWVdCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRlYnVnX3ByaW50KCdbKl0gcnVubmluZyBtZXRob2QgJyArIGhhbmRsZXJfbmFtZSkKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGhhbmRsZXIocmVxdWVzdCwgcmVzcCkKICAgICAgICAgICAgICAgIGlmIHJlc3VsdCBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgcmVzdWx0LCByZXNwID0gcmVzdWx0CiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBkZWJ1Z190cmFjZWJhY2soJ1stXSBtZXRob2QgJyArIGhhbmRsZXJfbmFtZSArICcgcmVzdWx0ZWQgaW4gYW4gZXJyb3InKQogICAgICAgICAgICAgICAgcmVzdWx0ID0gZXJyb3JfcmVzdWx0KCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIHJlc3VsdCAhPSBFUlJPUl9TVUNDRVNTOgogICAgICAgICAgICAgICAgICAgIGRlYnVnX3ByaW50KCdbLV0gbWV0aG9kICcgKyBoYW5kbGVyX25hbWUgKyAnIHJlc3VsdGVkIGluIGVycm9yOiAjJyArIHN0cihyZXN1bHQpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRlYnVnX3ByaW50KCdbLV0gbWV0aG9kICcgKyBoYW5kbGVyX25hbWUgKyAnIHdhcyByZXF1ZXN0ZWQgYnV0IGRvZXMgbm90IGV4aXN0JykKICAgICAgICAgICAgcmVzdWx0ID0gZXJyb3JfcmVzdWx0KE5vdEltcGxlbWVudGVkRXJyb3IpCgogICAgICAgIHJlcWlkX3RsdiA9IHBhY2tldF9nZXRfdGx2KHJlcXVlc3QsIFRMVl9UWVBFX1JFUVVFU1RfSUQpCiAgICAgICAgaWYgbm90IHJlcWlkX3RsdjoKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgcmVzcCArPSB0bHZfcGFjayhyZXFpZF90bHYpCiAgICAgICAgcmV0dXJuIHRsdl9wYWNrX3Jlc3BvbnNlKHJlc3VsdCwgcmVzcCkKCl90cnlfdG9fZm9yayA9IFRSWV9UT19GT1JLIGFuZCBoYXNhdHRyKG9zLCAnZm9yaycpCmlmIG5vdCBfdHJ5X3RvX2Zvcmsgb3IgKF90cnlfdG9fZm9yayBhbmQgb3MuZm9yaygpID09IDApOgogICAgaWYgaGFzYXR0cihvcywgJ3NldHNpZCcpOgogICAgICAgIHRyeToKICAgICAgICAgICAgb3Muc2V0c2lkKCkKICAgICAgICBleGNlcHQgT1NFcnJvcjoKICAgICAgICAgICAgcGFzcwogICAgaWYgSFRUUF9DT05ORUNUSU9OX1VSTCBhbmQgaGFzX3VybGxpYjoKICAgICAgICB0cmFuc3BvcnQgPSBIdHRwVHJhbnNwb3J0KEhUVFBfQ09OTkVDVElPTl9VUkwsIHByb3h5PUhUVFBfUFJPWFksIHVzZXJfYWdlbnQ9SFRUUF9VU0VSX0FHRU5ULAogICAgICAgICAgICAgICAgaHR0cF9ob3N0PUhUVFBfSE9TVCwgaHR0cF9yZWZlcmVyPUhUVFBfUkVGRVJFUiwgaHR0cF9jb29raWU9SFRUUF9DT09LSUUpCiAgICBlbHNlOgogICAgICAgICMgUEFUQ0gtU0VUVVAtU1RBR0VMRVNTLVRDUC1TT0NLRVQgIwogICAgICAgIHRyYW5zcG9ydCA9IFRjcFRyYW5zcG9ydC5mcm9tX3NvY2tldChzKQogICAgbWV0ID0gUHl0aG9uTWV0ZXJwcmV0ZXIodHJhbnNwb3J0KQogICAgIyBQQVRDSC1TRVRVUC1UUkFOU1BPUlRTICMKICAgIG1ldC5ydW4oKQo=')))